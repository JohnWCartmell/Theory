
%ccategories.macros.tex 

% Macros for diagrams in contextual categories and related categories

\usepackage{twoopt}
\usepackage{scalerel} 
\usepackage{xargs}

%\usepackage{mathabx}  %Caused font problems
%\usepackage{MnSymbol}  % caused font problems

\newcommand{\conu}
{\mathbf{C}(U)}

\newcommand{\depu}
{\mathbf{D}(U)}

\newcommand{\cat}[1]{\textbf{#1}}
\newcommand{\obj}[1]{\ensuremath{|\cat{#1}|}}
\newcommand{\ccat}[1][C]{\ensuremath{\mathbb{#1}} }
\newcommand{\ccatc}{contextual category \ccat}
\newcommand{\cobj}[2][]{\ensuremath{|\ccat[#2]|_{#1}}}
\newcommand{\cslice}[2]{\ensuremath{\ccat[#1]_{#2}}}
\newcommand{\csliceobj}[3][]{\ensuremath{|\mathbb{#2}_{#3}|_{#1} }}
\newcommand{\varset}[1][]{\ensuremath{V_{#1} }}
\newcommand{\localvarsets}{\ensuremath{\mathcal{V} }}
\newcommand{\Fam}{\ensuremath{\mathbb{F\mathrm{am}} }}
\newcommand{\Famslice}[1]{\ensuremath{\mathbb{F\mathrm{am}}_{#1} }}
\newcommand{\Famobj}[1][]{\ensuremath{|\mathbb{F\mathrm{am}}|_{#1} }}
\newcommand{\Famsliceobj}[2][]{\ensuremath{|\mathbb{F\mathrm{am}}_{#2}|_{#1} }}
\newcommand{\morph}{\rightarrow}
\newcommand{\epi}{\twoheadrightarrow}
\newcommand{\base}{\triangleleft}
\newcommand{\comp}{\circ}
\newcommand{\cross}{\otimes}
\newcommand{\pc}[2]{d^{#1}_{#2}}
\newcommand{\sub}{^*}
\newcommand{\diag}{\delta}
\newcommand{\pbase}[1]{\tilde{#1}}

\newcommand{\tuple}[1]{\langle#1\rangle}
\newcommand{\ndidly}{\ensuremath{\Join_n}}
\newcommand{\ndidlycospan}{quotiented n-cospan}

\newcommand{\crossx}[3]{#1 \underset{#3}{\cross} #2}
\newcommand{\fibrex}[3]{#1 \underset{#3}{\Join} #2}
\newcommand{\powerset}{\mathcal{P}}
\newcommand{\primeds}[1]{
\ensuremath{\mathcal{P}(#1)} }
\newcommand{\compset}{\ \dot{\circ}\, }

% darrow
%\newcommand{\darrow}{\rightarrowtriangle} %use \smorph instead
\newcommand{\smorph}{\rightarrowtriangle}

 

\newcommand\dhead{\scaleobj{0.6}{\triangleright}}
\newcommand{\dmorph}{\, \mbox{---} \! \cdot \! \raisebox{1.1pt}{\dhead}}

% projection tree
%\newcommand{\proj}[2]{proj_{#2}(#1)}

\newcommand{\proj}[2]{
\ensuremath{\mathcal{P}_{#2}(#1)} }

%pstrick supplements for arrows

\newlength{\arrnodesepA}
\newlength{\arrnodesepB}
\newlength{\arroffsetA}
\newlength{\arroffsetB}

%Modified to 2pt from 0pt on 23 July 2018
\newcommand{\arreset}{
\setlength{\arrnodesepA}{2pt}
\setlength{\arrnodesepB}{2pt}
\setlength{\arroffsetA}{0pt}
\setlength{\arroffsetB}{0pt}
}
\arreset

\newcommand{\ncarr}[3][0]{\ncarc[arcangle=#1,nodesepA=\arrnodesepA,nodesepB=\arrnodesepB,offsetA=\arroffsetA,offsetB=\arroffsetB,arrowsize=5pt,arrowinset=0.7]{->}{#2}{#3}}
\newcommand{\jcbarr}[4][0]{ % ncbarr is defined in some thridy party package so do not use!\emph{}
\ncarr[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}

\newcommand{\ncaarr}[4][0]{
\ncarr[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}

% \alabel{label}[npos][labelsep_pts]
\newcommandx*\alabel[3][2=0.5,3=2,usedefault]{\naput[labelsep=#3pt,npos=#2]{\footnotesize $#1$}}
% \blabel{label}[npos][labelsep_pts]
\newcommandx*\blabel[3][2=0.5,3=2,usedefault]{\nbput[labelsep=#3pt,npos=#2]{\footnotesize $#1$}}

% \idcomp mark an arrow as one component of an identifier
\newcommand{\idcomp}{\ncput[npos=0.1, nrot=:U]{\psline(0,-0.075)(0,0.075)}}  %add a bar to a node connection arrow
% pstrick supplements for s-arrows (previous name for d-arrow - should convert}

\newlength{\sarnodesepA}
\newlength{\sarnodesepB}
\newlength{\saroffsetA}
\newlength{\saroffsetB}
\newlength{\sarnodesepAsav}
\newlength{\sarnodesepBsav}

\newcommand{\sarreset}{
\setlength{\sarnodesepA}{0pt}
\setlength{\sarnodesepB}{0pt}
\setlength{\saroffsetA}{0pt}
\setlength{\saroffsetB}{0pt}
}

\sarreset

% sar - S-arrow
\newcommand{\ncsar}[3][0]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{7pt}
\ncarc[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,arcangle=#1]{-}{#2}{#3}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0)(.2,.2)}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}


% bsar - below labelled S-arrow
\newcommand{\ncbsar}[4][0]{
\ncsar[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}
% asar - above labelled S-arrow
\newcommand{\ncasar}[4][0]{
\ncsar[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}

% cdar - composite dependency arrow
\newcommand{\nccdar}[3][0]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{11pt}
\ncarc[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,arcangle=#1]{-}{#2}{#3}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0.1)(.2,.2)}
\ncput[nrot=:R,npos=1]{\psdot[dotsize=1pt](-0.0075,0.05)}   %!!
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}


% bcdar - below labelled composite dependency arrow
\newcommand{\ncbcdar}[4][0]{
\nccdar[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}
% acdar - above labelled composite dependency arrow
\newcommand{\ncacdar}[4][0]{
\nccdar[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}


% rsar - recursive S-arrow
\newcommand{\ncrsar}[2]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{7pt}
\ncloop[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,
        offsetA=\saroffsetA,offsetB=\saroffsetB,
        armA=0.7cm,armB=0.6cm,angleA=90,angleB=-90,loopsize=-1,linearc=0.4
				]{-}{#1}{#2}
\ncput[nrot=:R,npos=5]{\pstriangle(0,0)(.2,.2)}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}

% pstrick supplements for multi-arrows

\newlength{\marnodesepA}
\newlength{\marnodesepB}
\newlength{\maroffsetB}
\newlength{\marnodesepBsav}

\newcommand{\marreset}{
\setlength{\marnodesepA}{0pt}
\setlength{\marnodesepB}{0pt}
\setlength{\maroffsetB}{0pt}
}

\marreset

%ncmarr[#1 arcangle1][#2 arcangle2]{#3 name}{#4 domain1}{#5 domain2}{#6 junction}{#7 codomain}
\newcommandtwoopt{\ncmarr}[6][8][8]{%
\ncarc[nodesepA=\marnodesepA,nodesepB=0,arcangle=#1]{-}{#3}{#5}
\ncarc[nodesepB=0,arcangle=-#1]{-}{#4}{#5}
\ncarc[arcangle=#2,nodesepB=\marnodesepB,offsetB=\maroffsetB]{->}{#5}{#6}
}%


\newcommandtwoopt{\nchmarr}[6][8][8]{%
\ncarc[nodesepA=\marnodesepA,nodesepB=0,arcangle=#1]{-}{#3}{#5}
\ncarc[nodesepB=0,arcangle=#1]{-}{#4}{#5}
\ncarc[arcangle=#2,nodesepB=\marnodesepB,offsetB=\maroffsetB]{->}{#5}{#6}
}%

\newcommandtwoopt{\ncamarr}[7][8][8]{%
\ncmarr[#1][#2]{#4}{#5}{#6}{#7}
\naput[npos=.05]{$#3$}
}%
\newcommandtwoopt{\ncbmarr}[7][8][8]{%
\ncmarr[#1][#2]{#4}{#5}{#6}{#7}
\nbput[npos=.05]{$#3$}
}%

\newcommandtwoopt{\ncbhmarr}[7][8][8]{%
\nchmarr[#1][#2]{#4}{#5}{#6}{#7}
\nbput[npos=.05]{$#3$}
}%

\newcommandtwoopt{\ncmarrr}[7][8][8]{
\ncarc[nodesepB=0,arcangle=#1]{-}{#3}{#6}
\ncline[nodesepB=0]{-}{#4}{#6}
\ncarc[nodesepB=0,arcangle=-#1]{-}{#5}{#6}
\ncarc[nodesepA=0,arcangle=#2]{->}{#6}{#7}
}

\newcommandtwoopt{\ncamarrr}[8][8][8]{
\ncmarrr[#1][#2]{#4}{#5}{#6}{#7}{#8}
\naput[npos=.05]{$#3$}
}
\newcommandtwoopt{\ncbmarrr}[8][8][8]{
\ncmarrr[#1][#2]{#4}{#5}{#6}{#7}{#8}
\nbput[npos=.05]{$#3$}
}
