
%ccategories.macros.tex 

% Macros for diagrams in contextual categories and related categories

\usepackage{twoopt}
\usepackage{scalerel} 
\usepackage{xargs}

%\usepackage{mathabx}  %Caused font problems
%\usepackage{MnSymbol}  % caused font problems

\newcommand{\conu}
{\mathbf{C}(U)}

\newcommand{\depu}
{\mathbf{D}(U)}


\newcommand{\reqt}{\textbf{R}}
\newcommand{\reqtc}[1][\catc]{\reqt_{#1}}
\newcommand{\reqtcp}[1][\catcp]{\reqt_{#1}}



\newcommand{\cat}[1]{\textbf{#1}}

\newcommand{\catc}{\cat{C}}
\newcommand{\catcw}{\cat{C}\ }
\newcommand{\catcp}[1][C]{\textbf{#1}'}
\newcommand{\catcpp}[1][C]{\textbf{#1}''}
\newcommand{\obj}[1]{\ensuremath{|\cat{#1}|}}
\newcommand{\ccat}[1][C]{\ensuremath{\mathbb{#1}} }
\newcommand{\ccatc}{contextual category \ccat}
\newcommand{\cobj}[2][]{\ensuremath{|\ccat[#2]|_{#1}}}
\newcommand{\cslice}[2]{\ensuremath{\ccat[#1]_{#2}}}
\newcommand{\csliceobj}[3][]{\ensuremath{|\mathbb{#2}_{#3}|_{#1} }}
\newcommand{\varset}[1][]{\ensuremath{V_{#1} }}
\newcommand{\localvarsets}{\ensuremath{\mathcal{V} }}
\newcommand{\Fam}{\ensuremath{\mathbb{F\mathrm{am}} }}
\newcommand{\Fin}{\ensuremath{\textbf{Fin}} }
\newcommand{\Finp}{\ensuremath{\textbf{Finp}} }
\newcommand{\Po}{\ensuremath{\textbf{Po}} }
\newcommand{\Famslice}[1]{\ensuremath{\mathbb{F\mathrm{am}}_{#1} }}
\newcommand{\Famobj}[1][]{\ensuremath{|\mathbb{F\mathrm{am}}|_{#1} }}
\newcommand{\Famsliceobj}[2][]{\ensuremath{|\mathbb{F\mathrm{am}}_{#2}|_{#1} }}
\newcommand{\morph}{\rightarrow}
\newcommand{\epi}{\twoheadrightarrow}
\newcommand{\base}{\triangleleft}
\newcommand{\comp}{\circ}
\newcommand{\cross}{\otimes}
\newcommand{\pc}[2]{d^{#1}_{#2}}
\newcommand{\sub}{^*}
\newcommand{\diag}{\delta}
\newcommand{\pbase}[1]{\tilde{#1}}
\newcommand{\tuple}[1]{\langle#1\rangle}
\newcommand{\ndidly}{\ensuremath{\Join_n}}

\newcommand{\product}[1]{\bigtimes_{#1}}
\newcommand{\productn}{\product{n}}
\newcommand{\crossx}[3]{#1 \underset{#3}{\cross} #2}
\newcommand{\fibrex}[3]{#1 \underset{#3}{\Join} #2}
\newcommand{\powerset}{\mathcal{P}}
\newcommand{\primeds}[1]{
\ensuremath{\mathcal{P}(#1)} }
\newcommand{\compset}{\ \dot{\circ}\, }

% darrow
%\newcommand{\darrow}{\rightarrowtriangle} %use \smorph instead
\newcommand{\smorph}{\rightarrowtriangle}

 
\newcommand\dhead{\scaleobj{0.6}{\triangleright}}
%\newcommand{\dmorph}{\, \mbox{---} \! \cdot \! \raisebox{1.1pt}{\dhead}}    % dot style
\newcommand{\dmorph}{\, \mbox{---}\kern-1pt\raisebox{1.1pt}{\dhead\kern-1.75pt\dhead}}\,     % double triangle style

% projection tree
%\newcommand{\proj}[2]{proj_{#2}(#1)}

\newcommand{\proj}[2]{
\ensuremath{\mathcal{P}_{#2}(#1)} }

%pstrick supplements for arrows

\newlength{\arrnodesepA}
\newlength{\arrnodesepB}
\newlength{\arroffsetA}
\newlength{\arroffsetB}

%Modified to 2pt from 0pt on 23 July 2018
\newcommand{\arreset}{
\setlength{\arrnodesepA}{2pt}
\setlength{\arrnodesepB}{2pt}
\setlength{\arroffsetA}{0pt}
\setlength{\arroffsetB}{0pt}
}
\arreset

\newcommand{\ncarr}[3][0]{\ncarc[arcangle=#1,nodesepA=\arrnodesepA,nodesepB=\arrnodesepB,offsetA=\arroffsetA,offsetB=\arroffsetB,arrowsize=5pt,arrowinset=0.7]{->}{#2}{#3}}
\newcommand{\ncdarr}[3][0]{\ncarc[linestyle=dashed,arcangle=#1,nodesepA=\arrnodesepA,nodesepB=\arrnodesepB,offsetA=\arroffsetA,offsetB=\arroffsetB,arrowsize=5pt,arrowinset=0.7]{->}{#2}{#3}}
\newcommand{\jcbarr}[4][0]{ % ncbarr is defined in some thridy party package so do not use!\emph{}
\ncarr[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}

\newcommand{\ncaarr}[4][0]{
\ncarr[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}

% \alabel{label}[npos][labelsep_pts]
\newcommandx*\alabel[3][2=0.5,3=2,usedefault]{\naput[labelsep=#3pt,npos=#2]{\footnotesize $#1$}}
% \blabel{label}[npos][labelsep_pts]
\newcommandx*\blabel[3][2=0.5,3=2,usedefault]{\nbput[labelsep=#3pt,npos=#2]{\footnotesize $#1$}}


\newif \ifbars
% to supress display of bars use \barsfalse to swith them on use \barstrue
\barstrue 
% \idcomp mark an arrow as one component of an identifier
\newcommand{\idcomp}{\ifbars{\ncput[npos=0, nrot=:U]{\psline(0.2,-0.075)(0.2,0.075)}}\fi}  %add a bar to a node connection arrow
% pstrick supplements for s-arrows (previous name for d-arrow - should convert}

\newlength{\sarnodesepA}
\newlength{\sarnodesepB}
\newlength{\saroffsetA}
\newlength{\saroffsetB}
\newlength{\sarnodesepAsav}
\newlength{\sarnodesepBsav}

\newcommand{\sarreset}{
\setlength{\sarnodesepA}{0pt}
\setlength{\sarnodesepB}{0pt}
\setlength{\saroffsetA}{0pt}
\setlength{\saroffsetB}{0pt}
}

\sarreset

% sar - S-arrow
\newcommand{\ncsar}[3][0]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{7pt}
\ncarc[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,arcangle=#1]{-}{#2}{#3}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0)(.2,.2)}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}


% bsar - below labelled S-arrow
\newcommand{\ncbsar}[4][0]{
\ncsar[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}
% asar - above labelled S-arrow
\newcommand{\ncasar}[4][0]{
\ncsar[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}

% OLD cdar - composite dependency arrow - dot tyle
\iffalse
\newcommand{\nccdar}[3][0]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{11pt}
\ncarc[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,arcangle=#1]{-}{#2}{#3}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0.1)(.2,.2)}
\ncput[nrot=:R,npos=1]{\psdot[dotsize=1pt](-0.0075,0.05)}   %!!
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}
\fi

% cdar - composite dependency arrow Mark II - double trangle style
\newcommand{\nccdar}[3][0]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{13pt}
\ncarc[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,arcangle=#1]{-}{#2}{#3}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0)(.2,.2)}
\ncput[nrot=:R,npos=1]{\pstriangle(0,0.2)(.2,.2)}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}


% bcdar - below labelled composite dependency arrow
\newcommand{\ncbcdar}[4][0]{
\nccdar[#1]{#3}{#4}
\nbput[labelsep=2pt]{\footnotesize $#2$}
}
% acdar - above labelled composite dependency arrow
\newcommand{\ncacdar}[4][0]{
\nccdar[#1]{#3}{#4}
\naput[labelsep=2pt]{\footnotesize $#2$}
}


% rsar - recursive S-arrow
\newcommand{\ncrsar}[2]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{7pt}
\ncloop[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,
        offsetA=\saroffsetA,offsetB=\saroffsetB,
        armA=0.7cm,armB=0.6cm,angleA=90,angleB=-90,loopsize=-1,linearc=0.4
				]{-}{#1}{#2}
\ncput[nrot=:R,npos=5]{\pstriangle(0,0)(.2,.2)}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}

% pstrick supplements for multi-arrows

\newlength{\marnodesepA}
\newlength{\marnodesepB}
\newlength{\maroffsetB}
\newlength{\marnodesepBsav}

\newcommand{\marreset}{
\setlength{\marnodesepA}{0pt}
\setlength{\marnodesepB}{0pt}
\setlength{\maroffsetB}{0pt}
}

\marreset

%ncmarr[#1 arcangle1][#2 arcangle2]{#3 name}{#4 domain1}{#5 domain2}{#6 junction}{#7 codomain}
\newcommandtwoopt{\ncmarr}[6][8][8]{%
\ncarc[nodesepA=\marnodesepA,nodesepB=0,arcangle=#1]{-}{#3}{#5}
\ncarc[nodesepB=0,arcangle=-#1]{-}{#4}{#5}
\ncarc[arcangle=#2,nodesepB=\marnodesepB,offsetB=\maroffsetB]{->}{#5}{#6}
}%


\newcommandtwoopt{\nchmarr}[6][8][8]{%
\ncarc[nodesepA=\marnodesepA,nodesepB=0,arcangle=#1]{-}{#3}{#5}
\ncarc[nodesepB=0,arcangle=#1]{-}{#4}{#5}
\ncarc[arcangle=#2,nodesepB=\marnodesepB,offsetB=\maroffsetB]{->}{#5}{#6}
}%

\newcommandtwoopt{\ncamarr}[7][8][8]{%
\ncmarr[#1][#2]{#4}{#5}{#6}{#7}
\naput[npos=.05]{$#3$}
}%
\newcommandtwoopt{\ncbmarr}[7][8][8]{%
\ncmarr[#1][#2]{#4}{#5}{#6}{#7}
\nbput[npos=.05]{$#3$}
}%

\newcommandtwoopt{\ncbhmarr}[7][8][8]{%
\nchmarr[#1][#2]{#4}{#5}{#6}{#7}
\nbput[npos=.05]{$#3$}
}%

\newcommandtwoopt{\ncmarrr}[7][8][8]{
\ncarc[nodesepB=0,arcangle=#1]{-}{#3}{#6}
\ncline[nodesepB=0]{-}{#4}{#6}
\ncarc[nodesepB=0,arcangle=-#1]{-}{#5}{#6}
\ncarc[nodesepA=0,arcangle=#2]{->}{#6}{#7}
}

\newcommandtwoopt{\ncamarrr}[8][8][8]{
\ncmarrr[#1][#2]{#4}{#5}{#6}{#7}{#8}
\naput[npos=.05]{$#3$}
}
\newcommandtwoopt{\ncbmarrr}[8][8][8]{
\ncmarrr[#1][#2]{#4}{#5}{#6}{#7}{#8}
\nbput[npos=.05]{$#3$}
}


% 6 June 2020
% Edges representing attributes and relationship graphs
%  Ep   - partial
%  Epm  - partial mono
%  Epe  - partial epi
%  Epme - partial mono epi
%  Et   - total
%  Etm  - total mono
%  Ete  - total epi
%  Etme - total mono epi
%  recursive edges (use nccircle)
%  rEp   - partial
%  rEpm  - partial mono
%  rEpe  - partial epi
%  rEpme - partial mono epi
%  rEt   - total
%  rEtm  - total mono
%  rEte  - total epi
%  rEtme - total mono epi

\newcounter{EangleA}
\newcounter{EangleB}
\newcounter{EmidangleA}
\newcounter{EmidangleB}

% Ep - Edge partial
\newcommandtwoopt{\Ep}[4][0][0]{
\crowsfootedEdge{#1}{#2}{#3}{#4}{dashed}{dashed}
}



% Epm - Edge partial mono
\newcommandtwoopt{\Epm}[4][0][0]{
\monoEdge{#1}{#2}{#3}{#4}{dashed}{dashed}
}


% Epe - Edge partial epi
\newcommandtwoopt{\Epe}[4][0][0]{
\crowsfootedEdge{#1}{#2}{#3}{#4}{dashed}{solid}
}

% Epme - Edge partial mono epi
\newcommandtwoopt{\Epme}[4][0][0]{
\monoEdge{#1}{#2}{#3}{#4}{dashed}{solid}
}

% Et - Edge total
\newcommandtwoopt{\Et}[4][0][0]{
\crowsfootedEdge{#1}{#2}{#3}{#4}{solid}{dashed}
}

% Etm - Edge total mono
\newcommandtwoopt{\Etm}[4][0][0]{
\monoEdge{#1}{#2}{#3}{#4}{solid}{dashed}
}

% Ete - Edge total epi
\newcommandtwoopt{\Ete}[4][0][0]{
\crowsfootedEdge{#1}{#2}{#3}{#4}{solid}{solid}
}

% Etme - Edge total mono epi
\newcommandtwoopt{\Etme}[4][0][0]{
\monoEdge{#1}{#2}{#3}{#4}{solid}{solid}
}

% crowsfootedEdge - \crowsfootedEdge[angleA][midpointangle]{startnode}{endnode}[startstyle][endstyle]
\newcommand{\crowsfootedEdge}[6]{
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{3pt}
\setcounter{EangleA}{ #1 + #2}
\setcounter{EangleB}{180  - #1 + #2}
\setcounter{EmidangleA}{#2}
\setcounter{EmidangleB}{#2 + 180}
\nccurve[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,angleA=\theEangleA, angleB=\theEangleB,linestyle=none,linewidth=0]{->}{#3}{#4}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(.075,0)}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(-0.075,0)}
\ncput{\pnode(0,0){xxx}}
\nccurve[nodesepA=0,nodesepB=\sarnodesepB,offsetA=0,offsetB=\saroffsetB,angleA=\theEmidangleA, angleB=\theEangleB, linestyle=#6]{->}{xxx}{#4}
%the following provides context for any following label
\nccurve[nodesepA=\sarnodesepA,nodesepB=0,offsetA=\saroffsetA,offsetB=0,angleA=\theEangleA, angleB=\theEmidangleB,linestyle=#5]{-}{#3}{xxx}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}

% monoEdge - \monoEdge[angleA][midpointangle]{startnode}{endnode}[startstyle][endstyle]
\newcommand{\monoEdge}[6]{ 
\setlength{\sarnodesepAsav}{\sarnodesepA}
\setlength{\sarnodesepBsav}{\sarnodesepB}
\addtolength{\sarnodesepA}{3pt}
\addtolength{\sarnodesepB}{3pt}
\setcounter{EangleA}{ #1 + #2}
\setcounter{EangleB}{180  - #1 + #2}
\setcounter{EmidangleA}{#2}
\setcounter{EmidangleB}{#2 + 180}
\nccurve[nodesepA=\sarnodesepA,nodesepB=\sarnodesepB,offsetA=\saroffsetA,offsetB=\saroffsetB,angleA=\theEangleA, angleB=\theEangleB,linestyle=none,linewidth=0]{->}{#3}{#4}
\ncput{\pnode(0,0){xxx}}
\nccurve[nodesepA=0,nodesepB=\sarnodesepB,offsetA=0,offsetB=\saroffsetB,angleA=\theEmidangleA, angleB=\theEangleB, linestyle=#6]{->}{xxx}{#4}
%the following provides context for any following label
\nccurve[nodesepA=\sarnodesepA,nodesepB=0,offsetA=\saroffsetA,offsetB=0,angleA=\theEangleA, angleB=\theEmidangleB,linestyle=#5]{-}{#3}{xxx}
\setlength{\sarnodesepA}{\sarnodesepAsav}
\setlength{\sarnodesepB}{\sarnodesepBsav}
}


\newcounter{EangleGiven}
\newcounter{EangleComplementary}
\newcounter{EangleStartCorrected}
\newcounter{EangleEndCorrected}


%  rEp   - recursive Edge partial
\newcommand{\rEp}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}                                         
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(.075,0)}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(-0.075,0)}
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% repeat from earlier to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint} 
} 

%  rEpm  - recursive Edge partial mono
\newcommand{\rEpm}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}   
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% last to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint} 
}

%  rEpe  - recursive Edge partial epi
\newcommand{\rEpe}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}                                         
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(.075,0)}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(-0.075,0)}
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% repeat from earlier to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint} 
}

%  rEpme - recursive Edge partial mono epi
\newcommand{\rEpme}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}                                         
%\nccurve[nodesepA=0pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{->}{xxx}{#2}
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% last so that to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black, linestyle=dashed]{-}{#2}{midpoint} 
}

% rEt - recursive Edge total
\newcommand{\rEt}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}                                         
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(.075,0)}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(-0.075,0)}
%\nccurve[nodesepA=0pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{->}{xxx}{#2}
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% repeat from earlier to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint} 
}

%  rEtm  - recursive Edge total mono
\newcommand{\rEtm}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}     
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% last to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint} 
}

%  rEte  - total epi
\newcommand{\rEte}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}                                         
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(.075,0)}
\ncput[nrot=:R,npos=0]{\psline(0,.1)(-0.075,0)}
%\nccurve[nodesepA=0pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359, linestyle=dashed]{->}{xxx}{#2}
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% repeat from earlier to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint} 
}

%  rEtme - recursive Edge total mono epi

\newcommand{\rEtme}[2][0]{
\setcounter{EangleGiven}{#1}
\setcounter{EangleStartCorrected}{#1-10} %correction required because for nccurve unlike nccircle angle measured at boundary not at centre of node
\setcounter{EangleEndCorrected}{#1+180+10} %correction required because angle measured at boundary not at centre of node
\setcounter{EangleComplementary}{#1 + 180}
\nccircle[angleA=\theEangleComplementary, nodesep=0pt, linestyle=none]{-}{#2}{.4cm} % an invisible circle to hang the midpoint from
\ncput{\pnode(0,0){midpoint}}     
\nccurve[nodesepA=0pt,nodesepB=2pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleComplementary, angleB=\theEangleEndCorrected, ncurv=1.359]{-}{midpoint}{#2}
% 1.359 is e/2 happenchance or algorithmically necessary???
% now draw arrowhead -- dont include in the nccurve because this alters the line position - a strange feature of pstruicks
\ncput[npos=0.9]{\pnode(0,0){yyy}}
\ncline{->}{yyy}{#2}
% last to provide context for label that might follow
\nccurve[nodesepA=1pt,nodesepB=0pt,offsetA=0pt,offsetB=0pt,angleA=\theEangleStartCorrected, angleB=\theEangleGiven, ncurv=1.359, linecolor=black]{-}{#2}{midpoint} 
}
