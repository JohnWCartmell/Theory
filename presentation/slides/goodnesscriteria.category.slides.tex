\documentclass[xcolor=pst,dvips]{beamer}   %, handout

\usepackage{mathptmx}
\usepackage{amsfonts}
\usepackage{wasysym}
\usepackage{url}
\usepackage{hyperref}

\newcommand{\sharedmacros}{../../SharedMacros}
%\input{\sharedmacros/general.macros}    %causes problems when used with bamer
\input{\sharedmacros/ccategories.macros}
\input{\sharedmacros/gats.macros}
\input{\sharedmacros/metagat.macros}
\input{\sharedmacros/ermacros}
\input{\sharedmacros/erdiagram}    %beamer aware version
\input{../macros/generalmacros}
\input{../macros/othermacros}

\renewcommand{\erpictureFolder}[0]{../../SharedPictures}


\usetheme{Szeged}
\usecolortheme{dolphin}

%\setbeamertemplate{navigation symbols}{}

\setcounter{equation}{0}

\title[John Cartmell]{Mathematical Theory of Data \\ -- Goodness Criteria}
%% Which is to say types as they are used in practice in software development and as represented in theory in categories and in syntactic type theories.
%% There is also a subplot concerning representation of context which certain types depend on -- again represented in practice and in theory. 
\author{John Cartmell}
\institute{ad otium}
\date{Jan 25, 2019}
\bibliographystyle{plainnat}
\usepackage{bibentry}
\nobibliography*




\begin{document}


\begin{frame}
\titlepage
\end{frame}

\iffalse
\begin{frame}{Introduction}
\begin{itemize}
\item
What types of things are there and how are they related? 
\begin{itemize}
\pause \item Data specifications provide the answer to this question in the context of a software development. 
\pause \item Types theories provide the answer in the context of mathematics. 
\pause \item Category theory abstracts across both these domains.
\end{itemize}
\end{itemize}
\end{frame}
\fi

\begin{frame}{Data Specification}
A \textit{data specification} is a sketch $S$ for some kind of structured category \catc.
i.e. it is a directed graph plus some path equivalences (diagrams in other words) plus 
some additional structure.  

An \textit{instance} of a data specification is a mapping $D$ from the directed graph
to the category of sets and functions which preserves structure so as
to induce a structure preserving functor $D: \catc \morph \Fin$.
\end{frame}

\begin{frame}{The Requirement}
A \textit{requirement} for a data specification $S$ 
is a set of instances of the sketch $S$ or, equivalently, is a set $R_C$ of functors where for each
$D \in R_C$, $D: \catc \morph \Fin$, where \catcw is the category generated by the sketch $S$.
\end{frame}

\section{Goodness Criteria}
\begin{frame}{Goodness Criteria of Type 1}
\begin{itemize}
\item Goodness Criteria of Type 1 : No redundancy. The sketch $S$ ought to be a minimum sketch for structured
category \catcw i.e. there should be no subsketch of $S$ which generates  \catc.
\pause{
\item Rationale: Follow software engineering principles:
\begin{itemize}
\item Ensure there is no redundancy in the  data that is stored and/or communicated.
\item Avoid duplicate program logic.
\end{itemize} 
}
\end{itemize}
\end{frame}

\begin{frame}{Goodness Criteria of Type 2}
The structured category \catcw ought to be the tightest possible fit to the requirement $R_{\catc}$.

The question -- is there a $\catcp$ that extends \catcw and that will do a better job. 

Look for a $\catcp$ and an $I: \catc \morph \catcp$  such that 
all instances in the requirement factor though $I$
but some other instances of \catcw do not factor through $I$. 
Such a $\catcp$, as a theory, will be a tighter fit to the given requirement 
because it will rule out some unwanted instances.
\end{frame}


\begin{frame}
\begin{definition}
Define \catcw to be \textit{maximally constrained} to the requirement $\reqtc$ iff 
for all structured categories $\catcp$ 
and for all structure preserving functors $I:\catc \morph \catcp$ 
satisfying that for all functors $D \in \reqtc$ 
there exists a  unique $D' : \catcp \morph \Fin$ such that $Z \circ D'=D$,
then for all functors $F: \catc \morph \Fin$  
there exists an $F' : \catcp \morph \Fin$ such that $I \circ F'=F$.
\end{definition}

\textbf {Goodness Criteria 2:} \IfSforCwithRCwordsvariant then \catcw ought to be maximally constrained to $\reqtc$.
\end{frame}

\begin{frame}{Rationale for Type 2 Criteria}
\begin{itemize}
\item Good data modelling is good theorising and good theorising is having the tightest theory that fits the facts.
\item Software Engineering: 
\begin{itemize}
\item Document the requirement.
\item Validate data against the requirement. 
\item Restrict degrees of freedom in the data representation.
\item Use declarative style if possible.
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}
\begin{definition}
If $\catc$ is a  category and $\reqtc$ is a set of instances,
 then say that  $\catc$ is \term{logically complete} with respect 
to the requirement $\reqtc$ iff all path equivalences with respect to $R_C$ are represented in \catcw 
i.e. iff for all diagrams \fgparalleldiag in $\catc$,  
if in all instances $D \in \reqtc$, $D(f)=D(g)$,  then $f=g$.
\end{definition}

In other words:
the set of functors $\reqtc$ is jointly faithful.

\textbf{Goodness Criteria 2A:} \IfSforCwithRCwords then \catcw ought to be logically complete
with respect to $R_C$.
\end{frame}

\begin{frame}{Does Criteria 2A follow from Criteria 2?}
It does if we assume local finiteness of \catc:
\begin{lemma}[Path Equivalence Representation Lemma]
If $\catc$ is a locally finite category and $\reqtc$ is a set of instances, if $\catc$ 
meets criteria 2 that is if it is
\textit{maximally constrained} to the requirement $\reqtc$ then it meets criteria 2A 
i.e. for all diagrams
$
\rule[-0.3cm]{0pt}{0.9cm} %to add vertical space of diagram -- based on lowering diagram 0.3cm and heght 0.9cm
                            % change thickness from 0pt to 1 pt to debug
\begin{array}{c p{0.5cm} c  }
 \Rnode{a}{a}            &&   \Rnode{b}{b}
\end{array} 
$
\ncarc[nodesep=2pt,arcangle=10,offset=2pt]{->}{a}{b}
\alabel{f}
\ncarc[nodesep=2pt,arcangle=-10,offset=-2pt]{->}{a}{b}
\blabel{g}
in $\catc$,  if in all instances $D \in \reqtc$, $D(f)=D(g)$, 
then $f=g$ in $\catc$.
\end{lemma}
\begin{proof}
Define $\catcp$ to be \catc plus $f=g$. Consider the Hom functor $Hom_{\catc}(a,\_)$. 
This is an instance of $\catc$ which must therefore be an instance of $\catcp$ and thus 
we must have that $f=g$ in \catc. 
\end{proof}
\end{frame}

\begin{frame}{Does Criteria 2A follow from Criteria 2 -- Not always}
Suppose \catcw is the category generated by the sketch with directed graph
\input{../content/frompreparationpaper/completenesscounterexample}
subject to the identities
\begin{equation}
\label{fhidentity}
f \circ h = id_a,
\end{equation}
\begin{equation}
\label{ghidentity}
g \circ h = id_a,
\end{equation}
\begin{equation}
\label{rhhpidentity}
r \circ h \circ h' = id_b.
\end{equation}
We can show that for any functor $D:\catc \morph Fin$, $D(f)=D(g)$. 

If $R_C$ is the set of all functors from \catcw into $\Fin$ then with respect to $\reqtc$, Criteria 2 holds but Criteria 2A does not.
\end{frame}

\subsection{Functional Dependencies}
\begin{frame}{Functional Dependencies}
\begin{itemize}
\item define what we mean by \term{functional dependency}
-- abstracted and simplified from definition given by Codd 1971
\item define what we mean by a functional dependency being \term{represented}
-- abstracted from Zaniolo 1982
\item state Goodness Criteria 2B - all functional dependencies are represented -- which I think is Zaniolo's formulation 
\end{itemize}
\end{frame}

\begin{frame}
\begin{definition}
If \fgsourcediag in a category \catcw  and if $\reqtc$ is a set of instances of \catcw
then we say that there is a  \term{functional dependency} of $g$ on $f$ with respect to $\reqtc$ iff
for every $D \in \reqtc$, $D(g)$ factors through $D(f)$ \\
\medskip
i.e. there is a family of functions $H_D:D(b) \morph D(c))_{D \in \reqtc}$
such that in each instance $D \in \reqtc$,
\fghfactordiagram{D(a)}{D(b)}{D(c)}{D(f)}{D(g)}{H_D} commutes.
\end{definition}

If $H$ is such a functional dependency then we say that $\fundep{H}{f}{g}$ in $\catc$ with respect to $\reqtc$.
\end{frame}

\begin{frame}
Our use of the $\morph$ notation 
$$
f \morph g
$$
for functional dependency is taken from relational database theory. 

This use of $\morph$ notation is independent of our use of $\morph$ as a morphism of a category 
or, for that matter, as an edge in a presentation. Neither are we aimimg at a bicategory structure. 
We have two distinct uses for $\morph$ (three if you count the use as edges of directed graphs). 
\end{frame}

\begin{frame}
\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances, 
if \fgsourcediag in $\catc$ 
and if there is a functional dependency $\fundep{H}{f}{g}$ then say that 
this functional dependency  is \term{represented} in $\catc$ 
iff there exists a morphism $h:b \morph c$ in $\catc$ such that for each instance $D \in \reqtc$, $D(h)=H_D$.
\end{definition}
\end{frame}


\begin{frame}{Representation Lemma for Functional Dependencies}
I can prove this only in the case that \catcw is locally finite.

\begin{lemma}
If $\catc$ is a locally finite category and $\reqtc$ is a set of instances, if $\catc$ is 
\textit{maximally constrained} to the requirement $\reqtc$ then
if $\fundep{H}{f}{g}$  is a functional dependency with respect to $\reqtc$
such that in all instances $D \in \reqtc$, $D(f)$ is surjective,
then $\fundep{H}{f}{g}$ is represented in $\catc$.
\end{lemma}
\begin{proof}
Extend \catcw to $\catcp$ by formally adding a morphism $h$. Extend each $D$ to a $D'$ by defining $D(h)=H_D$. 
Because $D(f)$ is surjective $D'$ is unique. 
Define a functor from \catcw to $\Fin$ as  a certain quotient of the coproduct of functor $Hom_{\catc}(a,-)$ with itself.
Extend to $\catcp$ and demonstrate that there exists $k:b \morph c$ in \catcw such that $f \circ k=g$. 
\end{proof}
\end{frame}

\subsection{Referential Inclusion Dependencies}
\begin{frame}
\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances 
and if
\fnsourceqnsource
in $\catc$, then an \term{inclusion dependency} $I$, written $a[f_1,...f_n] \overset{I}{\subseteq} c[q_1,..q_n]$, is a family of functions $I_D)_{D \in \reqtc}$
such that each instance $D \in \reqtc$, $I_D$ is a function $I_D : D(a) \morph D(c)$ such that
for each $i$, $1 \leq i \le n$, $I_D \circ D(q_i) = D(f_i)$.
\end{definition}

If each function in this family is the unique such function then the inclusion dependency is said to be referential. Just to be clear the definition is this:
\end{frame}

\begin{frame}
\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances 
and if
\fnsourceqnsource
in $\catc$, then a \term{referential inclusion dependency} $I$, written $a[f_1,...f_n] \overset{I}{\subseteq} c[q_1,..q_n]$, is a family of functions $I_D)_{D \in \reqtc}$
such that each instance $D \in \reqtc$, $I_D$ is a unique function $I_D : D(a) \morph D(c)$ such that
for each $i$, $1 \leq i \le n$, $I_D \circ D(q_i) = D(f_i)$.
\end{definition}
\end{frame}

\begin{frame}
\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances and if
\fnsourceqnsource
in $\catc$ and if $a[f_1,...f_n] \overset{I}{\subseteq} c[q_1,..q_n]$ is a referential inclusion dependency
with respect  to $\reqtc$ then say that the inclusion dependency $I$ is \term{represented} in $\catc$
iff there exists a morphism $i:a \morph c$ in $\catc$ such that in each instance $D \in \reqtc$, $D(i) = I_D$. 
\end{definition}
\end{frame}

\begin{frame}
\textbf {Goodness Criteria 2C:} \IfSforCwithRCwords 
then all referential inclusion dependencies present in $R_C$
ought to be be represented in \catc.

I would like to show that this goodness criteria follows from the criteria of maximal constrainedness
but I have only managed to prove this in the case that \catcw is locally finite.
\end{frame}

\begin{frame}
\begin{lemma}[Referential Inclusion Dependency Representation Lemma]
If $\catc$ is a locally finite category and $\reqtc$ is a set of instances, if $\catc$ is 
\textit{maximally constrained} to the requirement $\reqtc$ then
every referential inclusion dependency with respect to $\reqtc$ is represented in $\catc$.
\end{lemma}
\end{frame}

\begin{frame}{Finitary Property}
\begin{definition}
Define a category \catcw to have the \term{finitary property} iff for all objects $x$ and for all endomorphisms 
$f: x \morph x$ the following are equivalent
\begin{itemize}
\item $f$ is a monomorphism,
\item $f$ is an epimorphism.
\end{itemize}
\end{definition}
\end{frame}

\begin{frame}{Deducing Monos and Epis}
In any category \catcw, whenever \fgcomposablediagram{x}{y}{z}{f}{g} then
\begin{itemize}
\item $f \circ g$ is a monomorphism implies $f$ is a monomorphism.
\item $f \circ g$ is an epimorphism implies $g$ is an epimorphism.
\end{itemize}
\medskip
If \catcw has the \term{finitary property} then whenever \fgcomposablediagram{x}{x}{x}{f}{g} 
such that $f \circ g = id_x$ then
\begin{itemize}
\item $f$ is a monomorphism and an epimorphism,
\item $g$ is a monomorphism and an epimorphism.
\end{itemize}
\end{frame}

\begin{frame}
Now return to this example.
\input{../content/frompreparationpaper/completenesscounterexample}
subject to the identities
\begin{equation}
\label{fhidentity}
f \circ h = id_a,
\end{equation}
\begin{equation}
\label{ghidentity}
g \circ h = id_a,
\end{equation}
\begin{equation}
\label{rhhpidentity}
r \circ h \circ h' = id_b.
\end{equation}

If we see this as a sketch for a category with the finitary property then we can deduce that $h$ is an epimorphism
and from this that $f=g$.  It is no longer a counter example (to criteria 2 implies criteria 2A).
\medskip
I am left wondering ...  
\end{frame}

\iffalse
\begin{frame}{Bibliography}
\bibliography{../../SharedBibliography/temp/bibliography}
\end{frame}
\fi

%\fi

\end{document}