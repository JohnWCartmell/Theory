


\begin{frame}{Definition}
\begin{itemize}
\item A \term{\catMEterm} is a triple $\tuple{\catc,M,E}$ where 
\begin{itemize}
\item \catcw is a category,
\item $M$ is a set of designated monomorphisms of \catcw closed under composition and including all identity morphisms,
\item $E$ is a set of designated epimorphisms of \catcw closed under composition and including all identity morphisms.
\end{itemize}
\item Define an instance $F$ of a \catMEterm to be a functor $F: \catc \morph \Fin$ 
that preserves the designated monomorphisms and epimorphisms.

%Note that \catcw may well have other monomorphisms and epimorphisms but these need not be preserved by an instance $F$.

\item A sketch for a \catMEterm is a 4-tuple $\tuple{G,PE_0,M_0,E_0}$ ...
\begin{itemize}
 \item   $M_0$ and $E_0$ are sets of $G$-paths  
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{Goodness Type 1 Criteria}
\medskip
\goodnessoneA.
\medskip
\goodnessoneB.

\goodnessoneC. \\
\medskip
\goodnessoneD. \\
\medskip

Definition of closure of set of monomorphics includes
\begin{itemize}
\item $f \in \overline{M}$ and $g \in \overline{M}$ then $f \circ g \in \overline{M}$
\item $f \circ g \in \overline{M}$ then $f \in \overline{M}$
\end{itemize}
and to which we might add the rule that expresses the finitary property.
\end{frame}


\begin{frame}{Revised Definition of Functional Dependency}
\begin{definition}
If \scalebox{0.9}{\fgsourcediagram} in a \catMEterm \catcw  and if $\reqtc$ is a set of instances of \catcw
then we say that there is a  \term{functional dependency} of $g$ on $f$ with respect to $\reqtc$ iff
for every $D \in \reqtc$, $D(g)$ factors through $D(f)$. \\
\medskip
\pause Equivalently there is a family of  functions $H_D:img(D(f)) \morph D(c))_{D \in \reqtc}$
such that in each instance $D \in \reqtc$,
\scalebox{0.9}{\fghfactordiagram{\roomup{0.4cm}\roomdown{0.3cm}D(a)}{img(D(f))}{D(c)}{D(f)}{D(g)}{H_D}} commutes.
\end{definition}

\end{frame}

\newcommand{\representationdiagram}{
\newcommand{\myspacing}{0.15cm}
$
\begin{array}{c p{1.25cm} c c p{0.5cm} c}
            && \Rnode{b}{b}&                &&                \\[\myspacing]
            &&             &                &&\Rnode{d1}{d_1} \\[\myspacing]
            &&             &\Rnode{b1}{b_1} &&                \\[\myspacing]
            &&             &                &&\Rnode{d2}{d_2} \\[\myspacing]
\Rnode{a}{a}&&             &\Rnode{b2}{b_2} &&                \\ %\multirow{2}{5pt}{\vdots}   \\
            &&             &\vdots          &&\vdots          \\
            &&             &\Rnode{bnp}{b_{n-1}} &&           \\[\myspacing]
            &&             &                &&\Rnode{dn}{d_n} \\[\myspacing]
            && \Rnode{c}{c}  
\end{array}
\begin{arrows}
\ncarr[3]{a}{b}\alabel{f}
\ncarr[-3]{a}{c}\blabel{g}
\ncarr[-5]{d1}{b}\blabel{q_1}[0.35]\idcomp
\ncarr{d1}{b1}\blabel{h_1}
\ncarr{d2}{b1}\blabel{q_2}[0.35]\idcomp
\ncarr{d2}{b2}\blabel{h_2}
\ncarr{dn}{bnp}\blabel{q_n}[0.35]\idcomp
\ncarr[5]{dn}{c}\alabel{h_n}
\end{arrows}
$
}

\newcommand{\mappedrepresentationdiagram}{
\newcommand{\myspacing}{0.25cm}
$
\begin{array}{ c p{0.2cm} c p{0.5cm} c}
\Rnode{Imgf}{Img(D(f))} && \Rnode{b}{D(b)}   &&                   \\[\myspacing]
                        &&                   &&\Rnode{d1}{D(d_1)} \\[\myspacing]
                        &&\Rnode{b1}{D(b_1)} &&                   \\[\myspacing]
                        &&                   &&\Rnode{d2}{D(d_2)} \\[\myspacing]
                        &&\Rnode{b2}{D(b_2)} &&                   \\ %\multirow{2}{5pt}{\vdots}   \\
                        &&\vdots             &&\vdots             \\
                        &&\Rnode{bnp}{d(b_{n-1})} &&           \\[\myspacing]
                        &&                   &&\Rnode{dn}{D(d_n)} \\[\myspacing]
\Rnode{c}{D(c)}  
\end{array}
\begin{arrows}
\ncline{H->}{Imgf}{b}
\ncarr{Imgf}{c}\alabel{H_D}
\ncarr[5]{b}{d1}\alabel{D(q_1)^{-1}}[0.5][-3]
\ncarr{d1}{b1}\blabel{D(h_1)}[0.5][-1]
\ncarr{b1}{d2}\alabel{D(q_2)^{-1}}[0.5][-3]
\ncarr{d2}{b2}\blabel{D(h_2)}[0.5][-1]
\ncarr{bnp}{dn}\alabel{D(q_n)^{-1}}[0.5][-3]
\ncarr[5]{dn}{c}\alabel{D(h_n)}[0.5][-1]
\end{arrows}
$
}

\begin{frame}{Definition of Representation of FDs in Category with Designated Monomorphisms}
If $\fundep{H}{f}{g}$ is such a  functional dependency 
then $H$  is \term{represented} in $\catcw$ 
\begin{tabular} {c c}
\multicolumn{1}{p{3.5cm}}{iff there exits} 
                    & \multicolumn{1}{p{4.1cm}}{\onslide<2->{such that for each $D \in \reqtc$}}\\
\scalebox{0.9}{\representationdiagram} 
                    & \onslide<2->{\scalebox{0.85}{\mappedrepresentationdiagram}}               \\
                    & \multicolumn{1}{r}{\onslide<2->{commutes.}}
\end{tabular}
\end{frame}


\begin{frame}{First Sublemma}
\highlight{DONT think this is whorthwhile showing anymore}
\begin{lemma}
If \catcw is a \catMEterm with a finite sketch and if $f$ is any  morphism 
not having an epi-mono factorisation then \catcw can be extended to a category $\catcp$ with finite sketch so that
\begin{itemize} 
\item $f$ has an epi-mono factorisation \factorisationfdiagram in $\catcp$,
\item every morphism $h:im(f) \morph x$ in $\catcp$ factors through $f_m$,
\item every instance of \catcw uniquely extends, upto isomorphism, to an instance of $\catcp$,
\item \catcw is maximally constrained to $\reqtc$ iff $\catcp$ is maximally constrained to $\reqtc$ (extended to $\catcp$).
\end{itemize} 
\end{lemma} 
\end{frame}

\begin{frame}{Second Sublemma}
\highlight{Rename "Sublemma"}
If \catcw is a category with designated epimorphisms then let its split category 
$\catc_s$ be the category \catcw with an additional split morphism for every designated epimorphism.
i.e. for every designated epimorphism $f: a \morph b$ we add a morphism $f_s:b \morph a$
such that $f_s \circ f = id_B$. \\
\medskip
If \catcw is a category with designated monomorphisms and epimorphsims and its split category
is locally finite, if $F: \catcw \morph \Fin$ is a functor which preserves designated monomorphisms
then there is an $F':\catcw \morph Fin$ that preserves designated monomorphisms and epimorphisms
and that extends $F$ i.e. such that $F \hookrightarrow F'$ in the functor category $\Fin^{\catc}$.
\end{frame}

\begin{frame}{Proof of Second SubLemma}
\highlight{Rename "Proof of Sublemma"}
Hand wavy proof as follows:
There is an inclusion functor $I_s:\catc \morph \catc_s$.

Extend $F:\catcw \morph \Fin$ along this inclusion functor  to get a functor 
$F_s:\catc_s \morph \Fin$ and a natural transformation $F \hookrightarrow I_s \circ F_s$. \\
\medskip
Nature of the construction is such that $F_s$ preserves designated monomorphisms because $F$ does.\\
\medskip
$F_s$ preserves designated epimorphisms since any functor preserves split epimorphisms.
Define $F'$ to be $I_s \circ F_s$.
\end{frame}

\begin{frame}{Representation Lemma for FDs}
{\small Note: I can prove this only in the case that \catcw is locally finite.

No longer restricted to the case that each $D(f)$ is surjective.}

\begin{lemma}
If \catcw is a category with designated monomorphisms and epimorphsims and its split category
is locally finite and if \catcw is
\textit{maximally constrained} to a requirement $\reqtc$ then
if $\fundep{H}{f}{g}$  is a functional dependency with respect to $\reqtc$
then $\fundep{H}{f}{g}$ is represented in $\catc$.
\end{lemma} \highlight{Get rid of this proof -- need cut and paste somewhere I can later find it}
\highlight{Also copy later into key result.}
\begin{proof} Extend \catcw to \catcpw so that $f$ has an epi-mono factorisation in \catcpw
and so that there  is a morphism $\qq{h}$ such that
\scalebox{0.9}{\unaryfdrepresentationdiagram{\roomup{0.6cm}\roomdown{0.4cm}a}{b}{c}{f}{g}{im(f)}{f_m}{\qq{h}}$
\begin{arrows}\ncarr{a}{d}\alabel{f_e}\end{arrows}$} 
commutes in \catcp.  
\end{proof}
\end{frame}

\begin{frame}{Proof cont. 1}
We have \fgsourcediagram in \catc.\\
\medskip
Define functor $F: \catc \morph \Fin$ be the coproduct $Hom_{\catc}(a,-) + Hom_{\catc}(a,-)$
as previously with injections $L$ and $R$, respectively so that
for each object $x$ of \catcw the diagram
\begin{center}
$
\begin{array}{c p{0.5cm} c p{0.5cm} c  }
\Rnode{h1}{Hom_{\catc}(a,x)}  &&\Rnode{Fx}{F(x)}  &&   \Rnode{h2}{Hom_{\catc}(a,x)}       
\end{array} 
$
\ncarr{h1}{Fx}
\alabel{L_x}
\ncarr{h2}{Fx}
\blabel{R_x}
\end{center}
is a coproduct in $\Fin$.
\medskip
Define $G: \catc \morph \Fin$ as quotient $F/\sim$ where 
to ensure $G$ preserves designated monomorphisms  $\sim$ is defined as follows
\begin{align*}
L_x(k_1) \sim_x R_x(k_2) & \mbox{ \parbox{6cm}{iff  $k_1=k_2$ and there is a functional dependency 
$f \morph k_1$ in \catcw with respect to $\reqtc$ and  this functional dependency is represented in \catc.}}\\
L_x(k_1) \sim_x L_x(k_2) & \mbox{ iff $k_1 = k_2$,} \\
R_x(k_1) \sim_x R_x(k_2) & \mbox{ iff $k_1 = k_2$.} \\
\end{align*} 
\end{frame}

\begin{frame}{Proof cont 2.}
We have \simpleunaryfdrepresentationdiagram{a}{Im(f)}{c}{f_e}{g}{\qq{h}}  in \catcp.\\
\medskip
Extend $G$ to $G':\catcp \morph \Fin.$ \\
Because $f_m$ is a designated monomorphism and $f_e \circ f_m = f$ then
there is a representation of functional dependency $f \morph f_e$ in \catc.
Hence  we have that $[L_b(f_e)]= [R_b(f_e)]$.
\medskip
\begin{align*}
&\mbox{i.e.}& G'(f_e)([L_a(id_a)])              &= G'(f_e)([R_a(id_a)])       \\
&\therefore & G'(\qq{h}) (G'(f_e)([L_a(id_a)])) &= G'(\qq{h}) (G'(f_e)([R_a(id_a)])) \\
&\therefore & G'(g)([L_a(id_a)])              &= G'(g)([R_a(id_a)]) & &    \\
&\therefore & [L_c(g)] &= [R_c(g)] 
\end{align*}
Therefore by definition of $\sim$ the functional dependency
$\fundep{H}{f}{g}$ is represented in $\catc$.
\end{frame}

\begin{frame}{Epi Mono Type 2 Goodness Criteria}
From local finiteness and maximal constrainedness it follows that all the following goodness criteria hold: 
\begin{itemize}
\item \textbf{2A}:  \catcw ought to be equationally complete wrt $\reqtc$,         
\item \textbf{2B}:  all $\reqtc$ functional depedencies ought to be represented in \catc,
\item \textbf{2C}:  all $\reqtc$ referential inclusion dependencies ought to be represented in \catc, 
\pause \item \textbf{2D}:  if $f$ is injective in every $D \in \reqtc$ then $f$ ought to be a designated monomorphism in \catc,
\pause \item \textbf{2E}:  if $f$ is surjective in every $D \in \reqtc$ then $f$ ought to be a designated epimorphism in \catc.
\end{itemize}
We can also show that \textbf{2B} can be weakened. If all functional dependencies \textbf{upon edges} from sketch $S$ are represented then 
all functional dependencies are represented. \highlight{Too much information}
\end{frame}

\begin{frame}{Obtaining BCNF}
Tp proceed further 
\begin{itemize}
    \item I need work with categories \catcw with designated monomorphisms and epimorphisms
    and epi-mono splits 
    \item I need assume that \catcw is maximally constrained to $\reqtc$ 
    amongst other categories with designated monomorphisms and epimorphisms
    \item I also need assuume that the the underlying category is 
    maximally constrained to $\reqtc$
\end{itemize}
\highlight{CONTINUE FROM THIS POINT}

\medskip
\goodnesscriteria{2B'} Whenever \fgsourcediagram in \catc and  $f$ is a designated epimorphism, if
$f \morph g$ is a functional dependency  wrt $\reqtc$ then there ought to exist a morphism
$h: b \morph c$ in \catcw such that
\simpleunaryfdrepresentationdiagram{a}{b}{c}{f}{g}{h}
commutes.
\end{frame}

\begin{frame}{Tellingly...}
We can show that if
 goodness criteria 2A,  2B' and 2C are met then 
\begin{itemize}
\item If $f$ and $g$ are edges of a sketch of category \catcw 
with designated monomorphisms and epimorphims and if $\fundep{H}{f}{g}$ is a non-trivial  functional dependency wrt set of instances $\reqtc$ then $f$ is a monomorphism. 

\item This moves us into sight of the goal of "explaining the Boyce-Codd Normal Form (BCNF) criteria from first principles". \highlight{Somewhere need to state BCNF.}

\item We cannot obtain this result without Criteria 2B' -- Criteria 2B alone is insufficient.

\item To get closer to BCNF we need add finite products to the mix.
\end{itemize}
\end{frame}
