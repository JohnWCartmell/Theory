%\documentclass[prodmode,acmtods]{acmsmall}
\documentclass[10pt,a4paper]{article}
\input{../SharedMacros/ccategories.macros}
\input{../SharedMacros/ermacros}
\input{../SharedMacros/erdiagram}
\input{../SharedMacros/theorems.macros}
\usepackage{mathptmx}  % This changes font to roman
\usepackage{anyfontsize}
\usepackage{mathtools}  % why have we got this?
\usepackage{alltt}    
\usepackage{mnsymbol} %used for rightpitchfork
\usepackage{cmll}
\usepackage{ulem}
\renewcommand{\ttdefault}{txtt}
\usepackage[left=1.5cm, right=4cm, marginparwidth=3cm, top=2cm, bottom=1.5cm]{geometry}
\usepackage[font=small]{caption}
\setlength{\captionmargin}{2cm}
\renewcommand{\erpictureFolder}[0]{../SharedPictures}
\newcommand{\simplepath}[2]{
\ncline[linestyle=dotted,linewidth=0.1pt]{#1}{#2}
\ncput[npos=0.05]{\pnode{dot#21}}
\ncput[npos=0.27]{\dotnode[dotsize=1pt]{dot#22}}
\ncput[npos=0.50]{\dotnode[dotsize=1pt]{dot#23}}
\ncput[npos=0.80]{\dotnode[dotsize=1pt]{dot#24}}
\ncput[npos=0.975]{\pnode{dot#25}}
\ncline[nodesep=3pt]{->}{dot#21}{dot#22}
\ncline[nodesep=3pt]{->}{dot#22}{dot#23}
\ncline[nodesep=3pt]{->}{dot#24}{dot#25}
\ncline[linestyle=dotted,nodesep=10pt]{dot#23}{dot#24}
}

\newcommand{\simplepatha}[3]{
\simplepath{#2}{#3}
\naput[labelsep=1pt]{#1}
}

\newcommand{\simplepathb}[3]{
\simplepath{#2}{#3}
\nbput[labelsep=1pt]{#1}
}
\newcommand{\term}[1]{\textit{{#1}}}

\newcommand{\logtophys}{\mathcal{X}}

\newcommand{\chengenericmodel}{\chen(\genericmodel)}
\newcommand{\chigenericmodel}{\logtophys(\genericmodel)}
\newcommand{\allEdges}{\genericmodel^E}
\newcommand{\allAttrs}{\genericmodel^A}
\newcommand{\allRels}{\genericmodel^R}
\newcommand{\edges}[1]{\allEdges_{#1}}
\newcommand{\attrs}[1]{\allAttrs_{#1}}
\newcommand{\rels}[1]{\allRels_{#1}}
\newcommand{\allIdentifying}{\genericmodel^{iE}}
\newcommand{\allIdAttrs}{\genericmodel^{iA}}
\newcommand{\allIdRels}{\genericmodel^{iR}}
\newcommand{\idEdges}[1]{\allIdentifying_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\idAttrs}[1]{\allIdAttrs_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\idRels}[1]{\allIdRels_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\allMandatory}{\allEdges^m}
\newcommand{\allMAttrs}{\allAttrs^m}
\newcommand{\allMRels}{\allRels^m}
\newcommand{\mEdges}[1]{\allIdentifying_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\mAttrs}[1]{\allIdAttrs_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\mRels}[1]{\allIdRels_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\chenAttrs}[1]{\chen(\genericmodel)^A_{#1}}
\newcommand{\chenFKattrs}[1]{\chen(\genericmodel)^{A+}_{#1}}
\newcommand{\chenIdAttrs}[1]{\chen(\genericmodel)^{iA}_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\chenFKidAttrs}[1]{\chen(\genericmodel)^{iA+}_{\raisebox{2pt}{$\scriptstyle{#1}$}}}

\newcommand{\chiTwo}{\mathcal{X}_2}
\newcommand{\chiOneFKs}[1]{\chiOne(\genericmodel)^{A+}_{#1}}
\newcommand{\chenFKclasses}[1]{\chiTwo(\genericmodel)^{A+}_{#1}}
\newcommand{\chenFKidClasses}[1]{\chiTwo(\genericmodel)^{iA+}_{#1}}
\newcommand{\chiAttrs}[1]{\logtophys(\genericmodel)^A_{#1}}
\newcommand{\chiFKattrs}[1]{\logtophys(\genericmodel)^{A+}_{#1}}
\newcommand{\chiIdAttrs}[1]{\logtophys(\genericmodel)^{iA}_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\chiFKidAttrs}[1]{\logtophys(\genericmodel)^{iA+}_{\raisebox{2pt}{$\scriptstyle{#1}$}}}
\newcommand{\Vtype}{v}
\newcommand{\idAttrsDep}[1]{\allIdentifying_{p_#1}}
\newcommand{\idAttrsFromRefs}[1]{\bigcup_{r \in \idRels{#1} }{\srcattrs{r}}}
\newcommand{\destattrs}[1]{\mathbb{D}_{#1}}
\newcommand{\srcattrs}[1]{\mathbb{S}_{#1}}


\begin{document}

%from berkley
\newcommand{\langl}{\begin{picture}(4.5,7)
\put(1.1,2.5){\rotatebox{60}{\line(1,0){5.5}}}
\put(1.1,2.5){\rotatebox{300}{\line(1,0){5.5}}}
\end{picture}}
\newcommand{\rangl}{\begin{picture}(4.5,7)
\put(.9,2.5){\rotatebox{120}{\line(1,0){5.5}}}
\put(.9,2.5){\rotatebox{240}{\line(1,0){5.5}}}
\end{picture}}
\newcommand{\lang}{\begin{picture}(5,7)
\put(1.1,2.5){\rotatebox{45}{\line(1,0){6.0}}}
\put(1.1,2.5){\rotatebox{315}{\line(1,0){6.0}}}
\end{picture}}
\newcommand{\rang}{\begin{picture}(5,7)
\put(.1,2.5){\rotatebox{135}{\line(1,0){6.0}}}
\put(.1,2.5){\rotatebox{225}{\line(1,0){6.0}}}
\end{picture}}
%Try sharper tuple brackets
\renewcommand{\tuple}[1]{\lang #1 \rang}

\newcommand{\genericmodel}{\mathcal{M}}
\renewcommand{\genericmodel}{{m}}
\newcommand{\chiZero}{\mathcal{X}_0}
\newcommand{\chiZeroM}{\chiZero(\genericmodel)}
\newcommand{\chiOne}{\mathcal{X}_1}
\newcommand{\chiOneM}{\chiOne(\genericmodel)}
\newcommand{\chiM}{\mathcal{X}(\genericmodel)}
\newcommand{\veee}{v}
\newcommand{\et}[1][\genericmodel]{et_{#1}}
\newcommand{\edge}[3][\genericmodel]{Edge_{#1}(#2,#3)}
\newcommand{\iedge}[3][\genericmodel]{IEdge_{#1}(#2,#3)}
\newcommand{\path}[3][\genericmodel]{Path_{#1}(#2,#3)}
\newcommand{\ipath}[3][\genericmodel]{IPath_{#1}(#2,#3)}
\newcommand{\attr}[2] [\genericmodel]{attr_{#1}(#2)}
\newcommand{\iattr}[2] [\genericmodel]{IAttr_{#1}(#2)}
\newcommand{\rel}[3][\genericmodel]{rel_{#1}(#2,#3)}
\newcommand{\irel}[3][\genericmodel]{IRel_{#1}(#2,#3)}
\newcommand{\pk}[2] [\genericmodel]{pk_{#1}(#2)}
\newcommand{\fk}[2] [\genericmodel]{fk_{#1}(#2)}
\newcommand{\fkp}[2] [\genericmodel]{fk'_{#1}(#2)}
\newcommand{\fkpp}[2] [\genericmodel]{fk''_{#1}(#2)}

%\section{Notation}
\begin{tabular}{l l p{0.5cm} l }
Basics \\
\hline
\verb'\et'          & $\et$ \\
\verb'\edge{x}{y}'  & $\edge{x}{y}$ \\
\verb'\path{x}{y}'  & $\path{x}{y}$ \\
\verb'\iedge{x}{y}' & $\iedge{x}{y}$ \\
\verb'\ipath{x}{y}' & $\ipath{x}{y}$ \\
\verb'\pk{x}'       & $\pk{x} $      \\
\verb'\attr{x}'     & $\attr{x} $  &       & $=_{def} \edge{x}{\veee}$ \\
\verb'\iattr{x}'    & $\iattr{x} $ &       & $=_{def} \iedge{x}{\veee}$ \\
\verb'\rel{x}{y}'   & $\rel{x}{y}$  &      & $=_{def} \edge{x}{y}$ \\
\verb'\irel{x}{y}'  & $\irel{x}{y}$ &      & $=_{def} \iedge{x}{y}$ \\
\verb'\chiZeroM'    & $\chiZeroM  $ &      &                        \\
\end{tabular}

\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\setsuchthat}[2]{\left\{#1 \ \middle|\ #2\right\}}


\begin{align}
&\et[\chiZeroM]        && = \et        && \\
&\rel[\chiZeroM]{x}{y} && = \rel{x}{y}  &&\\
&\attr[\chiZeroM]{x}   && = \attr{x}  \cup  \sum_{y \in \et} \sum_{r \in \rel{x}{y}} \pk{y} && \\
& && = \attr{x}  \cup  \setsuchthat{\tuple{y,r,k}}{y \in \et, r \in \rel{x}{y} \& k \in \pk{y}} \\
& && = \attr{x}  \cup  \setsuchthat{\tuple{r,k}}{\text{for some }
			                  y \in \et, \ r \in \rel{x}{y} \text{ and } k \in \pk{y}} 
\end{align}

Alternatively, we can define $\attr[\chiZeroM]{x}$ as the union of $\attr{x}$ and foreign keys $\fk{x}$
where we define the latter by:
\begin{equation}
\fk{x} = \setsuchthat{\tuple{r,q_1,...q_n,a}}
                               {r \in \rel{x}{y},
                                  \text{ for some } y \in \et,
																	\text{ and } \tuple{q_1,...q_n,a} \in \pk{y},
																	\text{ for some } n \geq 0
			                   }
\end{equation}


This then needs revision\footnote{Check this!} as follows:
\begin{multline}
\fkp{x} = \setsuchthat{\tuple{r,q_1,...q_n,a}}
                      {r \in \rel{x}{y},
                                  \text{ for some } y \in \et,
																	\text{ and } \tuple{q_1,...q_n,a} \in \pk{y},
																	\text{ for some } n \geq 0,                   \right. \\        
											\left.		\text{ and } \tuple{r, q_1,...q_n,a}
																	\text{ is not subsumed by any path }
																	      \tuple{s_1,...s_m} \in \path{x}{v}
											}			                   
\end{multline}

Finally we can define:

\begin{equation}
\fkpp{x} = \fkp{x}/\simeq
\end{equation}
and 

\begin{equation}
\attr[\chiM]{x}  = \attr{x}  \cup  \fkpp{x}
\end{equation}

\end{document}
