\documentclass[10pt,a4paper]{scrartcl}
\usepackage[margin=3cm]{geometry}
\usepackage{pstricks}
\usepackage{pst-node}
\usepackage{pst-tree}
\usepackage{stmaryrd}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{verbatim}
\usepackage{enumerate}
\usepackage{calc}
\usepackage{xifthen}
\usepackage{array}
\input{../SharedMacros/ccategories.macros}
\input{../SharedMacros/gats.macros}
\input{../SharedMacros/metagat.macros}
\input{../SharedMacros/erdiagram}
\input{../SharedMacros/theorems.macros}
\usepackage{tipa}
\usepackage{textcomp}
\usepackage{mnsymbol}
\usepackage{ifsym}
\usepackage{esvect}
\usepackage{float}
\usepackage[section]{placeins}
\usepackage{graphicx}
\setcounter{equation}{0}
\title{Generalised Algebraic Axiomatisations of Contextual Categories}
\subtitle{Corrected 6 April 2018 \\
          Extended 14 June 2018 \\
					Corrected 5 July 2018}

\author{John Cartmell}
\date{}
\begin{document}
\maketitle
\bibliographystyle{plain}

\section{Introduction}
The syntactic notion of \textit{generalised algebraic theory} (GAT) and the  equivalent algebraic notion of \textit{contextual category} were introduced in  \cite{Cartmell78} and summarised in \cite{Cartmell86}. Whereas generally the objects of categories can be taken to represent types, the objects of contextual categories can be taken to represent what I have described as `types that vary' but which subsequently have become know as dependent types. Equally they can be taken to represent contexts: the algebra of contextual categories is an algebra of context. 

In \cite{Cartmell78} it was noted that the theory of contextual categories can be expressed as a generalised algebraic theory by the axiomatisation of identity types on the morphism types of the category 
(the identity types are required in order to phrase the pullback structure required by the definition of contextual category); thus contextual categories are a generalised algebraic equivalent of GATs and, in this sense, the machinary of GATs is able to self-describe; something which cannot be said of Lawvere algebraic theories nor of many-sorted algebraic theories.  

 Voevodsky in \cite{Voevodsky14C} has shown a better way of representing contextual categories as generalised algebraic; one which doesn't necessitate the introdution of types other than those for objects and morphisms. To do this he introduces an operator `s' which cannonically maps any morphism to a representative section; he shows that suitably axiomatised this implies the existence of pullbacks.  The purpose of this paper is to describe the generalised algebraic theory
of contextual categories which results from following this approach (note however that Voevodsky used the term \textit{c-system} in preference to \textit{contextual category}) and then to introduce a further generalised algebraic axiomatisation using operators $\sub$ and $\delta$ in place of Voevodsky's operator $s$.   

As a prelude to presenting the theory we first present two simpler but related theories (previously presented in \cite{Cartmell78} and \cite{Cartmell86}): the GAT of categories and the GAT of trees.

\section{Background Theories and Notations}
\subsection {The GAT of Categories}

\newcommand{\ofOb}[1]{\ofT{#1}{\Ob}}
\newcommand{\ofHom}[2]{\ofT{#1}{\Hom(#2)}}
\vspace{0.03cm} 
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\
\Ob  &$\isT{\Ob}$\\
\Hom &$\ofOb{x,y} \tstyle \isT{\Hom(x,y)} $\\
$\circ$ & $\ofOb{x,y,z},\ofHom{f}{x,y},\ofHom{g}{y,z} \tstyle \ofHom{\circ(f,g)}{x,z}$ \\
id      & $ \ofOb{x} \tstyle \ofHom{id(x)}{x,x} $\\
\end{tabular} \\
\vspace{.1cm}  \\
\vspace{.03cm} \\
\begin{tabular}{l}
\itshape{Axioms} \\
$\circ(id(x),f)=f \mbox{,  whenever\ } \ofOb{x,y},\ofHom{f}{x,y}  $\\
$\circ(f,id(y))=f \mbox{,  whenever\ } \ofOb{x,y},\ofHom{f}{x,y}  $\\
$ \circ(\circ(f,g),h) = \circ(f,\circ(g,h))  \mbox{,  whenever\ } \ofOb{w,x,y,z}, \ofHom{f}{w,x}, \ofHom{g}{x,y}, \ofHom{h}{y,z}$ \\
\end{tabular} \\
\vspace{.3cm}  \\


\subsection {Trees of Concepts and the GAT of Trees}

A contextual category has a tree of objects and we think of this tree as a tree of dependencies among concepts. 

Formally, a tree is any partially ordered set $(S, <)$ such that for each t $\in$ S, the set $\left\{ s \in T : s < t \right\} $ is well-ordered by the relation $<$. We wish to consider just trees $(S,<)$ 
such that for each t $\in$ s, the set $\left\{s \in S : s < t\right\}$ is finite  and such that there is a unique root to the tree i.e. a unique least element. We call the elements of set S the nodes of the tree and for each node the cardinality of the set $\left\{s \in S : s < t\right\}$ is said to be the height of the 
node $t$. We denote by $S_i, i \geq 0,$ the set of elements of $S$ of height $i$. The set $S_0$ is a singleton set containing the root of the tree.

Such trees as these we can equivalently describe as models of the generalised algebraic theory given below table \ref{GATOFTREES} in which the nodes of height $n+1$ are represented as of a sort $S_{n+1}$that is dependent on the sort of nodes of height $n$.

%\newcommand{\Ft}[1]{#1 \kern -0.4em \downarrow}
\newcommand{\Ft}[1]{\downarrow \kern -0.325em #1}
If A and B are nodes of  a tree $(S,<)$ then we shall write $A \base B$ to mean that $A < B$ in S and that
there does not exist x such that $A < x < B$. For every node B of tree S other than the root node there exists a unique node A such that $A \base B$.

\newcommand{\Sz}{S_0}
\newcommand{\ofS}[1]{\ofT{#1}{\Sz}}
\newcommand{\Si}[1]{S_{#1}}
\newcommand{\ofSi}[3]{\ofT{#1}{\Si{#2}(#3)}}
\vspace{0.03cm} 
\begin{table}[H]
\caption{The Generalised Algebraic Theory of Trees}
\label{GATOFTREES}
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\
$\Sz  $&$\isT{\Sz}$\\
$\Si{1} $&$\ofS{x_0} \tstyle \isT{\Si{1}(x_0)} $\\
$\Si{2} $&$\ofS{x_0},\ofSi{x_1}{1}{x_0} \tstyle \isT{\Si{2}(x_0,x_1)} $\\
\vdots  \\
$\Si{n} $&$\ofS{x_0},\ofSi{x_1}{1}{x_0}, \hdots \ofSi{x_{n-1}}{n}{x_0,x_1,\hdots x_{n-2}} \tstyle \isT{\Si{n}(x_0,x_1,\hdots x_{n-1})} $\\
\vdots   \\
$root$ & $\ofT{root}{\Sz}$ \\
\itshape{Axioms}:  \\
$\ofT{x,y}{\Sz} \tstyle x = y$
\end{tabular} \\
\end{table} 


\subsection {Schematic Notation}
%\newcommand{\Ft}[1]{
%#1 \kern-6pt \raisebox{1.45ex}{$\leftrightline$} \kern-3pt \raisebox{.09ex}{$\downarrow$}\kern-3.4pt \raisebox{.25ex} {$|$}}
\newcommand{\ft}[1]{
#1 \kern-6pt \raisebox{1.1ex}{$\leftrightline$} \kern-3pt \raisebox{.1ex}{$\downarrow$}}
%\newcommand{\Bbar}[1]{
%#1 \kern-6pt \raisebox{1.45ex}{$\leftrightline$}
%\overline{#1}}
%\vv{#1}}
%\newcommand{\bbar}[1]{
%#1 \kern-6pt \raisebox{1.0ex}{$\leftrightline$}
%\overline{#1}}
%\vv{#1}}
\newcommand{\bbin}[1]{
\raisebox{-0.5em}{$\stackrel{\displaystyle{\in}} {\scriptstyle{#1}}$}
}
\newcommand{\ofTn}[3]{
#1 \bbin{#2} #3}

There is a  shorthand that is convenient in the presentation  of the GAT of trees  and then subsequently in the GAT of contextual categories. We use the shorthand
$\ofTn{x}{n}{S}$ for the context $\ofS{x_0},\ofSi{x_1}{1}{x_0}, \hdots \ofSi{x_n}{n}{x_0,x_1,\hdots x_{n-1}} $. \\

\noindent Using this shorthand, for any $n \geq 0$ the sort $S_n$  in the theory of trees is introduced as follows: \\

\vspace{0.03cm} 
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\
$\Sz  $     & $\isT{\Sz}$\\
$\Si{n+1}, n \geq 0 $ & $\ofTn{x}{n}{S}    \tstyle \isT{\Si{n+1}(x)} $\\
\end{tabular} \\
\vspace{.1cm}  \\


\subsection {An Aside on Recursive Type Definitions}

Using the shorthand, we are quite close to having a recursive definition of a single sort $S_R$.
Such definitions are not possible in generalised algebraic theories but we can imagine a framework in which it is possible to write: \\
\vspace{0.03cm} 
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\
$S_0  $     & $\isT{S_0}$\\
$S_R  $     & $\ofT{x_0}{S_0}    \tstyle \isT{S_R(x_0)} $\\
$S_R $      & $\ofT{x}{S_R}    \tstyle \isT{S_R(x)} $\\
\end{tabular} \\
\vspace{.1cm}  \\

Such a definition could be represented algebraically in a suitably generalised notion of contextual category (a comulti-contextual category?) these dependencies could be represented
as follows:  

\begin{center}
$
\begin{array}{c c}
\Rnode{abs}{1}  \\ [1.4cm]
\Rnode{S0}{S_0} \\ [1.4cm]
\Rnode{SR}{S_R} \\ [1.4cm]
\end{array}
$
\ncsar{S0}{abs}
\ncsar{SR}{S0}
\ncrsar{SR}{SR}
\end{center}

\noindent This is not just an idle thought -- in  data modelling such a tree 
structure is represented in an entity model diagram in which the injections into the coproduct $S$ of $S_0$ and $S_R$ are represented by containment: \\

\begin{center}
\input{treeStructure}
\end {center}
See \textit{www.entitymodelling.org/tutorialone} for a description of this notation.
For an example of the modelling of recursive relationships in the definition of a phrase structure grammar of English see 
\textit{www.entitymodelling.org/examplesone/englishsentence}.

\section{Definition of Contextual Categories}
\subsection {The GAT of Tree-Structured Categories}

By a tree-structured category we mean (i) a category with a tree-structure defined on its objects such that the tree of objects has a unique root object and (ii) for every $A \base B$ in the tree of objects  a cannonical morphism $p_B:B \rightarrow A$. This morphism will be distinguished in diagrams by an arrow with  
a triangular head so:

\begin{center}
$
\begin{array}{p{2cm}p{0.5cm}p{0.5cm}p{0.5cm}}
\Rnode{B}{B}& \\ [1.4cm]
\Rnode{A}{A} \\
\end{array}
$
\ncbsar{p_B}{B}{A}

\end{center}

\newcommand{\Obi}[1]{\Ob_{#1}}
\newcommand{\Homij}[2]{\Hom_{#1,#2}}
%\newcommand{\ofObi}[2]{\bbar{#1}\bbin{#2}{\Bbar{\Ob}}}
\newcommand{\ofObi}[2]{#1 \bbin{#2}{\Ob}}
%\newcommand{\HomijBar}[4]{\Homij{#1}{#2}(\bbar{#3},\bbar{#4})}
\newcommand{\HomijBar}[4]{\Homij{#1}{#2}(#3,#4)}
\newcommand{\ofHomij}[5]{\ofT{#1}{\HomijBar{#2}{#3}{#4}{#5}}}
%\newcommand{\HomijBarFt}[4]{\Homij{#1}{#2}(\bbar{#3},\ft{\overline{#4}})}
\newcommand{\HomijBarFt}[4]{\Homij{#1}{#2}(#3,\ft{#4})}
\newcommand{\ofHomiBarFt}[4]{\ofT{#1}{\HomijBarFt{#2}{#2-1}{#3}{#4}}}

\noindent The theory of tree-structured categories can be presented as a generalised algebraic theory as follows: \\
\vspace{0.03cm} 
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\[0.1cm]
$\Obi{0}  $&$\isT{\Obi{0}}$\\[0.2cm]
$\Obi{n+1} $&$\ofTn{x}{n}{\Ob} \    \tstyle \isT{\Obi{n+1}(x)} $\\ [0.25cm]
$\Homij{n}{m} $ &$\ofObi{x}{n} ,\  \ofObi{y}{m} \ \tstyle \isT{\HomijBar{n}{m}{x}{y}} $\\ [0.25cm]
$\circ$ & $\ofObi{x}{n}, \  \ofObi{y}{m}, \ \ofObi{z}{p}, \ \ofHomij{f}{n}{m}{x}{y},\ofHomij{g}{m}{p}{y}{z} \tstyle \ofHomij{\circ(f,g)}{n}{p}{x}{z}$ \\ [0.25cm]
$id_n   $   & $ \ofObi{x}{n} \tstyle \ofHomij{id_n(x)}{n}{n}{x}{x} $\\ [0.25cm]
$p_n   $   & $ \ofObi{x}{n} \tstyle \ofHomij{p_n(x)}{n}{n-1}{x}{x_{n-1}} $\\ [0.25cm]
$1     $   & $\ofT{1}\Obi{0} $\\         [0.25cm]
$t_n   $   & $ \ofObi{x}{n} \tstyle t_n(x) \in \Homij{n}{0}(x,1)$\\ [0.25cm]
\end{tabular} \\
\vspace{.1cm}  \\
\vspace{.03cm} \\
\begin{tabular}{l}
\itshape{Axioms} \\

$\circ(id(x),f)=f \mbox{,  whenever\ } \ofObi{x}{n} ,\  \ofObi{y}{m} , \ \ofHomij{f}{n}{m}{x}{y}  $\\ [0.25cm]
$\circ(f,id(y))=f \mbox{,  whenever\ } \ofObi{x}{n} ,\  \ofObi{y}{m} , \ \ofHomij{f}{n}{m}{x}{y}  $\\ [0.25cm]
$ \circ(\circ(f,g),h) = \circ(f,\circ(g,h)),$ \ whenever \\ [0.2cm]
$ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
\ofObi{w}{l} , \ \ofObi{x}{n} , \ \ofObi{y}{m} , \ \ofObi{z}{p}, \ 
 \ofHomij{f}{l}{n}{w}{x}, \ofHomij{g}{n}{m}{x}{y}, \ofHomij{h}{m}{p}{y}{z}$ \\ [0.25cm]
$x = y, $ whenever $x,y \in \Obi{0} $ \\ [0.25cm]
$f = t_n(x),  $ whenever $ \ofObi{x}{n}, \ f \in \Homij{n}{0}(x,1)$\\ [0.25cm]
\end{tabular}  \\
\vspace{.05cm}  \\

\noindent
For ease of reading in what follows we omit the numeric subscripts and also use an infix notation, writing $f \circ g$ inplace of $\circ (f,g)$;
we also write $p_x$ for $p(x)$ and $t_x$ for $t(x)$.

\subsection{Contextual Categories}

\subsubsection{Original Definition}

As defined in [1] and [2], a contextual category is defined to be a tree-structured category 
\cat{C} with the following additional structure:

\noindent 
(i) whenever
$
\begin{array}{cp{.9cm}c}
            & & \Rnode{z}{z} \\ [1.2cm]
\Rnode{x}{x}& & \Rnode{y}{y} \\ [0.5cm]
\end{array}
$
\jcbarr{f}{x}{y}
\ncasar{p_z}{z}{y}

in \cat{C}, an object $f \sub z$ such that $x \base f \sub z$, a morphism $q(f,z): f \sub z \rightarrow z$ such that

\begin{axiom}{q1}
q(f,z) \circ p_z = p_{f \sub z} \circ f
\end{axiom}

i.e. such that the diagram:

\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{fstarz}{f^*z} & & \Rnode{z}{z}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{y}{y}
\end{array}
\end{displaymath}
\ncbsar{p_{f \sub z}}{fstarz}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\ncasar{p_z}{z}{y}
\end{center}
commutes, 

\noindent
and, (ii), so that each such diagram is a pullback diagram, that is: for all objects $w$ of \cat{C}, and for all
morphisms $h_1: w \rightarrow x$ and $h_2: w \rightarrow z$ (see diagram \ref{pullback} below) such that
$h_1 \circ f = h_2 \circ p_z$ 
there exists a unique $h:w \rightarrow f \sub z$ in \cat{C} such that
$h \circ p_{f \sub z} = h_1$ and $h \circ q(f,z) = h_2$, as shown here:

\vspace{3mm}
\begin{center}
\begin{equation*}
\label{pullback}
\begin{array}{cp{0.5cm}cp{1.2cm}c}
\Rnode{w}{w} &&                     &&           \\ [0.7cm]
             &&\Rnode{fstarz}{f^*z} && \Rnode{z}{z}\\ [1.2cm]
             &&\Rnode{x}{x}         && \Rnode{y}{y}
\end{array}
\end{equation*}
\ncbsar{p_{f \sub z}}{fstarz}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\ncasar{p_z}{z}{y}
\setlength{\arrnodesepA}{3pt}
\jcbarr[-35]{h_1}{w}{x}
\ncaarr[35]{h_2}{w}{z}
\psset{linestyle=dashed}
\ncaarr{h}{w}{fstarz}
\end{center}

\vspace {0.25cm}
\noindent and so that (iii) whenever $x \base y$ in \cat{C}, 
\begin{axiom}{q2}
id_x^*y=y
\end{axiom}

and

\begin{axiom}{q3}
q(id_x,y) = id_y
\end{axiom}



\noindent and (iv) whenever 
$
\begin{array}{c p{.9cm} c p{.9cm} c}
             &   &             &   & \Rnode{z}{z} \\ [1.2cm]
\Rnode{w}{w} &   &\Rnode{x}{x} &   & \Rnode{y}{y} \\ [0.5cm]
\end{array}
$
\jcbarr{f}{w}{x}
\jcbarr{g}{x}{y}
\ncasar{c}{z}{y}
in \cat{C}, 

then

\begin{axiom}{q4}
(f \circ g)^*z =  f^* (g ^* z)
\end{axiom}

and 
\begin{axiom}{q5}
q(f \circ g,z) = q(f,g^*z) \circ q(g,z)
\end{axiom}

\subsubsection{Equational Definition following Voevodsky}
Following Voevodsky, however, we may replace the pullback condition, (ii), above, by additional structure as follows:

\noindent (ii') for all morphisms $f: x \rightarrow y$, a morphism $s(f) : x \rightarrow f \sub p_y \sub y$ such that:

\begin{axiom}{s1}
s(f) \circ p_{f\sub p_y \sub y}=id_x
\end{axiom}

\noindent and

\begin{axiom}{s2}
s(f) \circ q( f \circ p_y     ,y)=f
\end{axiom}	

\noindent i.e. such that the following diagrams commute:
\begin{center}
\begin{displaymath}
\begin{array}{cccp{1.cm} cp{.9cm}c}
&\Rnode{fXyyM}{f\sub p_y \sub y}&  & &  \Rnode{fXyy}{f\sub p_y \sub y} & & \Rnode{yXy}{p_y \sub y}\\ [1.2cm]
\Rnode{xL}{x} & &\Rnode{xR}{x} & &\Rnode{x}{x}         & & \Rnode{y}{y}
\end{array}
\end{displaymath}
\ncasar{p_{f\sub p_y \sub y}}{fXyy}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,p_y \sub y)}{fXyy}{yXy}
\ncasar{p_{p_y \sub y}}{yXy}{y}
\ncaarr{s(f)}{xL}{fXyyM}
\ncasar{p_{f\sub p_y \sub y}}{fXyyM}{xR}
\jcbarr{id_x}{xL}{xR}
\end{center}

\noindent
and such that whenever

\begin{center}
\begin{displaymath}
\begin{array}{c p{.9cm} c p{.9cm} c}
\Rnode{w}{w}&& \Rnode{g*z}{g \sub z} && \Rnode{z}{z} \\ [1.2cm]
            && \Rnode{x}{x}  && \Rnode{y}{y} \\ [0.2cm]
\end{array}
\end{displaymath}
\jcbarr{f}{w}{g*z}
\jcbarr{g}{x}{y}
\ncaarr{q(g,z)}{g*z}{z}
\ncasar{}{g*z}{x}
\ncasar{}{z}{y}
\end{center}

\noindent in \cat{C} then

\begin{axiom}{s3}
s(f \circ q(g,z))=s(f)
\end{axiom}

\noindent
This equation is well-typed because
\begin{align*}
      lhs = &\ofT{s(f \circ q(g,z))} {Hom(w,(f \circ q(g,z) ) \sub p_z \sub z} ) \\
      rhs = &\ofT{s(f)} {Hom(w,(f \circ   p_{g \sub z} ) \sub  g \sub z } )\\
\end{align*}
and
\begin{equation*}
     Hom(w,(f \circ q(g,z) ) \sub p_z \sub z ) = Hom(w,(f \circ   p_{g \sub z} ) \sub  g \sub z )
\end{equation*}
because
\begin{align*}
(f \circ q(g,z) ) \sub p_z \sub z 
                 & = f \sub ((q(g,z) \circ p_z) \sub z &\mbox{by (\ref{q4})}\\
                 & = f \sub ( p_{g \sub z} \circ g ) \sub z&\mbox{by (\ref{q1})}\\
                 & = (f \circ   p_{g \sub z} ) \sub  g \sub z&\mbox{by (\ref{q4})}
\end{align*}

\subsubsection{Construction of pullbacks ( Voevodsky)}

\begin{lemma}
 If \cat{C} is a tree-structured category with operators, q, * and s satisfying
axioms q1-q5 and s1-s3 then for all objects $w$ of \cat{C}, and for all
morphisms $h_1: w \rightarrow x$ and $h_2: w \rightarrow z$  such that

$h_1 \circ f = h_2 \circ p_z$ 
there exists a unique $h:w \rightarrow f \sub z$ in \cat{C}   such that
$h \circ p_{f \sub z} = h_1$ and $h \circ q(f,z) = h_2$.
\end{lemma}
\begin{proof}

Use the following construction of such an $h$ as given by Voevodsky  (see diagram (\ref{voevodsky}):
\begin{equation}
h = s(h_2) \circ q(h_1,f \sub z)
\end{equation}
as shown in the following diagram:
\vspace{3mm}
\begin{center}
\begin{equation}
\label{voevodsky}
\begin{array}{cp{0.5cm}cp{1.2cm}c}
\Rnode{gpz}{(g_2 \circ p_z)\sub z = g_1 \sub f \sub z} &&    &&   \\ [1.7cm]
\Rnode{w}{w} &&                     &&           \\ [0.3cm]
             &&\Rnode{fstarz}{f^*z} && \Rnode{z}{z}\\ [1.2cm]
             &&\Rnode{x}{x}         && \Rnode{y}{y}
\end{array}
\end{equation}
\ncbsar{p_{f \sub z}}{fstarz}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\ncasar{p_z}{z}{y}
\setlength{\arrnodesepA}{3pt}
\jcbarr[-35]{h_1}{w}{x}
\ncaarr[35]{}{w}{z}
\naput[labelsep=0.05]{\footnotesize $h_2$}
\ncaarr[30]{s(g_2)}{w}{gpz}
\ncasar{p_{g_1 \sub f \sub z}}{gpz}{w}
\ncaarr[10]{}{gpz}{fstarz}
\naput[npos=0.3, labelsep=0.05]{\footnotesize $q(g_1,f \sub z)$}
\psset{linestyle=dashed}
\ncaarr{h}{w}{fstarz}
\end{center}
\noindent
As required we have 
\begin{align*}
h \circ p_{f \sub z}
                 & = s(h_2) \circ q(h_1,f \sub z) \circ p_{f \sub z} &\\
                 & = s(h_2) \circ p_{h_1 \sub f \sub z} \circ h_1 &&\mbox{by (\ref{q1})}\\
								& = s(h_2) \circ p_{(h_1 \circ f) \sub z} \circ h_1 &&\mbox{by (\ref{q4})}\\
								& = s(h_2) \circ p_{(h_2 \circ p_z) \sub z} \circ h_1 &&\mbox{since }h_1 \circ f = h_2 \circ p_z \\
                 & = h_1                                              &&\mbox{by (\ref{s1})}
\end{align*}
\noindent
and we have:

\begin{align*}
h \circ q(f,z)
                 & = s(h_2) \circ q(h_1,f \sub z) \circ q(f,z) &\\
                 & = s(h_2) \circ q(h_1 \circ f,z)   &&\mbox{by (\ref{q5})}\\
								 & = s(h_2) \circ q(h_2 \circ p_z ,z)&&\mbox{since }h_1 \circ f = h_2 \circ p_z \\
                 & = h_2  \circ id_w                 &&\mbox{by (\ref{s2})} \\
								 & = h_2
\end{align*}

\noindent 
To show that such an $h$ is unique assume that we also have $h'$ satisfying
\begin{equation}
\label{hprime1}
h' \circ p_{f \sub z} = h_1
\end{equation}
and
\begin{equation}
\label{hprime2}
h' \circ q(f,z) = h_2
\end{equation}
\noindent then
\begin{align*}
h'
        & = s(h')              \circ q(h' \circ p_{f \sub z},f \sub z) &&\mbox{by (\ref{s2})}\\
			  & = s(h' \circ q(f,z)) \circ q(h' \circ p_{f \sub z},f \sub z)&&\mbox{by \ref{s3} }\\
        & = s(h  \circ q(f,z)) \circ q(h \circ p_{f \sub z},f \sub z) &&\mbox{by (\ref{hprime1}) and (\ref{hprime2})} \\
				& = s(h)               \circ q(h \circ p_{f \sub z},f \sub z) &&\mbox{by (\ref{s3})}\\
				& = h                                                         &&\mbox{by (\ref{s2})}
\end{align*}
\end{proof}

\subsection{GAT of Contextual Categories}

\noindent To summarise, the GAT of Contextual Categories is defined to be the GAT of Tree-Structured Categories plus
the following additional structure: \\
\vspace{0.1cm} 
\begin{tabular}{>{\itshape}l l}
Symbol & \itshape{Introductory Rule} \\[0.1cm]
$\sub $&$ \ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} ,\  \ofT{z}{\Obi{m}(y)}
\tstyle \ofT {f \sub z}{\Obi{n}(x) } $\\[0.25cm]
$ q  $&$ \ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} ,\  \ofT{z}{\Obi{m}(y)}
\tstyle
                     \ofT{q(f,z)}{  \Homij{n}{m+1}(f\sub y_m  , y_m ) }$  \\ [0.25cm]
$ s  $ & $ \ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} \tstyle
                 \ofT{s(f)} {\Homij{n}{n+1}(x,f \sub p (y)  \sub y)} $ \\ [0.25cm]


\end{tabular} \\
\vspace{.1cm}  \\
\vspace{.03cm} \\
\begin{tabular}{l}
\itshape{Axioms} \\
$q(f,z) \circ p_z =p_{f\sub z} \circ f,$ 
          whenever $\ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} ,\  \ofT{z}{\Obi{m}(y)} $\\  [0.25cm]
					

$(f \circ g)^*z =  f^* (g ^* z), $
          whenever  $ \ofObi{w}{n} ,\ \ofObi{x}{m} ,\ \ofObi{y}{p}, 
					\ofHomij{f}{n}{m}{w}{x} ,\  \ofHomij{g}{m}{p}{x}{y}    $ \\[0.25cm]

$q(f \circ g,z) = q(f,g^*z) \circ q(g,z), $
				   whenever  $ \ofObi{w}{n} ,\ \ofObi{x}{m} ,\ \ofObi{y}{p}, 
					\ofHomij{f}{n}{m}{w}{x} ,\  \ofHomij{g}{m}{p}{x}{y}    $ \\[0.25cm]
					
$s(f) \circ p_{f \sub p_y \sub y} = id(x),$ 
          whenever $\ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} $ \\ [0.25cm]
				
$s(f) \circ q( f \circ p_y    ,y))=f, $	
          whenever	$ \ofObi{x}{n} ,\  \ofObi{y}{m} ,\  \ofHomij{f}{n}{m}{x}{y} $ \\ [0.25cm]		
					
$s(f \circ q(g,z))=s(f),$ 
          whenever $\ofObi{w}{n} ,\  \ofObi{x}{m}  ,\   \ofObi{y}{p} ,\    \ofHomij{g}{m}{p}{x}{y} ,\ \ofT{z}{\Obi{p+1}(y)} ,\ \ofHomij{f}{n}{m+1}{w}{g \sub z} $ \\ [0.25cm]				
					
\end{tabular}  \\
\vspace{.03cm} \\
\noindent
Before we go further we have one useful lemma:
\begin{lemma} [lemma s4]
\label{s4}  
If \cat{C} is a contextual category then for all morphisms $f: x \rightarrow y$ and $g:y \rightarrow z$ in \cat{C},
$$s(f \circ s(g)) = s(f \circ g)$$
\end{lemma}
\begin{proof}
\begin{align*}
s( f \circ s(g)) 
    & = s( f \circ s(g)\circ q(g \circ p_z) , z ))  &\mbox{by axiom s3}\\
    & = s(f \circ g) &\mbox{by axiom s2} 
\end{align*}
\end{proof}


\subsubsection {Extending the $\sub$ operator}

As a preliminary to presenting an alternative axiomatisation of the generalised algbraic theory of contextual categories
we introduce two new operators. The first we consider to be an extension to the $\sub$ operator and applies to certain morphisms as follows: 
if $f:x \longrightarrow y_p$, $y_p \base y$, and $g:y_p \longrightarrow y$ in a contextual category \cat{C} then
define $f \sub g: x \longrightarrow (f \circ g \circ p_y) \sub y$ to be the morphism $s(f \circ g)$. \\

\begin{lemma} 
\label{lemmastarsection} 
\noindent If $f:x \longrightarrow y_p$, $y_p \base y$, and $g:y_p \longrightarrow y$ in a contextual category \cat{C} then
$f \sub g$ is a section i.e. $f \sub g \circ p_{(f \circ g \circ p_y) \sub y} = id_x$
\end{lemma}
\begin{proof}
This follows from the definition of $\sub$ and from axiom s1.
\end{proof}

\begin{lemma} 
\label{lemmastar1}  
If $f:x \longrightarrow y_p$ and $y_p \base y$ and  $g:y_p \longrightarrow y$ in \cat(C) 
as shown here:
\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{fgpy}{(f \circ g \circ p_y)\sub y} & & \Rnode{y}{y}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{yp}{y_p}
\end{array}
\end{displaymath}
\ncbsar{}{fgpy}{x}
\jcbarr{f}{x}{yp}
\ncaarr{q(f\circ g \circ p_y,y)}{fgpy}{y}
\ncasar{}{y}{yp}
\ncaarr[35]{g}{yp}{y}
\ncaarr[35]{f \sub g}{x}{fgpy}
\end{center}

then 
$$
f \sub g \circ q(f \circ g \circ p_y,y) = f \circ g
$$
\end{lemma}
\begin{proof}
Follows directly from the definition of $\sub$ and by axiom s2.
\end{proof}

\begin{lemma}
\label{lemmastar2}
if $f_1:x_1 \longrightarrow x_2$ and $f_1:x_2 \longrightarrow y_p$
and $y_p \base y$ and  $g:y_p \longrightarrow y$ in a contextual category \cat{C} as here:

\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}cp{.9cm}c}
 & & & &\Rnode{y}{y}\\ [1.2cm]
\Rnode{x1}{x_1}         & & \Rnode{x2}{x_2}         & & \Rnode{yp}{y_p}
\end{array}
\end{displaymath}
\ncbsar{}{ffgpy}{x_1}
\jcbarr{f_1}{x1}{x2}
\jcbarr{f_2}{x2}{yp}
\ncasar{}{y}{yp}
\ncaarr[35]{g}{yp}{y}
\end{center}

then
\begin{equation*}
f_1 \sub f_2 \sub g = (f_1 \circ f_2) \sub g
\end{equation*}
\end{lemma}
\begin{proof}
\begin{align*}
lhs &= s(f_1 \circ f_2 \circ g)  && \mbox{from defn. of extended $\sub$} \\
    &= s(f_1 \circ s(f_2 \circ g))&&\mbox{by lemma \ref{s4}} \\
		&= f_1 \sub f_2 \sub g       && \mbox{from defn. of extended $\sub$} \\
	  &= rhs                                    && \mbox{as required.}
\end{align*}

\end{proof}


\subsubsection {Definition of $\delta$}

If x is an object of a contextual category \cat{C} then define $\delta_x: x \longrightarrow p_x \sub x$ to be
the morphism $s(id_x)$.

\begin{lemma}
\label {deltalemma}
If x is an object of a contextual category \cat{C} then $\delta_x$ satisfies:
\begin{enumerate}[(i)]
\item $\delta_x$ is a section i.e $\delta_x \circ p_x = id_x$.
\item $\delta_x \circ q(p_x,x) = id_x$.
\end{enumerate}
\end{lemma}
\begin{proof}
Follows from definition of $\delta$ and from axioms \ref{s1} and axiom \ref{s3}.
\end{proof}


\begin{lemma}
\label {deltalemma2}
Whenever $y_p \base y$ and
$f: x \longrightarrow y_p$ in a contextual category \cat{C} then 
\begin{equation*}
q(f,y) \sub \delta_y   = delta_{f \sub y}
\end{equation*}
\end{lemma}
\begin{proof}
Use lemma \ref{s4} and axiom \ref{s3}.
\end{proof}


\subsection{$\delta\sub$ axiomatisation.}
We can now give an alternative axiomatision of the generalised algebraic theory of contextual categories which we provisionally call a $\delta\sub$-structure. 

\subsubsection{Definition}

A $\delta\sub$-structure is a tree category \cat(C) with  operators $\sub$ and
$q$ satisfying axioms q1 - q5 given above and with the following additional structure:
 \begin{enumerate}[I.]
\item
If $f:x \longrightarrow y_p$ and $y_p \base y$ and  $g:y_p \longrightarrow y$ in \cat(C) then a morphism $f \sub g : x \longrightarrow (f \circ g \circ p_y)*y$
as shown here:
\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{fgpy}{(f \circ g \circ p_y)\sub y} & & \Rnode{y}{y}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{yp}{y_p}
\end{array}
\end{displaymath}
\ncbsar{}{fgpy}{x}
\jcbarr{f}{x}{yp}
\ncaarr{q(f\circ g \circ p_y,y)}{fgpy}{y}
\ncasar{}{y}{yp}
\ncaarr[35]{g}{yp}{y}
\ncaarr[35]{f \sub g}{x}{fgpy}
\end{center}

satisfying 
\begin{axiom}{star1}
f \sub g \circ p_{(f \circ g \circ p_y) \sub y} = id_x
\end{axiom}
and 
\begin{axiom}{star2}
f \sub g \circ q(f \circ g \circ p_y,y) = f \circ g
\end{axiom}

and such that if $f_1:x_1 \longrightarrow x_2$ and $f_1:x_2 \longrightarrow y_p$
and $y_p \base y$ and  $g:y_p \longrightarrow y$ in \cat(C) as here:

\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}cp{.9cm}c}
 & & & &\Rnode{y}{y}\\ [1.2cm]
\Rnode{x1}{x_1}         & & \Rnode{x2}{x_2}         & & \Rnode{yp}{y_p}
\end{array}
\end{displaymath}
\ncbsar{}{ffgpy}{x_1}
\jcbarr{f_1}{x1}{x2}
\jcbarr{f_2}{x2}{yp}
\ncasar{}{y}{yp}
\ncaarr[35]{g}{yp}{y}
\end{center}

 then
\begin{axiom}{star3}
f_1 \sub f_2 \sub g = (f_1 \circ f_2) \sub g
\end{axiom}

\item
For any object $x$ of \cat(C) a morphism $\delta_x:x \longrightarrow p_x \sub x$ such that
\noindent
$\delta_x$ is a section i.e :
\begin{axiom}{delta1}
\delta_x \circ p_x = id_x
\end{axiom}
\noindent
and
\begin{axiom}{delta2}
\delta_x \circ q(p_x,x) = id_x
\end{axiom}

and whenever $y_p \base y$, 
$f: x \longrightarrow y_p$  in \cat{C}
as here:

\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}cp{.9cm}c}
\Rnode{pfy}{{p_{f \sub y}}\sub f \sub y}  & &\Rnode{py}{p_y \sub y}\\ [1.2cm]
\Rnode{fy}{f \sub y} & &\Rnode{y}{y}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{yp}{y_p}
\end{array}
\end{displaymath}
\jcbarr{f}{x}{yp}
\ncbsar{}{fy}{x}
\jcbarr{q(f,y)}{fy}{y}
\ncasar{}{y}{yp}
\ncasar{}{pfy}{fy}
\ncasar{}{py}{y}
\ncaarr{q(q(f,y),p_y \sub y)}{pfy}{py}
\ncaarr[35]{\delta_y}{y}{py}
\ncaarr[35]{\delta_{f \sub y}}{fy}{pfy}
\end{center}
then 
\begin{axiom}{delta3}
q(f,y) \sub \delta_y   = delta_{f \sub y}
\end{axiom}
\end{enumerate}

\subsubsection{Recovery of $s$ from $*$ and $delta$}

That a contextual category has $\delta\sub$-structure we have shown in lemmas \ref{lemmastar1}, \ref{lemmastar2},
\ref{deltalemma} and \ref{deltalemma2}.
It remains to show that within any $\delta\sub$-structure an operator $s$ can be defined and satisfies axioms s1,s2 and s3.
\noindent
Define $s(f)$ to be $f \sub \delta_y$ . 
\noindent
That axiom s1 holds follows from axiom \ref{star1}.
\noindent
We prove axiom s2, which is:
\begin{equation*}
s(f) \circ q( f \circ p_y     ,y)=f,
\end{equation*}
\noindent
 as follows:
\begin{align*}
lhs &= f \sub \delta_y \circ q(f \circ p_y, y)  && \mbox{from defn of s} \\
  &= f \sub \delta_y \circ q(f,p_y \sub y) \circ q(p_y,y)&&\mbox{by \ref{q5}} \\
  &= f \circ \delta_y \circ q(p_y,y)        && \mbox{from \ref{star2}} \\
	&= f \circ id_y                           && \mbox{by \ref{delta2}} \\
	&= rhs                                    && \mbox{as required.}
\end{align*}

\noindent
Finally we prove axiom s3, which is
\begin{equation*}
s(f \circ q(g,z))=s(f),
\end{equation*}

\noindent
 as follows:
\begin{align*}
lhs &= (f \circ q(g,z)) \sub \delta_z    && \mbox{from defn of s} \\
  &= f \sub (  q(g,z) \sub \delta_z)     &&\mbox{by \ref{star3}} \\
  &= f \sub \delta_{g \sub z}            && \mbox{from \ref{delta3}} \\
	&= rhs                                 && \mbox{as required.}
\end{align*}


\bibliography{../SharedBibliography/temp/bibliography}
 
\end{document}
