 \documentclass[10pt,a4paper]{article}
%\input{thepreamble.tex}
\input{../SharedMacros/ccategories.macros}
\input{../SharedMacros/ermacros}
\input{../SharedMacros/erdiagram}
\input{../SharedMacros/theorems.macros}
\input{../SharedMacros/general.macros}
\usepackage{mathptmx}  % This changes font to roman
\usepackage{anyfontsize}
\usepackage{mathtools}  % why have we got this?
\usepackage{alltt}    
\usepackage{mnsymbol} %used for rightpitchfork
\usepackage{cmll}
%\usepackage{yhmath}  % used for better version of \widehat
\usepackage{ulem}
\renewcommand{\ttdefault}{txtt}
\usepackage[left=1.5cm, right=4cm, marginparwidth=3cm, top=2cm, bottom=2.0cm]{geometry}
\usepackage{framed}
\usepackage[font=small]{caption}
\setlength{\captionmargin}{2cm}


\theoremstyle{remark}
\newtheorem*{lemma*}{Lemma}


\renewcommand{\term}[1]{\textit{#1}}  %SIMPLE UNINDEXED VERSION

%ENDCOPY

\begin{document}
\title{Range Categories and the Theory of Data}

% abstract here for ams

\author{John Cartmell}

\date{}

\maketitle

\begin{center}
DRAFTING November 2023
\end{center}

\newcommand{\binarysourcediag}[5]{
$
\begin{array}{c p{0.5cm} c  }
             &&   \Rnode{b}{#2} \\[0.01cm]
\Rnode{a}{#1} &&                \\[0.01cm] 
             &&   \Rnode{c}{#3} 
\end{array} 
\begin{arrows}
\ncarr{a}{b}
\alabel{#4}
\ncarr{a}{c}
\blabel{#5}
\end{arrows}
$  
}
\newcommand{\fgsourcediag}{\binarysourcediag{a}{b}{c}{f}{g}}

\newcommand{\paralleldiag}[4]
{
 $
\rule[-0.3cm]{0pt}{0.9cm} %to add vertical space of diagram -- based on lowering diagram 0.3cm and heght 0.9cm
                            % change thickness from 0pt to 1 pt to debug
\begin{array}{c p{0.5cm} c  }
 \Rnode{a}{#1}     &&   \Rnode{b}{#2}
\end{array} 
\begin{arrows}
\ncarc[nodesep=2pt,arcangle=10,offset=2pt]{->}{a}{b}
\alabel{#3}
\ncarc[nodesep=2pt,arcangle=-10,offset=-2pt]{->}{a}{b}
\blabel{#4}
\end{arrows}
$  
}

\newcommand{\sequentialdiag}[5]
{$
\begin{array}{c p{0.5cm} c p{0.5cm} c }
 \Rnode{a}{#1}     &&   \Rnode{b}{#2} && \Rnode{c}{#3}
\end{array} 
\begin{arrows}
\ncarr{a}{b}
\alabel{#4}
\ncarr{b}{c}
\alabel{#5}
\end{arrows}
$}

\iffalse
\newcommand{\fnsourceqnsource}
{
$
\begin{array}{c p{0.25cm} c  p{0.25cm} c }
             &&   \Rnode{b1}{b_1} &&              \\[0.4cm]
\Rnode{a}{a} &&                   && \Rnode{c}{c} \\[0.4cm]
             &&   \Rnode{bn}{b_n} &&              
\end{array} 
\begin{arrows}
\ncarr{a}{b1}
\alabel{f_1}
\ncarr{c}{b1}
\blabel{q_1} 
\ncarr{a}{bn}
\blabel{f_n}
\ncarr{c}{bn}
\alabel{q_n}
\end{arrows}
$   
}
\fi
\section{Restriction Categories}

From Cockett \& Lack, a restriction category is a category \catcw with an additiona operator (the restriction operator) such that
if $f: a \morph b$ in \catcw then
$$\bar{f}: a \morph a$$ 
and satisfying

R.1 For $f:a \morph b$ in \catcw $$\bar{f} \circ f =f$$.

R.2. If \fgsourcediag in \catcw then
$$\bar{g} \circ \bar{f}=\bar{f} \circ \bar{g}.$$

R.3. If \fgsourcediag in \catcw then
$$\overline{\bar{f} \circ g} = \bar{f} \circ \bar{g}$$.

R.4. If \sequentialdiag{a}{b}{c}{f}{g} in \catcw then
$$f \circ \bar{g} = \overline{f \circ g} \circ f$$.

\section{Range Categories}

A \term{range category} is a retriction category with an additional operator as follows
if $f: a \morph b$ in  \catcw then
$$\hat{f}: b \morph b$$
satisfying

RR.1 For $f:a \morph b$ in \catcw $$\bar{\hat{f}} = \hat{f}.$$

RR.2 For $f:a \morph b$ in \catcw $$f \circ \hat{f} = f.$$

RR.3. If \sequentialdiag{a}{b}{c}{f}{g} in \catcw then
$$\widehat{f \circ \bar{g}} = \hat{f} \circ \bar{g}.$$

RR.4. If \sequentialdiag{a}{b}{c}{f}{g} in \catcw then
$$\widehat{(hat({f}) \circ g)} = \widehat{f \circ g}.$$


Let the category \FinPar be the range catgory of finite sets and partial functions.


\subsection{$Hom$ Functor is a Restriction Functor}
 
\begin{lemma}
If \catcw is a restriction catgory and $a$ is an object of \catcw 
then the functor $Hom_\catcw(a,-)$ preserves the restriction operator i.e.
for all $j:x \morph y$ in \catc
$$Hom_\catcw(a,\bar{j})=\overline{Hom_\catcw(a,j)}$$
\end{lemma}
\begin{proof}
\begin{align*}
lhs &= \lambda k \in Hom_\catcw(a,x).k \circ \bar{j}  \\
rhs &=  id_{Hom_\catcw(a,x)}
\end{align*}
Sufficient that $\bar{j}=id_x$.
\end{proof}

\subsection{Split assumption and $Hom$ as a Range Functor}
\begin{definition}
In a range category \catcw then a morphism $f:a \morph b$ is split iff
there exists $f_s:b \morph a$ such that $f_s \circ f = \hat{f}$.
\end{definition}
\begin{lemma}
If \catcw is a range category in which every morphism is split then
for every object $a$ of \catcw the functor $Hom_\catcw: \catcw \morph \Par$ preserves the range operator.
\end{lemma}
\begin{proof}
If $j: x \morph y$ in \catcw then we are required to prove that
$$\widehat{Hom_\catcw(a,j)}=Hom_\catcw(a,\hat{j})$$
and for this it suffices to show that the range of $Hom_\catcw(a,j)$ i.e. this set
$$\setsuchthat{ k \circ j}{k: a \morph x }$$ 
is identical to the range of $Hom_\catcw(a,\hat{j})$ i.e. this set
$$\setsuchthat{k' \circ \hat{j}}{k':a \morph y}.$$

The first set is included in the second because for any morphism of the form $k \circ j$, $k$ total is of the form $k' \circ j$, $k'$ total, because we can take $k'$ to be $k \circ j$ because then $k' \circ \hat{j} = (k \circ j) \circ \hat{j}= k \circ(j \circ \hat{j})= k \circ j$. 

Let $j_s : y \morph x$ be the splitting of $j$ i.e. be such that $j_s \circ j = \hat{j}$.

The second set is included in the first because if a morphism is of the form $k' \circ \hat{j}$ then it of the form $k \circ j$ because $k$ can be taken to be $k' \circ j_s$ for then we have $k' \circ \hat{j} = k' \circ j_s \circ j = k \circ j$. 
 \end{proof}

\begin{corollary}
If \catcw is a range category in which every morphism is split then
for every object $a$ of \catcw the functor $Hom_\catcw(a,-): \catcw \morph \Par$ is a range functor.
\end{corollary}


\subsection{MToD Definitions}

\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances and if \fgsourcediag
in $\catc$ then there is a  \term{functional dependency} of $g$ on $f$ with respect to $\reqtc$ iff
there is a family of functions $H_D)_{D \in \reqtc}$ such that 
in each instance $D$, $H_D$ is a unique function $H_D: D(b) \morph D(c)$, such that $D(f) \circ H_D = D(g)$ and $\overline{H_D}=\widehat{D(f)}$.
If there is such a functional dependency then we say that $\fundep{H}{f}{g}$ in $\catc$ with respect to $\reqtc$.
\end{definition}

\begin{lemma}
\label{fdrangesublemma}
If $\fundep{H}{f}{g}$ is a functional dependency then
$$\widehat{H_D}=\widehat{D(g)}.$$
\end{lemma}
\begin{proof}
\begin{align*}
\widehat{D(g)} &= \widehat{D(f) \circ H_D} \\
               &= \widehat{hat({D{f})} \circ H_D} &&\mbox{by RR.4}\\               
               &= \widehat{\overline{H_D} \circ H_D} &&\mbox{by defn of functional dependency}\\
               &= \widehat{ H_D} &&\mbox{by R.1}\\
\end{align*}
\end{proof}

\begin{definition}
If $\catc$ is a range category and $\reqtc$ is a set of instances, if
\fgsourcediag
in $\catc$ 
and if there is a functional dependency $\fundep{H}{f}{g}$ then say that 
the functional dependency $H$ is \term{represented} in $\catc$ 
iff there exists a morphism $h:b \morph c$ in $\catc$ such that for each instance $D \in \reqtc$, $D(h)=H_D$. 
\end{definition}

\begin{oldtt}
Question: Do we wish to add to the above definition that $\bar{h}=\hat{f}$????
Maybe we don't need to because if $f$ didn't have this property then
there would be a morphism, $\hat{f}\circ h$, that would have the property.
\end{oldtt}

\input{fd_representation_lemma}

\bibliographystyle{alpha} 
\bibliography{../SharedBibliography/temp/bibliography}
\end{document}
