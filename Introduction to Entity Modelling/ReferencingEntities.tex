\section{Referencing Entities}
\label{ReferencingEntities}
\commentary{Find a place to explain use of the term \textit{a priori}. As an example, in the route example two states can be coincident but not so \textit{a priori}.}

We now explore how the arrangement of identifying features of 
a type of entity, guides us in how we 
reference entities of the type and how this, in turn, influences the way that
we convey, communicate and store instances of relationships.
There is more to this than initially meets the eye
and we  explore by way of examples; 
it turns out, perhaps unexpectedly, that comparable paths that are equivalent or near-equivalent (these were described in section \ref{comparisonOfPaths}) have an impact
on how we phrase references. Consequentially, equivalent paths have an impact on the structure of data and on the way that simple everyday facts are phrased.

This section is going to be split into subsections where we consider the various configurations of identifying relationships and attributes 
relevant to referencing entities of a type. 
We start with the simplest of cases and then work through to examples in which there are branching chains of identifying relationships and, in some cases, comparable, equivalent and near-equivalent paths of identifying relationships; we see the impact that these have. 

\subsection{Identifying Relationships and Nested References}
\mynote
Now consider how entities are referenced when their types have an identifying relationship  emanating from them. 

\subsubsection*{Example 1 --- Referencing an entity of type play}
Consider, for example, the type \textit{play} from the model of the dramatic arts given earlier in figure \ref{dramaticArts1..diagram}. The significant details are its identifying attribute named `title' 
in conjunction with its relationship to a playwright
as shown here 
\begin{equation*}
\input{\ImagesFolder/dramaticArtsPlayPlaywright..diagram.tex}
\end{equation*}
From this part of the model we see that play are identified by title and
and by reference to a playwright.
\mynote
We therefore have references such as to
\begin{equation}
\mbox{the play Twelfth Night by playwright William Shakespeare}
\end{equation}
which can be abbreviated as
\begin{equation}
\mbox{Shakespeare's Twelfth Night}
\end{equation}
Either way, implicitly or explicitly, there is a reference to a play and it has 
nested within it a reference to a playwright.
The nested reference may be absent if the playwright is clear from the context as for example if we list Shakespeare's comedies for then we can list by title alone as \textit{Twelfth Night, As you Like It,
A Midsummer Night's Dream,...} and so on.
In general though,
\begin{itemize} 
\item without context, 
\begin{equation} 
\label{absolutePlayReferencing}
\text{\parbox{9cm}{a  play 
is referenced by a combination of the \uline{title} of the play and the \uline{name} of the playwright it is \uwave{written by.}}}
\end{equation}\commentary{unwave the relationship name?}
\end{itemize}
I have underlined  identifying attributes so as to draw attention to the number of them required.

\begin{erboxedFigure}{H}{TwelfthNight}
{
An ER analysis of a two level reference to the play Twelfth Night. This is an example of a reference with another reference nested within it.
}
\newcommand{\dashRefOne}{2pt 2pt}
\newcommand{\dashRelationship}{1pt 0pt}
\newcommand{\dashRefTwo}{1pt 1pt}
\newcommand{\synLabel}[3]
{
  \Rnode{#1}{\parbox[t]{#2cm}{\textit{#3}}}
}
\begin{tabular}{l}
the 
\Rnode{et}{\uline{play}}
\Rnode{attrvalue}{\rdash{Twelfth Night}}
\Rnode{relname}{\uwave{by}}
\Rnode{nestedref}{\rdot{playwright Shakepeare}} \\[1.5cm]

\synLabel{tagET}{1}{name of entity type}
\kern0.35cm\synLabel{tagAV}{1.65}{value of identifying attribute}
\kern0.35cm\synLabel{tagRN}{1.625}{name of identifying relationship}
\kern0.5cm\synLabel{tagNestedRef}{1.95}{\kern0.5cmnested \\reference to entity of type playwright}\\[0.5cm]
\syntag{\dashRefOne}{tagET}{0.9}{et}{0}
\syntag{\dashRefOne}{tagAV}{0.9}{attrvalue}{-0.5}
\syntag{\dashRefOne}{tagRN}{0.9}{relname}{0}
\syntag{\dashRefTwo}{tagNestedRef}{0.9}{nestedref}{0}
\end{tabular}
\end{erboxedFigure}

\subsection{Simple Path Arrangments of Identifying Relationships}\commentary{Russian Doll references}

When a type has emanating from it a simple path of identifying relationships,
when there is no branching of such relationships,
then references to the type have nested references which in turn have nested references within in them and so on; you could say that these are Russian-doll-structured references --- finitely, each reference has one other reference within it.
\subsubsection{Example 1 --- Postal Addresses}
\mynote
A classic example is the postal address. 
In practice there is no uniformity  but traditional postal addresses however
represented, are references having multiple levels of nesting within them.
For instance a reference to a particular house will usually have nested within it a reference to a street, usually within this there is a reference to a town or city and
as discussed this may contain a reference to a state or province.  
The multiple levels of nesting of references follows from the
the chaining of identifying relationships in an arrangement
of entity types and relationships like this one in which there are four levels of nesting
\begin{equation*}
\input{\ImagesFolder/postalAddressISO20022.tex}
\end{equation*}
\mynote
What I say regarding nesting of references in spoken English also applies, though arguably with some exceptions, when references are communicated in data.
The following has been given as an example of a message structure for a postal address and is represented as XML
\begin{verbatim}
<PstlAdr>
  <StrtNm>South LaSalle Street</StrtNm>
  <BldgNb>120</BldgNb>
  <PstlCd>60690-0834</PstlCd>
  <TwnNm>Chicago</TwnNm>
  <CtrySubDvsn>IL</CtrySubDvsn>
  <Ctry>US</Ctry>
</PstlAdr>
\end{verbatim}

\subsubsection{Example 2 --- Referencing Characters from Plays}
\mynote
 We use as an example the referencing of characters from  plays
 within the context of  the  dramatic arts
   as modelled earlier in figure \ref{dramaticArts1..diagram}.
We focus on the details shown in this fragment \commentary{should I use a linear variant this diagram?}
\begin{equation*}
\input{\ImagesFolder/dramaticArtsCharacterFragment..diagram.tex}
\end{equation*}
which for our purposes here can be rearranged like this

\begin{equation*}
\input{\ImagesFolder/dramaticArtsCharacter..identificationScheme..diagram.tex}
\end{equation*}

These are the details relevant to the identification of entities of type character.
\mynote
From inspecting the representation of the character type and in particular its identifying features then we see that:
\begin{itemize}
\item within the context of a specific play, 
\begin{equation} 
\label{absoluteCharacterReferencing}
\text{\parbox{9cm}{
a character may be referenced by their \uline{name}.}}
\end{equation}
Accordingly in the text of a play characters are referenced 
by name as for example in stage directions such as this one:  
\begin{equation*}
\text{\textit{Enter \rdash{Sebastian}.}}
\end{equation*}
\item within the context of a specific playwright (but with no particular play in mind), 
\begin{equation} 
\label{playwrightRelativeCharacterReferencing}
\text{\parbox{9cm}{
 a character from within a play 
may be referenced by their \uline{name} along with the \uline{title} of the play they are \uwave{in}.}}
\end{equation}
So in a discussion of our favourite Shakespearean characters  we might 
make reference to
\begin{equation*}
\text{\textit{\rdash{Sebastian} from \rdash{Twelfth Night}.}}
\end{equation*}
\item
without any context at all, 
\begin{equation} 
\label{absoluteCharacterReferencing}
\text{\parbox{9cm}{a character from within a play 
may be referenced by their \uline{name} along with the \uline{title} of the play they are \uwave{in} and the \uline{name} of the playwright it is \uwave{written by}.}}
\end{equation}
Thus, without context, three referentials are required for the referencing of a character
as  when I reference the following character:
 \begin{equation}
\label{TouchstoneReferenceFromAbsolute}
\text{\parbox{9cm}{\textit{\rdash{Touchstone} from \rdash{Shakespeare}'s \rdash{As You Like It}. }}}
\end{equation}
\end{itemize}

Each of these three referentials corresponds to 
a path through diagram xxx from the left hand side of the diagram to the right as we see here. There are exactly three paths from left to right across the diagram. These are
\begin{align*}
d1/r1/a3 & Shakespeare \\
d1/a2    & As You Like It\\
a3       & Touchstone
\end{align*}

and each one corresponds to a referential within example
(\ref{TouchstoneReferenceFromAbsolute}) as follows
\begin{tabular}{l l}
\textbf{Path}     & \textbf{Referential} \\
d1/r1/a3 & Shakespeare \\
d1/a2    & As You Like It\\
a3       & Touchstone
\end{tabular}

At a first approximation in the absence of comaparable paths in the partern of pertinent idenitfying relationships the referentials required to reference entities of a type exactly correspond to such paths from left to right across the identifier diagram.


\subsection{Arrangements with Branching Paths of Identifying Relationships}
If there is a branch in the arangement of identifying relationships emanating from a type then references to entities at the branch point will contain multiple  references nested within them; 
the Russian-doll analogy breaks down but a nested boxes analogy holds up --- we can open a box and find multiple boxes nested inside it. 

\subsubsection{Example 1 --- Planetary Conjunctions}
As an example of a reference having two or more independent  nested references, consider this reference to  a (binary) planetary conjunction:
\begin{equation}
\mbox{the conjunction of Mars and Jupiter on July 4, 929}
\end{equation}
In this reference there are clearly two independent references to planets. 
The types and relationships can be shown like this

\begin{equation*}
\input{\ImagesFolder/planetaryConjunction.tex}
\end{equation*}
or like this if we draw the identifying relationships from left to right

\begin{equation*}
\input{\ImagesFolder/planetaryConjunction..identificationScheme.tex}
\end{equation*}

\subsubsection{Example 2 --- Productions of Plays}


For a second example we move on to another area within the overall model of figure \ref{dramaticArts1..diagram}. From the following detail 
\begin{equation*}
\input{\ImagesFolder/dramaticArtsProductionFragment..diagram.tex}
\end{equation*}
regarding the production entity type  we see that
\begin{itemize}
  \item
  without any context, 
  \begin{equation} 
\label{absoluteCharacterReferencing}
\text{\parbox{9cm}{a production can be referenced by referencing the play it is a production \uwave{of} 
  and by giving the \underline{name} of the venue  the production is \uwave{at} along with the \underline{season} 
  over which it plays.}}
\end{equation}
\end{itemize}
We have already seen that to reference a play requires two referentials and so
we can count up the number of referentials required to reference a production
as one for the venue, two for the play and one for the season so four referentials in all. 

As an example consider the following prescription
\begin{erquote}
\parbox{9cm}{a production of \mbox{\rdash{Shakespeare}'s} \rdash{As You Like It}
 performed \mbox{\rdash{April – May 1975},} at \rdash{Oxford Playhouse}.}\\
\end{erquote}
As is to be expected in this description there are four referentials present.\footnote{
I found the literal description online as ``a production of the play As You Like It (by William Shakespeare), April – May 1975, at Oxford Playhouse''.  
} 
We should point out that each of the four referentials corresponds to a path from left to right across the following diagram containing the features pertinent to the identification.\commentary{\highlight{Change this} into a figure so that we can add some commentary.}

\begin{equation*}
\input{\ImagesFolder/dramaticArtsProduction..identificationScheme..diagram.tex}
\end{equation*}

The paths from left to right across the diagram and the referentials that instantiate them in example above are\\
\newline
\begin{tabular}{l l}
\textbf{Path}     & \textbf{Referential} \\
r2/r1/a3 & Shakepeare       \\
r2/a2    & As You Like It   \\
a4       & April-May 1975   \\
r3/a5    & Oxford Playhouse
\end{tabular}

\subsection{Arrangements with Comparable Paths of Identifying Relationships}
When a type has multiple paths of identifying relationships emanating from it and when these paths intersect in the sense that there is a type in common between the paths (in addition to the
branching point) then in some cases teven the nested boxes analogy breaks down
because we are sometimes led to reference having nested references which overlap and are not totally independent. We give two examples one where the analogy holds up and one where it does not. The key characteristic is the presense of equivalent or near-equivalent paths.
\commentary {Find  a home or use or rephrasing for the next para}
For entity types character and production we have been able to inspect the entity model diagram for identifying  attributes and relationships and from the inspection posit required referentials  for the referencing of entities of the type.
We need beware though because referencing doesn't always work out by simple aggregation. Because sometimes,
in the words of Shlaer and Lang, referentials collapse. 
To see this we are going to move on to another area within our model and look at how dramatic roles are identified and referenced.

 \subsubsection{Example 1 --- Dramatic Roles from Figure \ref{dramaticArts1..diagram}}
\mynote
In figure \ref{dramaticArts1..diagram}, the entity type \textit{dramatic role} is
depicted, somewhat similar to an intersection entity, as shown having
two identifying relationships and no identifying attributes.
The relevant detail is  this
\begin{equation*}
\input{\ImagesFolder/dramaticArtsDramaticRoleFragment..diagram.tex}
\end{equation*}
We can interpret this detail as telling that
\begin{equation}
\label{DramaticRoleReferencing}
\text{\parbox{9cm}{to reference a dramatic role it is necessary  
to reference both a character and  a production.}}
\end{equation}

Now, as we have already discussed, characters from plays need be referenced using three referentials
and productions need be referenced using four referentials 
and so we can expect that, without context, a reference to
a dramatic role will require seven referentials
 --- three for the character and four for the production. 
So we will need seven, right?
 Well no, rather surprisingly, wrong! Only five referentials are required. 
 What happened to the other two? Can you examine the model in figure \ref{dramaticArts1..diagram} and figure this out?
\begin{equation*}
\input{\ImagesFolder/dramaticArtsRole..identificationScheme..diagram.tex}
\end{equation*}
That only five referentials are needed can be seen from this reference to a dramatic role:
\begin{erquote}
\parbox{9.0cm}{the role of \rdash{Touchstone} in the production of \mbox{\rdash{Shakespeare}'s} \rdash{As You Like It} performed \mbox{\rdash{April – May 1975},} at \rdash{Oxford Playhouse}.
}
\end{erquote}

To see why five only we have to spell out our declaration, (\ref{DramaticRoleReferencing}), in more detail
and declare more specifically that
\begin{equation}
\label{DramaticRoleReferencingRevised}
\text{\parbox{9cm}{To reference a dramatic role it is necessary 
to both reference a character \textbf{from a play} and to reference a production \textbf{of that same play}.}}
\end{equation}
It is because both the character and the production will be in relationship with the very same play
that in referencing a dramatic role, the referencing of the character and the referencing of
the production will not be independent
--- each of these two references --- the referencing of the character and the referencing of the production ---
 will include reference to the very same play --- which reference need not be made twice over. 
It is in describing situations like this that Shlaer and Lang coined the term \textit{collapsed referentials}. 
 When they coined the term they had in mind tabular database structure 
 but we have got to an understanding of the same phenomenon in our discussion here 
 of how referencing works in ordinary speech. 
\mynote
\begin{tabular}{l l l}
& r4/a1 &    \\
& \multirow[t]{2}{1cm}{r4/d1=d2/r2} & a2  \\
&                                 & r1/a3 \\
& d2/r2    & as above\\
& d2/a4 &            \\
& d2/r3/a5 &      
\end{tabular}
\mynote
The conclusion is that an entity model is more than is shown in the diagram of relationships. It needs include additional information... such as, in the declaration above,
 is captured by qualifying as ``in the same play''. 
 \mynote
To better understand the phenomenon that is occurring here here consider the analyis 
of (xxx) that is shown in figure \ref{theRoleOfTouchstone}.
\begin{erboxedFigure}{H}{theRoleOfTouchstone}
{
A reference to a dramatic role has two nested references within it. 
One to an entity of type character and one to an entity if type production. In this example the nested references overlap. The overlap is Shakespeare's As You Like It --- a reference to a play that is nested within both of the two nested references.
}
\newcommand{\dashRefOne}{2pt 2pt}
\newcommand{\dashRelationship}{1pt 0pt}
\newcommand{\dashRefTwo}{1pt 1pt}
\begin{tabular}{l}
the role of 
\Rnode{w1}{\rdash{T}} in 
\Rnode{w2}{\rdot{\rdash{Shakespeare}}}’s 
\Rnode{w3}{\rdot{\rdash{As You Like It}}} performed 
\Rnode{w4}{\rdot{Spring '75}}, at 
\Rnode{w5}{\rdot{OP}} \\[1.4cm]
\kern2cm\Rnode{ref1}{\parbox[t]{1.95cm}{\textit{reference to entity of type character}}}
\kern3.0cm\Rnode{ref2}{\parbox[t]{1.95cm}{\textit{reference to entity of type production}}} \\[0.5cm]
\syntag{\dashRefOne}{ref1}{0.9}{w1}{0}
\syntag{\dashRefOne}{ref1}{0.9}{w2}{-0.2}
\syntag{\dashRefOne}{ref1}{0.9}{w3}{-0.2}
\syntag{\dashRefTwo}{ref2}{0.4}{w2}{0.2}
\syntag{\dashRefTwo}{ref2}{0.4}{w3}{0.3}
\syntag{\dashRefTwo}{ref2}{0.4}{w4}{0.3}
\syntag{\dashRefTwo}{ref2}{0.4}{w5}{0}
\end{tabular}
\end{erboxedFigure}

\mynote Figure \ref{theRoleOfTouchstone} shows two nested references 
within a reference to a dramatic role. The two nested references spelled out in more detail are
\begin{equation}
\mbox{the character Touchstone from the play Twelfth Night by Shakespeare}
\end{equation}
and
\begin{equation}
\mbox{the production performed in Spring '75 at the OP of the play Twelfth Night by Shakespeare}
\end{equation}
and obviously these two nested references share a common nested reference, namely the reference to
\begin{equation}
\mbox{the play Twelfth Night by William Shakespeare.}
\end{equation}

We have sees already  that nested references 
themselves can have references nested within them
and now we find that these nested references can be shared --- so they are not nested at all and the russion doll analogy totally breaks down.  
\textit{the role of Touchstone, Spring '75 at the Oxford Playhouse} is a reference that contains two nested references and these nested references each in turn contain a nested reference and this is common to them i.e. shared between them. There is a reference that is subordinate to both of them and, necessarily, it isn't 
physically nested within the both of them.

\mynote
The double nesting of references comes about because of this arrangement of relationships 
\begin{equation}
\label{dramaticArtsPortrayalScopeFragment..diagram}
\input{\ImagesFolder/dramaticArtsPortrayalScopeFragment..diagram.tex}
\end{equation}
of taken from figure \ref{dramaticArts1..diagram}.

\mynote
The ``in the same play'' injunction is necessary
and appropriate just because in this diagram 
the two comparable paths from the bottom right to the top left, from entity type dramatic role to entity type play, are equivalent.

\mynote
There are two paths of identifying relationships between entity type \textit{dramatic role} and type \textit{play}.
One of them proceeds via type \textit{character} and consists of relationship \textit{r4} followed by relationship \textit{d1} as follows:

\begin{equation}
\label{dramaticArtsPath1..diagram}
\scalebox{0.95}{\input{\ImagesFolder/dramaticArtsPath1..diagram.tex}}
\end{equation}
The fact that relationship d? is identifying the reason that a reference to a role has nested within it a reference to a character. The fact that relationship d?? is identifying is the reason that a reference to a character has a reference to a play nested within it and hence why a reference to a role has nested reference to a character which in turn has a nested reference to a play.

The other path proceeds via type \textit{production} and consists of relationship \textit{d2} followed by relationship \textit{r2}:
\begin{equation}
\label{dramaticArtsPath2..diagram}
\scalebox{0.95}{\input{\ImagesFolder/dramaticArtsPath2..diagram.tex}}
\end{equation}
The fact that relationship d? is identifying the reason that a reference to a role has nested within it a reference to a production. The fact that relationship d?? is identifying is the reason that a reference to a production has a reference to a play nested within it and hence why a reference to a role has nested reference to a production which in turn has a nested reference to a play.

As we have seen these two nested references to a play are shared in our example and in fact they are shared in any reference to a role because of
the equivalence of these two paths. 
The simple existence of these comparable paths in the diagram of figure \ref{dramaticArts1..diagram}
does not imply their equivalence.

To understand the referencing of roles we need understand the equivalence of these two paths. 
So significant is this that the equivalence ought to be specified in the entity model in some way.
For now we can imagine annotating the diagram in some way to indicate that these two paths are equivalent 
or else specifying in a separate document or in a separate diagram. 
One way of specifying is by writing the equation
\begin{equation}
\label{dramaticArtsDramaticRolePathEquivalence}
r4 \circ d1 = d2 \circ r2
\end{equation}

Another way is to take diagram ((\ref{dramaticArtsPortrayalScopeFragment..diagram})), 
to flip it  around, and to draw  in this reduced form like this
\begin{equation}
\label{dramaticArtsPortrayalScopeAppearance1}
\input{\ImagesFolder/dramaticArtsPortrayalScope..diagram.tex}
\end{equation}
and to assert that this diagram commutes.

This is our preferred diagrammatic way of presenting equivalent paths in this book and we return to this subject in a later section where we refer to such a diagram as this as a scope diagram. 
We also in the habit of writing equations such as (\ref{dramaticArtsDramaticRolePathEquivalence}) on the entity relationships diagram itself.
We can think of dramatic roles coming into being when productions of plays are being cast. What the commutivity of this diagram expresses is when a production of a play is being cast then it is all characters from the play that are being cast not characters from plays in general. 
The relationship ``the portray of'', we say, is restricted in scope.

\subsubsection {Comparable paths that are not equivalent --- Route City State}
\mynote \commentary{The Russian Doll analogy breaks down here but not totally. 
Open one doll and there are multiple dolls in side it.}
Now consider this example reference
\begin{equation}
\mbox{the route from Hot Springs, Arkansas to Jacksonville in the same state.}
\end{equation}
In this reference there are, implicitly, two nested references
\begin{equation}
\mbox{the city of Hot Springs in the state  Arkansas}
\end{equation}

\begin{equation}
\mbox{the city of Jacksonville in the state  Arkansas}
\end{equation}

The types, relationships and identifying features that are illustrated here
I would sketch out as follows

\begin{equation*}
\input{\ImagesFolder/routeCityState..topdown..diagram.tex}
\end{equation*}
\begin{equation*}
\input{\ImagesFolder/routeCityState..leftright..diagram.tex}
\end{equation*}


\mynote 
As before in example () the reference () has two nested references and these themselves have a common nested reference namely
\begin{equation*}
\mbox{the state Arkansas}
\end{equation*}
The difference between this example and the previous one is that the commonality of the secondary nested reference is not  \textit{a priori}
 common to the two primaries --- in this example
 \begin{equation*}
 \mbox{the route from Hot Springs, Arkansas to Jacksonville, Alabahma.}
\end{equation*}
\mynote
WE noted earlier that commonality of the secondary nested references was guaranteed in the earlier example because of the equivalence of two paths or, in other words the commutivity of a certain diagram (diagram ()).
In this second example commonality is not guaranteed. Equally we can say that the following two comparable paths are not equivalent:

Another ways of saying this is by saying that the following diagram does not commute:
\begin{equation*}
\input{\ImagesFolder/routeCityCityState..topdown..diagram.tex}
\end{equation*}

\begin{equation*}
\input{\ImagesFolder/routeCityCityState..leftright..diagram.tex}
\end{equation*}

\subsection{Context and the Referencing of Entities}
\mynote
We examine how,  when some identifying features are relationships, the referencing 
--- the nature of the reference ---   
is impacted by the context within which the reference is being made. 
The reference is  a noun phrase quoting the values of identifying attributes
and with the number quoted depending on 
the context within which the reference is made.
What we see contributes to a later analysis --- the analysis of  how 
instances of a relationship can be conveyed, communicated or stored.
\subsection{Entity Models and Equivalent Paths}
\mynote
In these examples we have shown that, however expressed,  the specifications of equivalent paths are
an important supplement to entity relationship diagrams. 
An entity model in the main part consists of at least an entity relationship diagram  
plus a statement of path equivalences.
\mynote
I don't expect the reader to be a mathematician but, for those readers that are, an entity model in the main part is a presentation 
(or, equivalently, a sketch) of a category of some kind. 