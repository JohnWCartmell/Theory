
\newcommand{\Imappedrule}[2]  {I\left(\gatrawdisplayrule{#1}{#2}\right)}
\newcommand{\sectionsofImappedrule}[2] { Sect \left( \Imappedrule{#1}{#2} \right)}

If $I$ is a  mapping of derived T-rules and $\in$-rules of a theory $U$ to objects, respectively sections of a contextual category \catcw then
for any non-empty context $\xDelta{n}$ of $U$ by the mapping under $I$ of this context we shall mean the mapping under $I$ of the derived rule
\gatdisplayrule{\xDelta{n-1}}{\isT{\Delta_n}}.  By the mapping under $I$ of the empty context we shall mean the terminal object $1$ of \catc.

\newcommand{\sjconclusion}{\ofT{s_j}{\Omega_j[s_1|y_1,...s_{j-1}|y_{j-1}]}}
\newcommand{\sjrule}   {\gatdisplayrule{Q}{\sjconclusion}}
\newcommand{\omegarule}[1][]{\gatdisplayrule[#1]{\yOmega{m}}{\isT{\Omega}}}
\newcommand{\srule}    {\gatdisplayrule{\yOmega{m}}{\ofT{s}{\Omega}}}
\newcommand{\omegarulesubstituted}[1][]{\gatdisplayrule[#1]{Q}{\isT{\Omega[s_1|y_1...s_m|y_m]}} }
\newcommand{\srulesubstituted}[1][]{\gatdisplayrule[#1]{Q}{\ofT{s[s_1|y_1...s_m|y_m]}{\Omega[s_1|y_1...s_m|y_m]}} }
\newcommand{\ssubbedfory}{s_1|y_1,...s_m|y_m}

\begin{definition}
If $U$ is a generalised algebraic theory and if \catcw is a contextual category 
and if $I$ is a \newt{partial} mapping of derived T-rules and $\in$-rules of the theory $U$ to objects, respectively sections of the contextual category \catcw
then we define any particular derived rule $r$ of $U$ to be \term{consistently interpreted} by $I$ as follows: \\
\begin{enumerate}[(i)]
%\setlength\itemindent{2cm}
\item \underline{\textbf{T-rule}} 
Suppose that  the rule $r$ is the T-rule \omegarule and let $r_m$ be the rule
\gatdisplayrule{\yOmega{m-1}}{\isT{\Omega_m}}
then $r$ is consistently interpreted by $I$ iff
\begin{enumerate}[(a)]\commentary{is this inductive definition really well-defined? is it a definition at all?} \commentary{I think so because we could just unwrap this new bit into
realisations $\tuple{s_1,...s_j}$ etc.}
\item \newt{$I(r_m)$ is defined and $r_m$ is consistently interpreted by $I$ and} $I(r_m) \base\, I(r)$ in \catcw  and
\item
for all contexts $Q$ and for all realisations $\tuple{\sm}$ of $\yOmega{m}$ wrt $Q$, 
$$ \Imappedrule{Q}{\isT{\Omega[s_1|y_1...s_m|y_m]}} = \gmstar...\gonestar(\crossx{a}{\Imappedrule{\yOmega{m}}{\isT{\Omega}}}{1})$$
where \foreachj, $g_j$ is the section
$\displaystyle\Imappedrule{Q}{\sjconclusion}$ and where $a$ is the object to which $I$ maps context $Q$. 
\end {enumerate}
\item \underline{\textbf{$\boldsymbol {\in}$-rule}} 
Suppose that $r$ is the $\in$-rule \srule then
$r$ is consistently interpreted by iff

\begin{enumerate}[(a)]
\item if $s$ is the variable $y_j$, \forsomej, the $r$ is consistently interpreted
by $I$ iff $I(r)$ is the section\footnote{\highlight{CHECK AFTER CHANGE OF CONTEXT}
With these assumptions, $s(p_{b_m,b_j}): b_m \morph \crossx{b_m}{b_j}{b_{j-1}}$ in \catcw because by definition  $s(p_{b_m,b_j}): b_m  \morph (p_{b_m,b_j} \circ p_{b_j})^*b_j$,
and we have 
\begin{align*}
(p_{b_m,b_j} \circ p_{b_j})^*b_j &= {p_{b_m,b_{j-1}}} ^* b_j  && \mbox{ because $p_{b_m,b_j} \circ p_{b_j}=p_{b_m,b_{j-1}}$,} \\
                                 &= \crossx{b_m}{b_j}{b_{j-1}} && \mbox{ by definition of $\crossx{}{}{w}$}.
\end{align*}
} % end footnote  
$s(p_{b_m,b_j})$ of the object $\crossx{b_m}{b_j}{b_{j-1}}$ where \foreachj, $b_j$ is the object
$\displaystyle\Imappedrule{\yOmega{j-1}}{\isT{\Omega_j}}$.  \commentary{\highlight{CHECK}}
Note that $p_{b_m,b_m}$ is defined to be $id_{b_m}$ and so in the case of $j=m$, $r_t$
is mapped to   $s(id_{b_m})$,
\item otherwise $r$ is consistently interpreted by $I$ iff $\displaystyle I(r) \in \sectionsofImappedrule{\yOmega{m}}{\isT{\Omega}}$ and
for all contexts $Q$ and for all realisations $\tuple{\sm}$ of $\yOmega{m}$ wrt $Q$, 
$$ \Imappedrule{Q}{\ofT{s[s_1|y_1...s_m|y_m]}{\Omega[s_1|y_1...s_m|y_m]}} = \gmstar...\gonestar(\crossx{a}{\Imappedrule{\yOmega{m}}{\ofT{s}{\Omega}}}{1})$$
where \foreachj, $g_j$ is the section
$\displaystyle\Imappedrule{Q}{ \ofT{s_j}{\Omega_j [s_1|y_1...s_{j-1}|y_{j-1}]}}$
and where $a$ is the object to which $I$ maps context $Q$.
\end{enumerate}

\item \underline{\textbf{T=-rules}} 
If $r$ is the rule  \gatdisplayrule{\xDelta{n}}{\Delta = \Delta'} 
then $r$ is interpreted consistently by $I$ iff
$$
\Imappedrule{\xDelta{n}}{\isT{\Delta}} = \Imappedrule{\xDelta{n}}{\isT{\Delta'}}
$$
 
\item \underline{\textbf{$\boldsymbol{\in=}$-rules}} 
If $r$ is the rule  \gatdisplayrule{\xDelta{n}}{t = t' \in \Delta} 
then $r$ is interpreted consistently by $I$ iff
$$
\Imappedrule{\xDelta{n}}{\ofT{t}{\Delta'}} = \Imappedrule{\xDelta{n}}{\ofT{t'}{\Delta'}}
$$
\end{enumerate}
\end{definition}
\highlight{END of DEFINITION OF consistently interpreted}


\begin{definition}
An \term{instance} of a generalised algebraic theory $U$ in a contextual category \catcw is  any mapping 
of derived T-rules and $\in$-rules of the theory $U$ to objects, respectively sections of the contextual category \catcw that
consistently interprets every derived rule of $U$.
\end{definition}

\begin{lemma}
\llabel{newsubstitutionlemma}
Suppose that $r$ is the $\in$-rule \srule and that
$r$ is consistently interpreted by then
for all contexts $Q$ and for all realisations $\tuple{\sm}$ of $\yOmega{m}$ wrt $Q$, 
$$ \Imappedrule{Q}{\ofT{s[s_1|y_1...s_m|y_m]}{\Omega[s_1|y_1...s_m|y_m]}} = \gmstar...\gonestar(\crossx{a}{\Imappedrule{\yOmega{m}}{\ofT{s}{\Omega}}}{1})$$
where \foreachj, $g_j$ is the section
$\displaystyle\Imappedrule{Q}{ \ofT{s_j}{\Omega_j [s_1|y_1...s_{j-1}|y_{j-1}]}}$
and where $a$ is the object to which $I$ maps context $Q$.
\end{lemma}
\begin{proof}
The defn gives us this for non-variables. Remains to prove in the case when $s$ is a variable. Suppose $s$ is the variable
$y_j$. Since in this case $s[s_1|y_1...s_m|y_m]$ is $s_j$ what we have to show is that:
$$g_j = \gmvectorstar(\crossx{a}{s(p_{b_m,b_j}}{1}))$$. This is ????????????.
\end{proof}

\begin{observation}
\llabel{typeweakeningobservation}
In the situation of  partial mapping $I$ 
if \omegarule is a derived of $U$ for which $I$ is defined and which is consistently interpreted by $I$ and if $Q$ is a context which is mapped to an object $a$ by $I$ 
then $\Imappedrule{Q}{\isT{\Omega_1}}=\crossx{a}{b_1}{1}$ where $b_1=\Imappedrule{}{\isT{\Omega_1}}$.
\end{observation}


\begin{oldtt}
It is useful to observe now that if we take the  $\Delta$ in clause (iii) of this definition of the substitution property 
to be $\Delta_n$ then we get the following:
\begin{observation}
\llabel{substitutionpropertyvariant}
\newcommand {\forceSOURCEwidth}{\rule{5cm}{0pt}}  % so as to line up three different arrays
\newcommand {\forceTARGETwidth}{\rule{2.2cm}{0pt}}
If $I$ is a partial mapping of T-rules and $\in$-rules of a theory $U$ to objects, respectively sections of a contextual category \catcw
which is \term{consistent} and has the substitution lemma then if $Q$ is any context and if $\tuple{\sm}$ is a realisation of $\tuple{\yOmega{m}}$ with respect to $Q$
such that we have the following mappings by $I$ into the objects and sections of \catc:
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
Q          & \Imapsto & a   \\ [0.4cm]
\sjrule    & \Imapsto & f_j \\ [0.4cm]
\end{array}
\end{equation*}
then $f_j \in Sect(f_{j-1}^*...f_i^*(\crossx{a}{b_j}{1}))$.
\end{observation}
\end{oldtt}


We can show that an instance $I$ of a generalised algebraic theory $U$ in a contextual category \catcw is
completely determined by its mapping of the introductory rules of sort symbols and operator symbols to
objects, respectively, sections of \catc. In order to show this we start with this definition:
\begin{definition}
If $U$ is a generalised algebraic theory  and if \catcw is a contextual category then
a \term{interpretation} $I$ of  $U$ in \catcw consists of a pair :
\begin{itemize}
\item a mapping $\Isort$ that maps each sort symbol of $U$ to  an object of \catc,
\item a mapping $\Iop$ that maps each operator symbol of $U$ to a section of \catcw (i.e. to a morphism $f: A \morph B$ for some 
$A \base B$ in \catcw such that $f \circ p_B=id_A$).
\end{itemize}
\end{definition}


We will say that  an interpretation $I$ of $U$ in \catcw \term{determines} an  instance $J$ of $U$ in \catcw to mean that for each sort symbol $A$ of $U$,
$J(r_A) = I_{sort}(A)$, where $r_A$ is the introductory rule for $A$ and that for each operator symbol
$f$ of $U$,   $J(r_f) = I_{op}(f)$, where $r_f$ is the introductory rule for $f$.

\newcommand{\Ibar}{\mkern 2.5mu\overline{\mkern-2.5mu I\mkern1.5mu}\mkern -1.5mu}

\newpage
\begin{definition} [\highlight{Definition of \large $\Ibar$}]
If $I$ is an interpretation of generalised algebraic theory $U$ in contextual catgeory \catcw
then define a
partial mapping $\Ibar$  of T-rules and $\in$-rules to objects, respectively sections, of \catcw
as follows
\begin{enumerate}[(i)] 
\item \underline{\textbf{T-rules}} 
The derivation lemma (lemma \ref{derivationlemma}) tells us that if $r_\Delta$ is a derived T-rule of $U$  then it is of the form \gatdisplayrule{P}{\isT{A(t_1,...t_n)}} for some premise $P$, for some $n \geq 0$ and for some sort symbol $A$ with introductory rule $r_A$ of the form \gatdisplayrule{\xDelta{n}}{\isT{A(x_1,...x_n)}} where \foreachi, the rule 
\gatdisplayrule[,]{P}{\ofT{t_i}{\Delta_i[t_1 | x_1,...t_{i-1}|x_{i-1}]}} which we will call $r_{t_i}$, is a derived rule of $U$. 
We define $\Ibar(r_\Delta)$ to be undefined unless the following preconditions are met:
\begin{enumerate}[(a)]
\item
the context  $P$ is mapped by $\Ibar$ to some object $a$ of \catcw and 
\item
\foreachi, the context $\xDelta{i}$ is mapped by $\Ibar$ to some object $b_i$ of \catcw
and $1 \base b_1,...\base b_n \base I(A)$ in \catcw and
\item
$\Ibar(r_{t_i})$ is defined and $\Ibar(r_{t_i}) \in Sect(\Ibar(r_{t_{i-1}})^*...\Ibar(r_{t_1})^*(\crossx{a}{b_i}{1})$, \foreachi,
\end{enumerate}
in which case we define $\Ibar(r_\Delta)$ to be $\Ibar(r_{t_n})^*...\Ibar(r_{t_1})^*(\crossx{a}{I(A)}{1})$. 
\item \underline{\textbf{$\boldsymbol {\in}$-rules}} 
The derivation lemma also tells us that if $r_t$ is an $\in$-rule then it is  
either \highlight{(1)} of the form \gatdisplayrule{\xDelta{n}}{\ofT{x_i}{\Omega}} for some $n \ge 1$, for some $i$, $1 \leq i \leq n$, 
and for some $\Omega$ such that \gatdisplayrule{\xDelta{n}}{\Delta_i=\Omega} is a derived rule of $U$
or \highlight{(2)} it is of the form \gatdisplayrule{P}{\ofT{f(t_1,...t_n)}{\Omega}} for some premise $P$, for some $n \geq 0$ and for some operator symbol $f$ with introductory rule $r_f$ of the form \gatdisplayrule{\xDelta{n}}{\ofT{f(x_1,...x_n)}{\Delta}} where \foreachi, the rule 
\gatdisplayrule{P}{\ofT{t_i}{\Delta_i[t_1 | x_1,...t_{i-1}|x_{i-1}]}}, which we will call $r_{t_i}$, is a derived rule of $U$. 

In  case (1) we define $\Ibar(r_t)$ to be undefined unless  unless the following preconditions are met:
\begin{enumerate}
\item
\foreachi, the context $\xDelta{i}$ is mapped by $\Ibar$ to some object $a_i$ of \catcw such
that $1 \base a_1,...\base a_i$ and
\item the rule \gatdisplayrule{\xDelta{n}}{\isT{\Omega}}, which we call $r_\Omega$, is mapped by $\Ibar$ to the object $\crossx{a_n}{a_i}{a_{i-1}}$
\end{enumerate}
in which case we define $\Ibar(r_t)$ to be $s(p_{a_n,a_i})$ . 

In  case (2) 
we define $\Ibar(r_t)$ to be undefined unless  unless the following preconditions are met:
\begin{enumerate}
\item
the context  $P$ is mapped by $\Ibar$ to some object $a$ of \catcw and 
\item
\foreachi, the context $\xDelta{i}$ is mapped by $\Ibar$ to some object $b_i$ of \catcw
and 
\item the rule \gatdisplayrule{\xDelta{n}}{\isT{\Delta}} is mapped by $\Ibar$ to some object $b$ of \catcw and
$1 \base b_1,...\base b_n \base b$ in \catcw 
and 
\item
\foreachi, $\Ibar(r_{t_i}) \in Sect(r_{t_{i-1}}^*...r_1^* (\crossx{a}{b}{1}))$
\end{enumerate}
in which case we
define $\Ibar(r_t)=\Ibar(r_{t_n})^*...\Ibar(r_{t_1})^*(\crossx{a}{I(f)}{1})$.
This completes the definition of $\Ibar$.
\end{enumerate}
\highlight{END OF Definition of \large $\Ibar$}
\end{definition}


\begin{lemma}
\llabel{Ibartowerlemma}
Suppose that  the rule $r$ is the T-rule \omegarule and that $r$ is a derived rule of $U$. 
Let $r_j$ be the rule
\gatdisplayrule{\yOmega{j-1}}{\isT{\Omega_j}}. This is a derived rule of $U$ by lemma xxx.
Suppose that $\Ibar(r)$ is defined then
$\Ibar(r_j)$ is defined \foreachj, and 
$\Ibar(r_1) \base  ... \base \Ibar(r_m) \base \Ibar(r)$ in \catc.
\end{lemma}
\begin{proof}
It follows from the definition of $\Ibar$ that since $\Ibar(r)$ is defined that $\Ibar(r_m)$ is defined and that
$\Ibar(r_m) \base \Ibar(r)$ in \catc. Now we can repeat and argue that $\Ibar(r_{m-1})$ is defined and that $\Ibar(r_{m-1}) \base \Ibar(r_m)$
in \catc. By induction $\Ibar(r_1) \base  ... \base \Ibar(r_m) \base \Ibar(r)$ in \catc, as required.
\end{proof}

\begin{lemma} 
If $I$ is an interpretation of generalised algebraic theory $U$ in contextual catgeory \catcw then then if $I$ determines an instance of $U$ then the
mapping $\Ibar$  is total i.e. is defined for all T- and $\in$-rules and the instance determined by $I$ is $\Ibar$.
\end{lemma}
\begin{proof}  
Use the lemma regarding the interpretation of substitutions (lemma \ref{substitutioninterpretation})...\commentary{expand}
\end{proof}

The condition under which an interpretation of $U$ in \catcw determines an instance i.e that the rule mapping $\Ibar$ is total and respects the axioms can be summarised as being that the interpretation\commentary{slight reword needed} needs be type correct and to satisfy the axioms of the theory. The definition of exactly what we mean by this has to proceed by induction because, for example, we need an instance of the rule
\gatdisplayrule{\xDelta{n}}{\isT{\Delta}} (as an object $a$ of \catc, say) before we can say whether an interpretation of an operator with introductory rule \genericfintroductoryrule
is well-typed (i.e. to know that it is object $a$ that it is required to be a section of).
Similarly we need to be able to interpret both sides of an axiom before we can say whether it is respected
by the interpretation. For this induction to proceed we need an intermediate definition:

\def\restrict{\mathbin{\restriction}}
\newcommand{\predInstance}{\overline{I \restrict U_p}}
\newcommand{\Uincrement}{U \setminus\kern-2pt U_p}

\begin{definition}
Suppose $U$ is a finitely stratified generalised algebraic theory and 
suppose that $U_p$ is the predecessor theory to $U$. Suppose that $I$ is an interpretation of $U$  and that  $I \restrict U_p$  
determines an instance $\predInstance$ of $U_p$.
Define interpretation $I$ to be \term{relatively well-typed}  iff 

\begin{enumerate}[(i)]
\item
$I$ is well-typed on sort symbols $A$ of $U$ that are additional to those in $U_p$. This we define to mean that
for all sort symbols $A$ in $\Uincrement$, if $A$ has introductory rule 
\genericAintroductoryrule then $I$ maps this rule to a cover of \,$\predInstance(r_n)$ in \catc, where $r_n$ is the rule 
\gatdisplayrule{\xDelta{n-1}}{\isT{\Delta_n}} (which, as required and due to the stratification, is a derived rule of $U_p$).
\item  $I$ is well-typed on operator symbols  of $U$ that are additional to those of $U_P$. This we define to mean that
for all sort symbols $f$ in $\Uincrement$, if $f$ has introductory rule 
\genericfintroductoryrule then $I$ maps this rule to a section 
of $\predInstance(r)$ where $r$ is the rule
\gatdisplayrule{\xDelta{n}}{\isT{\Delta}} (which, as required and due to the stratification, is a derived rule of $U_p$). 
\end{enumerate}

Define interpretation $I$ to be \term{relatively valid}  iff  \commentary{take this equality of the rule mappings to mean that one is defined iff the other  is dfefined and then they are both equal}
\begin{enumerate}[(i)]
\item \underline{\textbf{T=-axioms}} 
for all axioms of $\Uincrement$ of the form
 \gatdisplayrule{\xDelta{n}}{\Delta = \Delta'},
$\predInstance(r) = \predInstance(r')$ where $r$ is the rule
\gatdisplayrule{\xDelta{n}}{\isT{\Delta}} and  
and $r'$ is the rule \gatdisplayrule{\xDelta{n}}{\isT{\Delta'}}
\item \underline{\textbf{$\boldsymbol{\in=}$-axioms}} 
for all axioms of $\Uincrement$ of the form \commentary{ditto}
\gatdisplayrule{\xDelta{n}}{t = t' \in \Delta},
$\predInstance(r_t) = \predInstance(r'_t)$ where $r_t$ is the rule
\gatdisplayrule{\xDelta{n}}{\ofT{r_t}{\Delta}} and  
and $r'_t$ is the rule \gatdisplayrule{\xDelta{n}}{\ofT{t'}{\Delta'}}.
\end{enumerate}
\end{definition}

For the inductive step we require:

\begin{lemma}
\llabel{interpretationlemmainductivestep}
Suppose $U$ is a finitely stratified generalised algebraic theory and 
suppose that $U_p$ is the predecessor theory to $U$. Suppose that $I$ is an interpretation of $U$  and that  $I \restrict U_p$  
determines an instance $\predInstance$ of $U_p$.
If interpretation $I$ is relatively well-typed and relatively valid then $\Ibar$ is an instance.
\end{lemma}
\begin{proof} 
\newcommand {\forceSOURCEwidth}{\rule{5cm}{0pt}}  % so as to line up three different arrays
\newcommand {\forceTARGETwidth}{\rule{2.2cm}{0pt}}
We need to show that for every derived rule $r$ of $U$, $\Ibar(r)$ is defined and $r$ is consistently interpreted\footnote{To be formally correct we need a definition of \textit{consistently interpreted} for partial mappings of rules not just total mappings -- since here at the point we use the definition we have not yet proved $\Ibar$ to be total.} by $\Ibar$. 
We prove this by induction on the derivation of rules in $U$. We examine each of the principles of derivation in turn
and show that given the stated assumptions then from rules for which $\Ibar$ is defined and which are consistently interpreted by $\Ibar$ 
it is only possible to derive rules for which $\Ibar$ is defined and which themselves are consistently interpreted by $\Ibar$.
The principles of derivation (see \cite{Cartmell86}) are LI1, ... LI7, T1, CF1, CF2(a) and CF2(b), SI1 and SI2. 
The proof of this  in each the cases  LI1,...LI6 is quite trivial. We consider each of the remaining principles in turn. 
 \\
\underline{LI7} This is not quite trivial but related to principle T1. \highlight{Think about this.} \\


\underline{T1}
By this principle from \gatdisplayrule{P}{\Delta=\Delta'} and \gatdisplayrule{P}{\ofT{t}{\Delta}} we can derive \gatdisplayrule[.]{P}{\ofT{t}{\Delta'}}
By the inductive hypothesis we assume that rule  \gatdisplayrule{P}{\Delta=\Delta'} is consistently interpreted by $\Ibar$ i.e. that
$\Ibar$ is defined at both $r_\Delta$ and $r_{\Delta'}$  and that $\Ibar(r_\Delta) = \Ibar(r_{\Delta'})$
and we also assume that $\Ibar$ is defined at $r_{t\Delta}$ and that this rule
is consistently interpreted by $\Ibar$ i.e. that $\Ibar(r_{t\Delta}) \in Sect(I(r_{\Delta}))$.
We have to show that $\Ibar$ is defined at the rule $r_{t\Delta'}$ and that this rule, $r_{t\Delta'}$, is consistently interpreted 
by $\Ibar$ i.e. that $\Ibar(r_{t\Delta'}) \in Sect(I(r_{t\Delta'}))$. 
In addition, in the case that  $t$ is simply a variable we are required to show  that $\Ibar(r_{t\Delta'})$ has an appropriate value.

Now from the definition of $\Ibar$ it can be seen that providing that the preconditions are met then  the value of $\Ibar$ at $r_{t\Delta'}$  is the same
as the value at $r_{t\Delta}$ (since the definition of the value is independent of the type -- $\Delta$ or $\Delta'$) and therefore that the condition(s) for the consistent interpretation of $r_{t\Delta'}$ are met 
since we have that $Sect(I(r_{t\Delta'}))=Sect(I(r_{t\Delta}))$ as we have assumed that $I(r_{t\Delta'})=I(r_{t\Delta})$. 
Therefore we simply need to show that the preconditions
for $\Ibar$ being defined at $r_{t\Delta'}$ hold.
From examination of the preconditions for $\Ibar$ to be defined at $r_{t\Delta'}$ we see that, whether or not $t$ is simply a variable, 
each precondition is either independent of the type (i.e. $\Delta'$) in which case must hold,  as we have assumed that 
$\Ibar(r_{t\Delta})$ be defined,
 or  else  follows directly from our assumption that 
$\Ibar$ is defined both at $r_\Delta$  and $r_{\Delta'}$ and that $\Ibar(r_\Delta) = \Ibar(r_{\Delta'})$.\\


\underline{CF1} According to the principle, whenever a rule of the form \gatdisplayrule{\xDelta{n}}{\isT{\Delta_{n+1}}} is a derived rule of $U$ 
then so to is the rule \gatdisplayrule{\xDelta{n+1}}{\ofT{x_i}{\Delta_{i}}}, \foreachi[n+1], where $x_{n+1}$ is any variable distinct from each of the variables $\xn$.
We have to show that if $\Ibar$ is defined for and consistently interprets any such T-rule, which we will denote, $r_{\Delta_{n+1}}$, 
then so to is $\Ibar$ defined for and consistently interprets each associated rule $r_{x_i}$. 
We show that  if it is the case for $r_{x_j}$ all $j <i$ then it follows that it is the case for
$r_{x_i}$ also. In so doing we establish that it holds for all $i \leq n +1 $, as required. 

\begin{oldtt}
In the case that $i=1$ we have to show first that the preconditions for $\Ibar(r_{x_1})$ to be defined hold. These are
that
\begin{enumerate}[(a)]
\item \foreachi, the context $\xDelta{i}$ is mapped by $\Ibar$ to some object $a_i$ of \catcw such
that $1 \base a_1,...\base a_i$, this follows from lemma \lref{Ibartowerlemma}, \commentary{CHECK}
\item $\Ibar$ maps the rule \gatdisplayrule{\xDelta{n+1}}{\isT{\Delta_{1}}} to the object $\crossx{a_{n+1}}{a_1}{1}$, 
This follows by observation \lref{typeweakeningobservation} because it follows from the assumption that $r_{\Delta_{n+1}}$ is consistently interpreted by $\Ibar$
and from the definition of what this means  that the rule \gatdisplayrule{Empty}{\isT{\Delta_1}} is consistently interpreted by $\Ibar$.
\end{enumerate} 
We also have to show that $\Ibar(r_{x_1})=s(p_{a_{n+1},a_1})$ but this is exactly the definition $\Ibar(r_{x_1})$.
\end{oldtt}
\vspace{2in}
So, suppose that for each $j$, $j < i$, that $\Ibar$ is defined for and consistently interprets the rule $r_{x_j}$ , in particular that
$\Ibar(r_{x_j})=s(p_{a_{n_1},a_j})$. 
We shall now show that it follows that 
$\Ibar$ is defined at the rule $r_{x_i}$ and that this rule is consistently interpreted by $\Ibar$ by showing that
$\Ibar(r_{x_i})=s(p_{a_{n_1},a_i})$. 

%Denote the former rule $r_{\Delta_{n+1}}$ and the latter rule $r_{x_i}$. 
First we have to show that the preconditions for $\Ibar$ to be defined at the rule $r_{x_i}$ hold. These are:

\begin{enumerate}
\item that \foreachi, the context $\xDelta{i}$ is mapped by $\Ibar$ to some object $a_i$ of \catcw such
that $1 \base a_1,...\base a_i$. This follows from lemma \lref{Ibartowerlemma}, 
\item that the rule \gatdisplayrule{\xDelta{n+1}}{\isT{\Delta_i}} is mapped by $\Ibar$ to the object $\crossx{a_{n+1}}{a_i}{a_{i-1}}$.

\newcommand{\deltaimapped}{\crossx{a_{n+1}}{a_i}{a_{i-1}}}
\newcommand{\deltaimappedlong}{s(p_{a_{n+1},a_i})^*...s(p_{a_{n+1},a_1})^*(\crossx{a_{n+1}}{a_i}{1})}

Now since we have that $\Ibar$ maps 
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{\xDelta{i-1}}{\isT{\Delta_i}}  & \Imapsto & a_i \\ [0.4cm]
\end{array}
\end{equation*}
and since we have that
$\tuple{x_1,...x_{i-1}}$ is a realisation of context $\xDelta{i-1}$ with respect to context $\Delta_{n+1}$ 
and since we have assumed for each $j<i$ that $r_{x_j}$ is consistently interpreted by $\Ibar$ and in particular
that
\begin{equation*}
\begin{array}{c c c }
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{\xDelta{n+1}}{\ofT{x_j}{\Delta_j}}  & \Imapsto & s(p_{a_{n+1},a_j}) \\ [0.4cm]
\end{array}
\end{equation*}
since we have assumed that $r_{\Delta_i}$ is consistently interpreted by $\Ibar$ and in particular that clause (ii)(b) of the definition of consistently interpreted holds
then 
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{\xDelta{n+1}}{\isT{\Delta_i[x_1|x_1,...x_{i-1}|x_{i-1}]}}  & \Imapsto & \deltaimappedlong \\ [0.4cm]
\end{array}
\end{equation*}
i.e.
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{\xDelta{n+1}}{\isT{\Delta_i}}  & \Imapsto & \deltaimappedlong.\\ [0.4cm]
\end{array}
\end{equation*}
So we are done if we can prove that
\begin{equation*}
\deltaimappedlong = \deltaimapped
\end{equation*}  
This is given by lemma \highlight{yet to be stated}.
\end{enumerate}
Next we have to show that 
\begin{enumerate}[3.]
\item the rule $r_{x_i}$ is consistently interpreted by $\Ibar$ i.e. that $\Ibar(r_{x_i})=s(p_{a_{n+1},a_i})$ but this is just the defintion of $\Ibar$
at $r_{x_i}$ so it just suffices to show that the preconditions hold.
\end{enumerate}
\newpage

\underline{CF2(a)}
By this principle, from a sort symbol $A$ with introductory rule $r_A$ of the form \gatdisplayrule[,]{\xDelta{n}}{\isT{A(\xn)}} for some $n \geq 0$, if
$P$ is a context and if in particular the rule $r_P$ asserting that $P$ is a context is a derived rule of $U$
and from derived rules $r_{t_i}$ of the form \gatdisplayrule{P}{\ofT{t_i}{\Delta_i[t_1|x_1,...t_{i-1}|x_{i-1}]}}, \foreachi, we may deduce
the rule \gatdisplayrule{P}{\isT{A(t_1,...t_n)}}, which we shall denote by $r$, is a derived rule of $U$. \\

\noindent Assume as the inductive hypothesis that $\Ibar(r_{t_i})$ is defined \foreachi. We can show that $\Ibar(r)$ is defined providing we can show that conditions (a), (b) and (c) of part (i) of the definition of $\Ibar$ are met. \\
\noindent Precondition (a), that $P$ is mapped by $\Ibar$ to some object $b$ \highlight{$b_m$} of \catc, follows from the inductive hypothesis applied to  rule $r_P$ asserting that $P$ is a context.  \\
\noindent Precondition (b) follows from the assumption that $\Ibar$ is relatively well-typed because rule $r$ is well-typed relative to the theory
$U_p$ because $U$ is a generalised algebraic theory. 
\noindent Therefore $r_{\Delta_n}$ is a derived rule of $U_p$\\ and so $\predInstance(r_{\Delta_n})$ is defined  because $\predInstance$ is assumed to be total. 
Therefore $\Ibar(r_{\Delta_n})$ is defined since
$\Ibar$ extends $\predInstance$ since $I$ extends $I \restrict U_p$. 
\noindent  Precondition (c) follows firstly, because that \foreachi, $\Ibar(r_{t_i})$ is defined, is given by the inductive hypothesis and 
secondly, that $\Ibar(r_{t_i}) \in Sect(\Ibar(r_{t_{i-1}})^*...^*\Ibar(r_{t_{1}})^*(\crossx{b_m}{a_i}{1}))$ follows  from 
the inductive hypothesis {CHECK}.\\

\begin{newtt}
\highlight{Next show the substitution operates as it should.} 
                                                              \commentary{ Need unify the above and the below.} \\

\newcommand{\clausethreelhs}{(\gmvectorstar (\crossx{c}{f_n}{1}))^* ... (\gmvectorstar (\crossx{c}{f_1}{1})) ^* (\crossx{b_m}{I_A}{1})}
\newcommand{\clausethreerhs}{\gmvectorstar (  \crossx{c}{(\fnvectorstar(\crossx{b_m}{I_A}{1}))}{1} )}
\newcommand{\tirule}{\gatdisplayrule{\yOmega{m}}{\ofT{t_i}{\Delta_i[t_1 | x_1,...t_{i-1}|x_{i-1}]}}}
Now assume that $P$ is the context $\yOmega{m}$, for some $m \geq 0$, so that $r$ is the rule \gatdisplayrule{\yOmega{m}}{\isT{A(\tn)}}
and suppose $r$  is mapped by $\Ibar$ to some object $b$ of \catcw such that $1 \base b_1 ... \base b_m \base b$. 

Now there are sections  $f_1,..f_n$  of \catcw such that, \foreachi, $\Ibar$ maps
\begin{equation}
\label{timapping}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\tirule    & \Imapsto & f_i \\ [0.4cm]
\end{array}
\end{equation} 
Now from the definition of $\Ibar$, we have that $\Ibar$ maps
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{\yOmega{m}}{\isT{A(\tn)}}   & \Imapsto & \fnvectorstar(\crossx{b_m}{I_A}{1})\\ [0.4cm]
\end{array}
\end{equation*} 

Assume also  that $Q$ is a context and that $\tuple{\sm}$ is a realisation of $\tuple{\yOmega{m}}$ with respect to $Q$
and that there is the following mapping by $\Ibar$ into the objects and sections of \catc:
\begin{equation}
\label{sjmapping}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
Q          & \Imapsto & c   \\ [0.4cm]
\sjrule    & \Imapsto & g_j \\ [0.4cm]
\end{array}
\end{equation}
where $g_j \in Sect(g_{j-1}^*...g_i^*(\crossx{c}{b_j}{1}))$ in \catc.

We have to establish that $\Ibar$ maps
\begin{equation}
\label{clauseiiirequiredmapping}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{Q}{\isT{A(t_1[\ssubbedfory],...t_n[\ssubbedfory])}}   & \Imapsto & \gmvectorstar (\crossx{c}{\fnvectorstar(\crossx{b_m}{I_A}{1})}{1}) \\ [0.4cm]
\end{array}
\end{equation}
Now, we deduce from \oldt{the definition of $\Ibar$} the inductive hypothesis that $r_{t_i}$ is consistently interpreted and 
from lemma \lref{newsubstitutionlemma} from (\ref{timapping}) and from (\ref{sjmapping}) that \foreachi, $\Ibar$ maps
\begin{equation}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{Q}{\ofT{t_i[\ssubbedfory]}{\Delta_i[t_1 | x_1,...t_{i-1}|x_{i-1}][\ssubbedfory]}}  & \Imapsto & \gmvectorstar (\crossx{c}{f_i}{1}) \\ [0.4cm]
\end{array}
\end{equation}
and therefore from the definition of $\Ibar$ that it maps
\begin{equation*}
\begin{array}{c c c}
\forceSOURCEwidth & & \forceTARGETwidth \\ [-0.1cm]
\gatdisplayrule{Q}{\isT{A(t_1[\ssubbedfory],...t_n[\ssubbedfory])}}  & \Imapsto & \clausethreelhs \\ [0.4cm]
\end{array}
\end{equation*}
and therefore to establish (\ref{clauseiiirequiredmapping}) we need to show that
\begin{equation*}
\clausethreelhs = \clausethreerhs										
\end{equation*}
This we can do by repeated application of identities (\ref{metagattriplestar})
and (\ref{metagatcrossstarcross}), which are two of the meta-GAT axioms described earlier.\\
\end{newtt}

\underline{CF2(b)???}
\end{proof}
\newpage
\begin{lemma}
\llabel{maininterpretationlemma}
Suppose $U$ is a  generalised algebraic theory that is stratified as  $U_0 \subseteq $U$_1 \subseteq $U$_2 \subseteq ...$. 
 Suppose that $I$ is an interpretation of $U$  and that  for each $i$, $I \restrict U_i$  
$I$ is relatively well-typed and relatively valid then $I$ determines an instance of $U$.
\end{lemma}
\begin{proof}
For each $i$, by lemma \ref{interpretationlemmainductivestep}, $I \restrict U_i$ extends to an instance of $U_i$. Define a mapping
$\Ibar$ of derived rules of $U$ to objects and sections of \catcw by defining $I(r)$ to be $\overline{I \restrict U_i}(r)$ where
$i$ is such that $r$ is a derived rule of $U_i$. $I$ is an instance because in any particular case of any of the clauses (i) - (vii) of the main definition 
there will be an $i$ so that all the rules involved are derived rules of the theory $U_i$. 
\end{proof}


\begin{lemma}
\llabel{Xnlemma}
If $I$ is an interpretation of a generalised algebraic theory $U$ in a contextual category \catcw and if $X$ is an absolute sort symbol of $U$ which is mapped 
by $I$ to an object $X$ of \catcw (so that $1 \base X$ in \catc) then for any $n \geq 1$ 
\begin{enumerate}[(i)]
\item
The context $\tuple{\ofT{x_1}{X},...\ofT{x_n}{X}}$ is mapped by $I$ to the object $X^n$ of \catc,
\item the rule 
\gatdisplayrule{\ofT{x_1}{X},... \ofT{x_n}{X}}{\ofT{x_i}{X}} is mapped by $I$ to the section $s(p_i)$ of $X^{n+1}$, where $p_i$ is the $i$'th projection morphism, $p_i: X^n \morph X$,
\item if $P$ is a context of $U$ that extends the context $\tuple{\ofT{x_1}{X},...\ofT{x_n}{X}}$ and if $P$ is mapped by $I$ to
the object $Y$ of \catcw (so that $X < Y$ in \catc) then the rule 
\gatdisplayrule{P}{\ofT{x_i}{X}} is mapped by $I$ to the section $s(p_{Y,X^n}\circ p_i)$ of object $\crossx{Y}{X}{1}$, where $p_i$ is the $i$'th projection morphism, $p_i: X^n \morph X$.
\end{enumerate}
\end{lemma}
\begin{proof}
See day book -- 20 July 2021.
\end{proof}

\begin{oldtt}
\begin{lemma}
\llabel{intermediatelemma}
If $I$ is an interpretation of generalised algebraic theory $U$ in contextual catgeory \catcw
then $\Ibar$ is consistent and had the substitution property.
\end{lemma}
\begin{proof}


That $\Ibar$ is consistent we have to show that clauses (i) and (ii) of the definition of consistency are satisfied.
That clause (i) of the definition of consistency holds follows  from clause (i) of the definition given of $\Ibar$ provided that
we can show $a \base \Ibar(r_{t_n})^*...\Ibar(r_{t_1})^*(\crossx{a}{I(A)}{1})$ in \catc. 
This follows by lemma \ref{cacscadelemma} since from the definition of $\Ibar$ it follows that $\Ibar(r_{t_1}),...\Ibar(r_{t_n})$
is a cascade from $a$ to $b_n$ in \catc. 

To show that clause (ii) of the definition of consistency holds we have to show that, under the assumptions made in that clause 
that $\Ibar(r_t) \in \Ibar(r_\Omega)$ \highlight{CHECK}. We have to do this in subcases (1) and (2)

In subcase (1) we need show that
$s(p_{a_n,a_i}) \in Sect(\Ibar(r_\Omega))$. This we can do because in any contextual category $s(p_{a_n,a_i}) \in Sect(\crossx{a_n}{a_i}{a_{i-1}})$
and from the defintion of $\Ibar$ case (ii) subcase (2) we have that $\Ibar(r_\Omega)=\crossx{a_n}{a_i}{a_{i-1}}$. 


In subcase (2) we need show that
$\Ibar(r_{t_n})^*...\Ibar(r_{t_1})^*(\crossx{a}{I(f)}{1}) \in Sect(\Ibar(r_{t_n})^*...\Ibar(r_{t_1})^*(\crossx{a}{I(A)}{1}))$.
The follows by by lemma \ref{cacscadelemma} since as pointed out above $\Ibar(r_{t_1}),...\Ibar(r_{t_n})$
is a cascade from $a$ to $b_n$ in \catc. 





\iffalse
[(iv)] if, in addition, $r_s$ is the rule \srule and is  derived rule of $U$ that is mapped by $I$
to a section $g$ of \catcw
then the rule \srulesubstituted[,] which is a derived rule of $U$ by virtue of the substitution lemma, is mapped by $I$ 
to the section $\fmstar...\fonestar (\crossx{a}{g}{1})$ of \catcw
\fi
\mbox{}\hfill \highlight{END OF INTERMEDIATE LEMMA}
\end{proof}
\end{oldtt}