%contextualnotation

\note 
By  the generic term \term{tree} is meant a partially ordered set (poset) $(T, <)$ such that for each $t \in T$, the set $\set{s \in T : s < t}$ is well-ordered by the relation $<$.
In this discussion we restrict ourselves to rooted $\omega$-trees i.e. trees for which the set $\set{s \in T : s < t}$
is finite for all $t \in T$ and for which there is a least element in the partial ordering. 
In the original definition
of contextual categories (\cite{Cartmell78,Cartmell86},) there is defined to be such a tree-structure on the objects of the category. In a contextual category the root of the tree of objects is also  terminal object $1$
in the category and if object $y$ covers object $x$ in the partial ordering\footnote{A element $y$ is said \textit{to cover} 
an element $x$ in a partial ordering $<$ iff $x<y$ and there does not exist $w$ such that $x < w$ and $w < y$.
A more usual notation would be to write $x \lessdot y$ to assert that $y$ covers $x$ in partial ordering $<$. }
then we write $x \base y$ (we use this in preference to the more usual $x \lessdot y$). 

We define the rank (sometimes called the grade) of an element $t \in T$ to be the cardinality
of the set $\setsuchthat{s \in T}{s < t}$. If we define the set $T_i$ to be the set of elements of a tree
of rank $i$ then we have that $T= \bigcup_{i \in N}T_i$. 
\note
By a tree-structured category we mean (i) a category with a tree-structure defined on its objects such that the tree of objects has a unique root object and (ii) for every $x \base y$ in the tree of objects  a cannonical morphism $p_y:y \rightarrow x$. This morphism will be distinguished in diagrams by an arrow with  a triangular head so:

\begin{center}
$
\begin{array}{p{2cm}p{0.5cm}p{0.5cm}p{0.5cm}}
\Rnode{y}{y}& \\ [1.4cm]
\Rnode{x}{x} \\
\end{array}
$
\ncbsar{p_y}{y}{x}
\end{center}
\note
The original definition of contextual category given  in [1] and [2], a contextual category is defined to be a tree-structured category 
\cat{C} with the following additional structure:

\noindent 
(i) whenever
$
\begin{array}{cp{.9cm}c}
            & & \Rnode{z}{z} \\ [1.2cm]
\Rnode{x}{x}& & \Rnode{y}{y} \\ [0.5cm]
\end{array}
$
\jcbarr{f}{x}{y}
\ncasar{p_z}{z}{y}

in \cat{C}, an object $f \sub z$ such that $x \base f \sub z$, a morphism $q(f,z): f \sub z \rightarrow z$ such that

\begin{axiom}{q1}
q(f,z) \circ p_z = p_{f \sub z} \circ f
\end{axiom}

i.e. such that the diagram:

\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{fstarz}{f^*z} & & \Rnode{z}{z}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{y}{y}
\end{array}
\end{displaymath}
\ncbsar{p_{f \sub z}}{fstarz}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\ncasar{p_z}{z}{y}
\end{center}
commutes, 

\noindent
and, (ii), so that each such diagram is a pullback diagram, that is: for all objects $w$ of \cat{C}, and for all
morphisms $h_1: w \rightarrow x$ and $h_2: w \rightarrow z$ (see diagram \ref{pullback} below) such that
$h_1 \circ f = h_2 \circ p_z$ 
there exists a unique $h:w \rightarrow f \sub z$ in \cat{C} such that
$h \circ p_{f \sub z} = h_1$ and $h \circ q(f,z) = h_2$, as shown here:

\vspace{3mm}
\begin{center}
\begin{equation*}
\label{pullback}
\begin{array}{cp{0.5cm}cp{1.2cm}c}
\Rnode{w}{w} &&                     &&           \\ [0.7cm]
             &&\Rnode{fstarz}{f^*z} && \Rnode{z}{z}\\ [1.2cm]
             &&\Rnode{x}{x}         && \Rnode{y}{y}
\end{array}
\end{equation*}
\ncbsar{p_{f \sub z}}{fstarz}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\ncasar{p_z}{z}{y}
\setlength{\arrnodesepA}{3pt}
\jcbarr[-35]{h_1}{w}{x}
\ncaarr[35]{h_2}{w}{z}
\psset{linestyle=dashed}
\ncaarr{h}{w}{fstarz}
\end{center}

\vspace {0.25cm}
\noindent and so that (iii) whenever $x \base y$ in \cat{C}, 
\begin{axiom}{q2}
id_x^*y=y
\end{axiom}

and

\begin{axiom}{q3}
q(id_x,y) = id_y
\end{axiom}



\noindent and (iv) whenever 
$
\begin{array}{c p{.9cm} c p{.9cm} c}
             &   &             &   & \Rnode{z}{z} \\ [1.2cm]
\Rnode{w}{w} &   &\Rnode{x}{x} &   & \Rnode{y}{y} \\ [0.5cm]
\end{array}
$
\jcbarr{f}{w}{x}
\jcbarr{g}{x}{y}
\ncasar{c}{z}{y}
in \cat{C}, 

then

\begin{axiom}{q4}
(f \circ g)^*z =  f^* (g ^* z)
\end{axiom}

and 
\begin{axiom}{q5}
q(f \circ g,z) = q(f,g^*z) \circ q(g,z)
\end{axiom}

\note 
After reading Peter Dyjber's axioms for catgories with families I have been wondering whether in regard
to clause (ii) in the definition above I might not use the notation $\tuple{h_1,h_2}_{x,y,f,z}$  for the unique morphism   
$h:w \rightarrow f \sub z$ in \cat{C} such that
$h \circ p_{f \sub z} = h_1$ and $h \circ q(f,z) = h_2$.\\

$\tuple{h_1,h_2}_{x,y,f,z}$ may be be safely ellided to $\tuple{h_1,h_2}_{f,z}$ and, rather less safely, to $\tuple{h_1,h_2}$.
In fully ellided form we then  have\footnote{Strikingly similar in appearance to Dyjber's axioms but, I think, not like for like i.e. not intertranslatable.} 
\begin{equation}
\tuple{h_1,h_2} \circ p_x = h_1 
\end{equation}
and
\begin{equation}
\tuple{h_1,h_2} \circ q(f,z) = h_2
\end{equation}

\note
Following Voevodsky we may replace the pullback condition of the original definition by an 
`s' operator along with axioms as follows:

\noindent (ii') for all morphisms $f: x \rightarrow y$, a morphism $s(f) : x \rightarrow f \sub p_y \sub y$ such that both:

\begin{axiom}{s1}
s(f) \circ p_{f\sub p_y \sub y}=id_x
\end{axiom}

\noindent and

\begin{axiom}{s2}
s(f) \circ q( f \circ p_y     ,y)=f
\end{axiom}	

\noindent i.e. such that the following diagrams commute:
\begin{center}
\begin{displaymath}
\begin{array}{cccp{1.cm} cp{.9cm}c}
&\Rnode{fXyyM}{f\sub p_y \sub y}&  & &  \Rnode{fXyy}{f\sub p_y \sub y} & & \Rnode{yXy}{p_y \sub y}\\ [1.2cm]
\Rnode{xL}{x} & &\Rnode{xR}{x} & &\Rnode{x}{x}         & & \Rnode{y}{y}
\end{array}
\end{displaymath}
\ncasar{p_{f\sub p_y \sub y}}{fXyy}{x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,p_y \sub y)}{fXyy}{yXy}
\ncasar{p_{p_y \sub y}}{yXy}{y}
\ncaarr{s(f)}{xL}{fXyyM}
\ncasar{p_{f\sub p_y \sub y}}{fXyyM}{xR}
\jcbarr{id_x}{xL}{xR}
\end{center}

\noindent
and such that whenever

\begin{center}
\begin{displaymath}
\begin{array}{c p{.9cm} c p{.9cm} c}
\Rnode{w}{w}&& \Rnode{g*z}{g \sub z} && \Rnode{z}{z} \\ [1.2cm]
            && \Rnode{x}{x}  && \Rnode{y}{y} \\ [0.2cm]
\end{array}
\end{displaymath}
\jcbarr{f}{w}{g*z}
\jcbarr{g}{x}{y}
\ncaarr{q(g,z)}{g*z}{z}
\ncasar{}{g*z}{x}
\ncasar{}{z}{y}
\end{center}

\noindent in \cat{C} then

\begin{axiom}{s3}
s(f \circ q(g,z))=s(f)
\end{axiom}


\note  If $x < y$ in the contextual category C, then define the morphism 
$p_{y,x}:y \morph  x$ in $C$, also written just as $y \dmorph x$, 
by $p_{y,x}=p_y\circ p_{w_n} \circ ... \circ p_{w_1}$, 
where
$w_1, ... w_n$ is the unique sequence of objects of $C$ such that 
$x \base w_1 \base ... \base w_n \base y$. If $x = y$, then define $p(y, x) = id_x$.\\

On diagrams we depict $\smorph$  and $\dmorph$ morphisms running from north to south down the page.
Shown in this way, the morphism
$
\begin{array} {c}
\Rnode{lhsy}{y} \\[2.0cm]
\Rnode{lhsx}{x}  \\ 
\end{array}
$
 \mbox{\ \ \ \ is defined as the composition\ \ \ \ } 
$
\begin{array}{c}
%\Rnode{b}{B}&&\Rnode{xn}{w_n}&&\Rnode{xn1}{w_{n-1}}&&\Rnode{dots}{\ ...\ }&&\Rnode{x1}{w_1}&&\Rnode{a}{A} 
\Rnode{b}{y}\\[0.7cm]
\Rnode{xn}{w_n}\\[0.7cm]
\Rnode{xn1}{w_{n-1}}\\[0.1cm]
\Rnode{dots}{\vdots}\\[0.1cm]
\Rnode{x1}{w_1}\\[0.7cm]
\Rnode{a}{x} 
\end{array}
$.
\nccdar{lhsy}{lhsx}
\ncsar{b}{xn}
\alabel{p_y}
\ncsar{xn}{xn1}
\alabel{p_{w_n}}
\ncsar{xn1}{e1}
\ncline[linestyle=dotted,dotsep=4pt]{e1}{e2}
\ncsar{e2}{x1}
\ncsar{x1}{a}
\alabel{p_{w_1}}
.

\note
The contextual category structure supplies us with pullbacks for any $\smorph$ morphism, 
these given pullbacks can be pieced together to obtain a pullback for
any $\dmorph$ morphism  along any morphism with the same codomain. 

In general, whenever $y \leq z$ in $C$ and whenever $f:x \morph y$ in $C$, then we have
the following canonical pullback for the morphism $p_{z, y}$ along $f$, where
$w_1, ... w_n$ is the unique sequence of objects of $C$ such that 
$y \base w_1 \base ... \base w_n \base z$:

\vspace{3mm}
\begin{center}
\begin{equation}
\label{compositepullbackdefinition}
\begin{array}{cp{2.9cm}c}
\Rnode{TOPL}{q(...q(f, w_1)...w_n)^* z} & & \Rnode{TOPR}{z}\\ [1.2cm]
\Rnode{zOTTOML}{x}         & & \Rnode{zOTTOMR}{y}
\end{array}
\end{equation}
\jcbarr{f}{zOTTOML}{zOTTOMR}
\ncaarr{q(q(...q(f,w_1)...w_n),z)}{TOPL}{TOPR}
\nccdar{TOPL}{zOTTOML}
\blabel{p_{q(...q(f, w_1)...w_n)^* z,x}}
\nccdar{TOPR}{zOTTOMR}
\alabel{p_{z,y}}
\end{center}

Since these constructed pullbacks form an important part of contextual
category structure we would like a simpler notation for them. As no confusion is
likely, we extend the $^*$ and $q$ notation to cover these new pullback diagrams.
From now on if $f:x \morph y$ in $C$ and $y \leq z$ in $C$, then the diagram

\vspace{3mm}
\begin{center}
\begin{equation}
\label{compositepullbackout}
\begin{array}{cp{.9cm}c}
\Rnode{fstarz}{f^*z} & & \Rnode{z}{z}\\ [1.2cm]
\Rnode{x}{x}         & & \Rnode{y}{y}
\end{array}
\end{equation}
\nccdar{fstarz}{x}
\blabel{p_{f \sub z},x}
\jcbarr{f}{x}{y}
\ncaarr{q(f,z)}{fstarz}{z}
\nccdar{z}{y}
\alabel{p_{z,y}}
\end{center}
is the canonical pullback diagram as defined in (\ref{compositepullbackdefinition}) above. 
\note
The following observation
follows from the way the extended pullback diagrams are constructed. 
In the extended notation, if $f: x \morph y$ 
and $y \leq z \leq zz$ in the contextual category C, then
\begin{equation}
f^*zz = q(f, z)^*zz
\end{equation}
 and 
\begin{equation}
q(f, zz) = q(q(f, z), zz)
\end{equation}
and so the outer diagram in
\renewcommand{\pc}[2]{p_{#1,#2}}  % as \pc defined in ccategories macros differently to this
$
\begin{array}{ccp{.9cm}c}
\\[0.25cm]
&\Rnode{TL}{q(f,z)^*zz} & & \Rnode{TR}{zz}\\ [1.2cm]
&\Rnode{ML}{f^*z} & & \Rnode{MR}{z}\\ [1.2cm]
&\Rnode{BL}{x}         & & \Rnode{BR}{y} \\[1.0cm]
\end{array}
$
%composition
\makebox[0.2cm]{   % This make box prevents white space pushing out to the right
                   % cannot see where this white space is comin from. To investigate
									 % change the \makebox[0.2cm] to \fbox and you will see the problem.
\nccdar{TL}{ML}\blabel{P_{q(f,z)^*zz,f^*z}}\nccdar{ML}{BL}\blabel{p_{f \sub z,x}}\nccdar{TR}{MR}\alabel{p_z}
\nccdar{MR}{BR}
}
\alabel{p_z}
%reference
\ncarr{TL}{TR}
\alabel{q(q(f,z),zz)}
\ncarr{ML}{MR}
\alabel{q(f,z)}
\ncarr{BL}{BR}
\blabel{f}
is diagram (\ref{compositepullbackout}). 
On such diagrams as shown here the $p$ labels on $\dmorph$ morphisms (inclusive of their indices) are entirely predictable  and so in diagrams that follows we may omit them.


\note
If we write $\crossx{y}{z}{x}$ in place of ${p_{y,x}}^*z$, for $x < y$, $x < z$  in \ccat then
$\crossx{y}{z}{x}$  represents  in the syntax the `weakening' of a rule of the form
\begin{displaymath}
x, w1,...w_n \tstyle \isT{z}
\end{displaymath}
from a rule with context $x, w_1,...w_n$ to a rule with broader context $y, w_1, ... w_n$: 
\begin{displaymath} 
y, w_1,...w_n \tstyle \isT{z}.
\end{displaymath}

Within the contextual category I think of $\crossx{y}{z}{x}$  as a local cartesian product but of course categorically it is a filtered product i.e. a pullback. If $w < x$ and $w < y$  then 
$
\begin{array}{ccccc}
\Rnode{xy}{\crossx{x}{y}{w}} &&               &&               \\[1.3cm]
\Rnode{x}{x}                 &&               && \Rnode{y}{y}  \\[1.3cm]
                             && \Rnode{w}{w}  &&                                                   
\end{array}
$
\makebox[0.2cm]{% technique to avoid throwinh=g white space
\nccdar{xy}{x}
\blabel{p_{\crossx{x}{y}{w},x}}
\nccdar{x}{w}
\blabel{p_{x,w}}
\nccdar{y}{w}
\alabel{p_{y,w}} 
\ncaarr{q(p_{x,w},y)}{xy}{y}
}
is a pullback diagram in \ccat.

\note
We can extend the $\crossx{}{}{w}$ notation to morphisms. If $f:x \morph x'$ and $g: y \morph y'$ in a contextual
category $\ccat[C]$ and if $w$ is an object such that $w < x$, $w <x'$, $w < y$ and $w < y'$ then 
define $\crossx{f}{g}{w}:\crossx{x}{y}{w} \morph \crossx{x}{y}{w}$ in $\ccat[C]$ by
\begin{equation}
\crossx{f}{g}{w} = \tuple{p_{\crossx{x}{y}{w}, x} \circ f,q(p_{x,w},y) \circ g}
\end{equation}  

\note
In the case special case that $w$ is the terminal object $1$ then the pullback  specialises to give a product diagram:

\begin{displaymath}
\begin{array}{ccccc}
\Rnode{xy}{\crossx{x}{y}{1}} &&               &&               \\[1.3cm]
\Rnode{x}{x}                 &&               && \Rnode{y}{y}  \\                                    
\end{array}
\mbox{\ncsar{xy}{x}
\blabel{p_{\crossx{x}{y}{1},x}}
\ncaarr{q(p_{x,1},y)}{xy}{y}}
\end{displaymath}

In this special case the $\tuple{}$ operation defined earlier is the pairing operation for if
$f: w \morph x$ and $g: \morph y$ then $\tuple{f,g}: w \morph \crossx{x}{y}{1}$ 
and 
\begin{equation}
\tuple{f,g} \circ p_{\crossx{x}{y}{1},x} = f
\end{equation}
and
\begin{equation}
\tuple{f,g} \circ q(p_{x,1},y) = g
\end{equation}

\note 
Note that the product operation $\crossx{}{}{1}$ is far from symmetric 
because if, for example, $1 \base x$ and $1 \base y$ then $x \base \crossx{x}{y}{1}$ and $y \base \crossx{y}{x}{1}$ but we can define 
a swap operation $sw_{x,y} : \crossx{x}{y}{1} \morph \crossx{y}{x}{1}$ by
\begin{equation}
sw_{x,y} = \tuple{q_{p_x,y}, p_{\crossx{x}{y}{1},x}}
\end{equation}

\note
Associativity of $\crossx{}{}w$  follows from the coherence property of the pullbacks in the contextual category. 
For example if $w < x$, $w < y$, $w < z$ in a \ccat then from coherence of pullbacks in \ccat we have:
$\crossx{x}{(\crossx{y}{z}{w})}{w} = \crossx{(\crossx{x}{y}{w})}{z}{w}$ as shown here in this diagram:
 
\begin{displaymath}
\begin{array}{cp{1.0cm}cp{1.0cm}c}
\Rnode{J1}{}\Rnode{D1} {\crossx{(\crossx{x}{y}{w})}{z}{w}}\Rnode{J2}{} \ \ \ \ \   &&  &&  \\ 
= && && \\
\Rnode{D2} {\crossx{x}{(\crossx{y}{z}{w})}{w}}    &&  &&                        \\ [1.3cm]
\Rnode{xy}{\crossx{x}{y}{w}}&& \Rnode{yz}{\crossx{y}{z}{w}} &&                      \\[1.3cm]
\Rnode{x}{x}&& \Rnode{y}{y} && \ \ \ \ \ \ \ \ \ \ \ \ \ \Rnode{z}{z}                                        \\[1.3cm]
             && \Rnode{w}{w} &&                                                     
\end{array}
\end{displaymath}

\ncaarr[50]{q(\pc{\crossx{x}{y}{w}}{w},z)}{J2}{z}
%\ncsar[-30]{J1}{xy}
\ncsar{D2}{xy}
\ncsar{xy}{x}
\ncsar{yz}{y}
\ncsar{x}{w}
\ncsar{y}{w} 
\ncsar{z}{w}
\ncaarr{q(\pc{x}{w},y)}{xy}{y}
\ncaarr{q(\pc{y}{w},z)}{yz}{z}
\ncaarr{q(\pc{x}{w},\crossx{y}{z}{w})}{D2}{yz}



%\end{center}





