
\documentclass[10pt,a4paper]{scrartcl}
%\usepackage[margin=3cm]{geometry} %see below where I make room for margin notes

\usepackage{url}
\usepackage{hyperref}
\usepackage{environ}
\NewEnviron{shrunkdisplay}{%
\begin{equation*}
\scalebox{0.9}{$\BODY$}
\end{equation*}
}

\input{../SharedMacros/theorems.macros}
\input{../SharedMacros/ccategories.macros}
\input{../SharedMacros/gats.macros}
\input{../SharedMacros/metagat.macros}
\input{../SharedMacros/ermacros}
\input{../SharedMacros/erdiagram}
\input{../SharedMacros/indexedsets.macros}
\usepackage{ulem} % for \sout for use by \oldt macro
\input{../SharedMacros/general.macros}

\renewcommand{\erpictureFolder}[0]{../SharedPictures}
% support margin notes
\usepackage[left=1.5cm, right=4cm, marginparwidth=3cm, top=2cm, bottom=2.0cm]{geometry}
\setcounter{equation}{0}
\bibliographystyle{plain} % was hplain

\title{ Theories Part}
\author{John Cartmell\footnote{john.w.cartmell gmail.com}\\ \normalsize{\textit{Ad Otium}}}
\subtitle{Status: \normalsize{WORK IN PROGRESS}}
\begin{document}
\maketitle

\section{Definitions}

\newcommand{\sEquiv}{\equiv}
\newcommand{\wEquivOne}[2]{#1\ we_1\ #2}
\newcommand{\wEquivTwo}[2]{#1\ we_2\ #2}
\newcommand{\GAT}{generalised algebraic theory\ }


\subsection{Substituting terms for variables in expressions}

If $X$ is an expression, if  $\xn$ are variables and $\tn$ are terms then 
the expression that results from replacing each instance of each $x_i$ by $t_i$, \foreachi,
 is  written as
\begin{equation*}
X[t_1|x_1,...t_n|x_n]
\end{equation*}
which sometimes we write as
\begin{equation*}
X[t_i|x_i]_{\idef}.
\end{equation*}


\begin{observation}
\llabel{permutingsubstitution}
If $X$ is an expression, if  $\xn$ are variables and $\tn$ are terms,
if $\sigma: \set{1,...n} \morph \set{1,...n}$ is a permutation 
then 
\begin{equation}
X[t_{\sigma^{-1}(1)}|x_1,...t_{\sigma^{-1}(n)} | x_n] = X[t_1|x_{\sigma(1)},...t_n| x_{\sigma(n)}]
\end{equation}
which can also be written as
\begin{equation}
X[t_{\sigma^{-1}(i)}|x_i]_{\idef} = X[t_i|x_{\sigma(i)}]_{\idef}.
\end{equation}
Likewise we have
\begin{equation}
X[t_{\sigma(1)}|x_1,...t_{\sigma(n)} | x_n] = X[t_1|x_{\sigma^{-1}(1)},...t_n| x_{\sigma^{-1}(n)}]
\end{equation}
which can also write as
\begin{equation}
X[t_{\sigma(i)}|x_i]_{\idef} = X[t_i|x_{\sigma^{-1}(i)}]_{\idef}.
\end{equation}

\end{observation}


\subsection{Strongly Equivalent Contexts}
\begin{definition}
If  $\Delta= \tuple{\con{x}{\Delta}{n}}$ 
and $\Omega = \tuple{\con{y}{\Omega}{m}}$ are contexts of a \GAT $\gat$ then they are said to be \textit{strongly equivalent}, written $\Delta \sEquiv \Omega$,  iff $n=m$ and for each $i$, $1 \leq i \leq n$ the rule 
$$
\frac{\con{x}{\Delta}{i-1}}{\Delta_i=\Omega_i[x_1|y_1,...,x_{i-1}|y_{i-1}]}
$$
\intheory.
\end{definition}

This definition is that of equivalence from (\cite{Cartmell78})  and, as described there, the  equivalence classes of contexts for a generalised algebraic theory \gat\  are the objects of the contextual category $\conu$ corresponding to \gat.

\subsection{Permutative Realisations}
\begin{definition}
If $\Delta=\encxDelta{n}$ and $\Omega = \encyOmega{n}$ are contexts of a \GAT $\gat$ then by a permutative realisation of $\Omega$ wrt $\Delta$ we mean any
realisation of $\Omega$ wrt $\Delta$ which is of the form $\tuple{\permterm{x}{n}{\sigma}}$ for some permutation $\sigma$ of the set $\{1,2,..n\}$.
\end{definition}

\begin{observation}
From this definition it follows that if $\Delta=\encxDelta{n}$ and $\Omega = \encyOmega{n}$ are contexts and if $\sigma$ is some permutation of the set $\{1,2,..n\}$
then $\tuple{\permterm{x}{n}{\sigma}}$ is a permutative realisation, $\tuple{\permterm{x}{n}{\sigma}}: \Delta \morph \Omega$ iff \foreachi, 
\begin{equation*}
\frac{\xDelta{n}}{\Delta_{\sigma(i)}=\Omega_i[x_{\sigma(1)}|y_1,...x_{\sigma(i-1)}|y_{i-1}]}
\end{equation*}
\intheory.
\end{observation}

We need a definition of \term{monotonicity} I think. There is a definition in notes from 2018.

\subsection{29 November 2020}
An approach that has been at the back of my mind percolating needs to be written down and, hopefully, fleshed out.

\subsubsection{Weakly Equivalent(3)}
Define two contexts $\Delta$ and $\Delta'$ to be weakly equivalent iff there is a permutation $\sigma$ that determines a permutative realisation   $\Delta \morph \Delta'$ and so that $\sigma{^-1}$ 
determines a permutative realisation $\Delta' \morph \Delta$. 

\begin{note}[Example]
Have an example of a permutative realisation that is lacking an inverse.
\end{note}

\subsubsection{Equivalent Types within a context}
If $\Delta=\tuple{\xDelta{n}}$ is a context and if $i$ and $j$ are indices i.e. if $1 \leq i,j \leq n$ then we will say that $i \sim_T j$ with respect to $\Delta$ 
iff
there is a permutation $\sigma$ with inverse $\sigma'$ such that $\sigma$ and $\sigma'$ both determine realisations $\Delta \morph \Delta$ and such that $\sigma(i)=j$.  
\begin{lemma}
$\sim_T$ is an equivalence relation on the set of indicies of $\Delta$.
\end{lemma}
\begin{proof}
Elementary.
\end{proof}

\subsubsection{Labelling type indices within a context}
If $\Delta=\tuple{\xDelta{n}}$ is a context then a labelling is a family of functions $lb$ indexed by the set of equivalence classes of indices of $\Delta$ under $\sim_\Delta$
such that for each index $i$, $lb:[i] \morph \set{1,...cardinality([i])}$ is injective (and therefore surjective).
\commentary{Need some additional constraints for such a labelling.}

\begin{definition}
If  $\gat$ is a theory and $\Delta$ is a context then the cannonical labelling of $\Delta$ is defined as...  
\end{definition}
\subsubsection{Define Monotonicity}
If $\Delta$ and $\Delta'$ are contexts and $\sigma$ and inverse $\sigma^{-1}$ determine permutative realisations $p_\sigma: \Delta \morph  \Delta'$ and
$p_{\sigma^{-1}}: \Delta' \morph \Delta$ then say that $p_\sigma$ is monotonic iff \foreachi, \foreachj[card([i])], $lb_{[i]}(j)=lb_{[\sigma(i)]}(\sigma(j))$
where $lb_[i]$ is the cannonical labelling function of $[i]$.

\subsubsection{Weakly Equivalent (3) Realisations}
\begin{definition}
If $\Delta=\tuple{\xDelta{n}}$ and $\Delta'=\tuple{\xDeltap{n}}$ are weakly equivalent 
contexts \inagat \gat and $\Omega=\tuple{\yOmega{m}}$ and $\Omega'=\tuple{\yOmegap{m}}$ are weakly equivalent contexts \ingat,
if $r=\tuple{r_1,...r_m}$ is a realisation of $\Omega$ wrt $\Delta$ 
and $r'=\tuple{r'_1,...r'_m}$ is a realisation of $\Omega$ wrt $\Delta$ 
then
define $r$ to be \term{weakly equivalent (3) to} $r'$ 
iff $r \circ p_\pi$ is strongly equivalent to $p_\sigma \circ r'$\commentary{saying  $\circ$ here is shorthand}

i.e. iff
\vspace{3mm}
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{TL}{\Delta} & & \Rnode{TR}{\Omega}\\ [1.2cm]
\Rnode{BL}{\Delta'}         & & \Rnode{BR}{\Omega'}
\end{array}
\end{displaymath}
\ncarr{TL}{TR}
\alabel{[r]}
\ncarr{TL}{BL}
\blabel{[p_\sigma]}
\ncarr{BL}{BR}
\blabel{[r']}
\ncarr{TR}{BR}
\alabel{[p_\pi]}
\end{center} commutes
in the category of contexts and realisations $C(U)$,
where $\sigma$ is the cannonical permutation  that determines a monotonic realisation $p_\sigma: \Delta \morph \Delta'$ \commentary{Sadly the use of $p$ in this way will clash with use of $p$ in contextual category structure.}
and  $\pi$ is the cannonical permutation  that determines a monotonic realisation $p_\pi: \Omega \morph \Omega'$.
\end{definition}

\begin{lemma}
Weakly equivalent realisations compose to weak equivalents.
\end{lemma}
\begin{proof} \\
\begin{center}
\begin{displaymath}
\begin{array}{cp{.9cm}c}
\Rnode{TL}{\Delta} & & \Rnode{TC}{\Omega}\\ [1.2cm]
\Rnode{BL}{\Delta'}         & & \Rnode{BC}{\Omega'}
\end{array}
\end{displaymath}
\ncarr{TL}{TC}
\alabel{[r]}
\ncarr{TL}{BL}
\blabel{[p_\sigma]}
\ncarr{BL}{BC}
\blabel{[r']}
\ncarr{TC}{BC}
\alabel{[p_\pi]}
\end{center}
\end{proof}

\subsection{Subcontexts}
By a \textit{subcontext} of a context $\context{x}{\Delta}{n}$ we mean any context
of the form
$\subcontext{x}{{\Delta}}{i}{k}$ for some sequence 
$1 \leq i_1 \leq i_2 \leq ... i_k \leq n$. \\

\noindent
For example:
\begin {itemize}
\item the empty context is a subcontext of every 
context,
\item any initial subsequence of a context is a subcontext of that context.
\end{itemize}

\noindent
In addition to the above, a context such as $\ofT{x_1}{A_1},\ofT{x_2}{A2},\ofT{y}{B(x_1)}$ has 
$\ofT{x_2}{A2}$ as a subcontext. This illustrates that each non-initial subcontext is indicative of a type in the context ($A_2$ in this case)
which does not depend on one of the earlier variables.

\begin{aside}
20 November 2020.
Can we say that all subcontexts are initial segments of permuted contexts?
\end{aside}


\section{Restricting the class of Generalised Algebraic Theores}

Rationale for restricting to the class of theories in day notes 12 August 2012. \commentary{CHECK this rationale and document here.}
\begin{definition}
A generalised algebraic theory $\gat$ is said to be \term{cancellative}\commentary{Introduced as a \textit{restricted theory} in day notes of Mon 13 Aug 2018}
iff for all derived rules 
$$
\frac{\con{x}{\Delta}{n}}{\Delta=\Delta'} \mbox{ of $\gat$,}
$$
such that variable $x_n$  does not appear in either
$\Delta$ or $\Delta'$,
$$
\frac{\con{x}{\Delta}{n-1}}{\Delta=\Delta'} \mbox{ is a derived rule of $\gat$.}
$$
\end{definition}

\begin{framed}
\begin{enumerate}
\item 11th Aug 2018 -- say a permutation is significant if it doesn't permute types that are equivalent
\item this becomes a definition of monotonicity I think -- but is this to do with showing weak equivalence 
is an equivalence relation or is it to do with defining equivalence of realisations -- need to get to bottom of this.
\end{enumerate}
\end{framed}
\noindent
Note that if there is an admittable  permutation between two contexts then it is the unique such permutation. 

\subsection{Weakly Equivalent Realisations}
If $\tuple{r_1,...r_m}: \tuple{\con{x}{\Delta}{n}} \morph \tuple{\con{y}{\Omega}{m}}$ and
$\tuple{r'_1,...r'_m}: \tuple{\con{x}{\Delta'}{n}} \morph \tuple{\con{y'}{\Omega'}{m}}$ are realisations 
and if $\tuple{\con{x}{\Delta}{n}}$ and 
$\tuple{\con{x}{\Delta'}{n}}$ are weakly equivalent and 
$\tuple{\con{y}{\Omega}{m}}$ and $\tuple{\con{y'}{\Omega'}{m}}$ are weakly equivalent then
define $\tuple{r_1,...r_m}$ and $\tuple{r'_1,...r'_m}$ to be weakly equivalent 
iff 
$\tuple{r_1,...r_m}$
and
$\tuple{r'_{\pi(1)},...r'_{\pi{m}}}[x_1|x'_{\sigma(1)},...,x_n|x'_{\sigma(n)}]$
are strongly equivalent
where
$\sigma$ is unique permutation such that 
and $\pi$ is unique permutation such that \highlight{missing text}.


\section{Sketch}
\begin{enumerate}
\item{
from a contextual category $\cat{C}$ we may construct a dependency category $dep(\cat{C})$ as a quotient category
}
\item{
The functor $q:\cat{C} \morph dep(\cat{C})$ is surjective and faithful.
Therefore it preserves limits.
}
\end{enumerate}

 
\newpage
\appendix
\section{Failed Approaches}

\subsection{Weak Equivalence(1) 13 August 2018 and Weak Equivalence (2) November 2020}

\begin{oldtt}
\subsubsection{Aside: Middling Equivalent Contexts}

A context $\tuple{\con{x}{\Delta}{n}}$ 
is  \textit{middling equivalent}  to a $\tuple{\con{y}{\Omega}{m}}$ iff $n=m$ and for each $i$, $1 \leq i \leq n$ the rule 
$$
\frac{\con{x}{\Delta}{n}}{\Delta_i=\Omega_i[x_1|y_1,...,x_{i-1}|y_{i-1}]}
$$
is a derived rule of \gat. \\

This definition doesn't achieve anything -- it doesn't result in an equivalence relation because it is not symmetric for 
\newt{non-cancellative}\oldt{improper} theories.\commentary{same as strong equivalence for cancellative theories}
\end{oldtt}

\subsubsection{Permutations of Contexts}
If $\Delta = \encxDelta{n}$ is a context and if $\sigma: \set{1,...n} \morph \set{1,...n}$ is a permutation then write $\Delta[\sigma]$ for the
sequence $\encxDeltasigma{n}$. Our  interest is in those cases where $\Delta[\sigma]$ is a valid context.  
\begin{lemma}
\llabel{mappingOmegasigmatoOmega}
If $\Omega = \encyOmega{n}$ is a context and if $\sigma$ is a permutation of the set $\{1,2,..n\}$ such that $\Omega[\sigma]$ is a context then
$\tuple{\yn}$, is a realisation of $\Omega$ wrt $\Omega[\sigma]$.
\end{lemma}
\begin{proof}
We have that \foreachi,
\begin{equation*}
\frac{\yOmegasigma{n}}{\ofT{y_{\sigma(i)}}{\Omega_{\sigma(i)}}}
\end{equation*}

therefore \foreachj, 
\begin{equation*}
\frac
{\yOmegasigma{n}}     
        {\ofT
				    {y_{\sigma(\sigma^{-1}(j))}}
						{\Omega_{\sigma(\sigma^{-1}(j))}}
				}
\end{equation*}

which is to say that \foreachj, 

\begin{equation*}
\frac{\yOmegasigma{n}}{\ofT{y_j}{\Omega_{j}}}
\end{equation*}

as required.
\end{proof}
\subsubsection{Attempts to define Weakly Equivalent Contexts}

\subsubsection{Weak Equivalence (1)}
\commentary{Defined
  August 2018}
\begin{definition}
If $\Delta = \xDelta{n}$ and $\Omega=\yOmega{m}$ are contexts then say that context $\Delta$
is \textit{weakly equivalent in sense (1) } to context $\Omega$, written $\wEquivOne{\Delta}{\Omega}$,  iff $n=m$ and there exists a permutation $\sigma$ of the set $\{1,2,..n\}$
such that the sequence $\Omega[\sigma]$ 
is a context and $\Delta \sEquiv \Omega[\sigma]$.
\end{definition}
\begin{framed}
An example to show that weak equivalence (1) is not an equivalence relation was given in day notes Monday 13th Aug 2018 after a supposed proof from the same day.
In fact proof of symmetry is incorrect because the permuted context is not shown to be a context and the counter example shows that
it may fail to be a context. Transitivity fails also. 
\end{framed}


\subsubsection{Weak Equivalence (2)}
\begin{definition}
If $\Delta=\encxDelta{n}$ and $\Omega = \encyOmega{n}$ are contexts then $\encxDelta{n}$ is weakly equivalent in sense (2) to $\encyOmega{n}$, written $\wEquivTwo{\Delta}{\Omega}$, iff there exists contexts $\Delta' = \encxDeltap{n}$ and $\Omega' = \encyOmegap{n}$ such that
$\Delta \sEquiv \Delta'$ and $\Omega \sEquiv \Omega$ and $\wEquivOne{\Delta'}{\Omega'}$.
\end{definition}


\begin{framed}
11th November 2020 I tried to patch up the definition with weak equivalence (2).
Sadly weak equivalence(2) thought symmetric is not transitive. Here is a counter example:
let a theory have the following type definitions:
\begin{displaymath}
\begin{array}{l}
\tstyle \isT{A} \\
\tstyle \isT{A'} \\
\ofT{x}{A}\tstyle \isT{B(x)} \\
\ofT{x'}{A'}\tstyle \isT{B'(x')}
\end{array}
\end{displaymath}
and the type identity
\begin{displaymath}
\begin{array}{l}
\ofT{x}{A}, \ofT{x'}{A'}\tstyle B(x)=B'(x')
\end{array}
\end{displaymath}
and no other rules.

Let $\Delta$ be the context $\tuple{\ofT{x}{A}, \ofT{y}{B(x)}, \ofT{x'}{A'}}$. \\

Let $\Omega$ be the context $\tuple{\ofT{x}{A}, \ofT{x'}{A'}, \ofT{y}{B(x)}}$. \\

Let $\Gamma$ be the context $\tuple{\ofT{x'}{A'}, \ofT{y}{B'(x)},  \ofT{x}{A}}$. \\

Then, $\wEquivTwo{\Delta}{\Omega}$ because they are both contexts and each is a permuation of the other,

and $\wEquivTwo{\Omega}{\Gamma}$ because $\Omega \sEquiv \Omega'$ and $\Omega'$ and $\Gamma$ are both contexts and are permutations of each other,
where $\Omega'$ is the context $\tuple{\ofT{x}{A}, \ofT{x'}{A'}, \ofT{y}{B'(x)}}$. \\

We do not have $\wEquivTwo{\Omega}{\Gamma}$ for $\Gamma$ has no non-identical equivalents and $\Gamma$ permuted to 
$\tuple{\ofT{x}{A}, \ofT{y}{B'(x)}, \ofT{x'}{A'}}$ to align with $\Delta$ is not a context.
 
Therefore $\wEquivTwo{}{}$ is not transitive.
\end{framed}
\subsection{Other}
\noindent 
If $\tuple{\con{x}{\Delta}{n}}$ 
and $\tuple{\con{y}{\Omega}{m}}$ are weakly equivalent 
and if $\sigma$ is a permutation of the set $\{1,2,..n\}$
such that the sequence 
$\tuple{\permcon{y}{\Omega}{m}{\sigma}}$
is a context and 
is strongly equivalent to $\tuple{\con{x}{\Delta}{n}}$
then define $\sigma$ to be \textit{cannonical}\commentary{Is this one of the definitions of monotonic in the day notes?} iff
for $i_1$,$i_2$,$1 \leq i_1  < i_2 \leq n$, if 
$$
\frac{\con{x}{\Delta}{n}}{\Delta_{i_1}=\Delta_{i_2}}
$$
then $\sigma(i_1) < \sigma(i_2)$.\\

With this weaker definition of equivalence \newt{we would like to}  show that the 
equivalence classes of contexts are the objects of a dependency category
$\depu$ corresponding to a theory \gat. \daynote{ August 2018-- 9th October 2018 struggles to modify this definition to achieve 
this}\\

\subsection{Do we need these?}
\begin{lemma}
\llabel{seRestriction}
if $\encxDelta{n}$ 
and $\encyOmega{n}$ are contexts 
and $\encxDelta{n} \sEquiv \encyOmega{n}$ 
then \foreachi,  $\encxDelta{i} \sEquiv \encyOmega{i}$
\end{lemma}
\begin{proof}
\end{proof}

\begin{lemma}
\llabel{weTwoSymmetric}
The relation $\wEquivTwo{}{}$ is 
symmetric i.e. if $\Delta=\encxDelta{n}$ 
and $\Omega = \encyOmega{n}$ are contexts 
and $\wEquivTwo{\Delta}{\Omega}$ 
then $\wEquivTwo{\Omega}{\Delta}$.
\end{lemma}
\begin{proof}
Assume $\wEquivTwo{\Delta}{\Omega}$. Therefore there are contexts $\Delta'=\encxDeltap{n}$ and $\Omega' = \encyOmegap{n}$  such that $\Delta \sEquiv \Delta'$ and $\Omega \sEquiv \Omega'$ and there is a permutation $\sigma$ such that $\Omega'[\sigma]$  is a context and 
\begin{equation}
\Delta \sEquiv \Omega'[\sigma]
\end{equation}

First note that $\wEquivOne{\Omega'}{\Omega'[\sigma]}$ for $\sigma$ being a  permutation has an inverse permutation $\sigma^{-1}$ and  $\Omega'[\sigma][\sigma^{-1}]=\Omega'$.

Now we have $\Omega \sEquiv \Omega'$ and $\wEquivOne{\Omega'}{\Omega'[\sigma]}$ and $ \Omega'[\sigma] \sEquiv  \Delta$.

Therefore $\wEquivTwo{\Omega}{\Delta}$ as required.
\end{proof}

\subsubsection{Failed Counter Example from November 2020}
\begin{oldtt}
\begin{note}[Failed Counter Example]
Suppose a theory has the following type definitions:
\begin{displaymath}
\begin{array}{l}
\tstyle \isT{A} \\
\tstyle \isT{A'} \\
\ofT{x}{A}\tstyle \isT{B(x)} \\
\end{array}
\end{displaymath}
and the type identity
\begin{displaymath}
\begin{array}{l}
\ofT{x}{A}\tstyle B(x)=A'
\end{array}
\end{displaymath}

Let $\Delta$ be the context $\tuple{\ofT{x_1}{A}, \ofT{x_2}{A}, \ofT{x_3}{B(x_2)}  }$. \\

Let $\Omega$ be the context $\tuple{\ofT{y_1}{A}, \ofT{y_2}{A}, \ofT{y_3}{B(y_1)} }$. \\

Let $\Gamma$ be the context $\tuple{\ofT{z_1}{A}, \ofT{z_2}{A}, \ofT{z_3}{A'} }$. \\

Then $\tuple{x_2,x_1,x_3}$ is a \highlight{oh no it isnt} monotonic permutative realisation of $\Omega$ wrt $\Delta$ and 
$\tuple{y_1,y_2,y_3}$ is a monotonic permutative realisation of $\Gamma$ wrt $\Omega$ but
the composition  $\tuple{x_2,x_1,x_3}\circ \tuple{y_1,y_2,y_3} = \tuple{x_2,x_1,x_3}$
is not monotonic because also $\tuple{x_1,x_2,x_3}$ is a permutative realisation
of $\Gamma$ wrt $\Delta$. 
\end{note}
\end{oldtt}


\bibliography{../SharedBibliography/temp/bibliography}

\end{document}
