
Abstract. In this two-part paper, we undertake a systematic study of abstract partial
map categories in which every map has both a restriction (domain of definition) and a
range (image). In this first part, we explore connections with related structures such
as inverse categories and allegories, and establish two representational results. The
first of these explains how every range category can be fully and faithfully embedded
into a category of partial maps equipped with a suitable factorization system. The
second is a generalization of a result from semigroup theory by Boris Schein, and says
that every small range category satisfying the additional condition that every map is
an epimorphism onto its range can be faithfully embedded into the category of sets and
partial functions with the usual notion of range. Finally, we give an explicit construction
of the free range category on a partial map category in terms of certain types of labeled
trees.

\section{By the way}
I cannot help thinking that Cockett et al's proof of Schein's Theorem must break down into three
distinct parts
\begin{itemize}
       \item show that theory of categories with partial sections is a conservative extension of the theory of RR.5 range categories (prove syntactically)
       \item there is a free category with partial sections generated by a range category. 
              More formally:  
              the inclusion of the category of range categories with partial sections  
              into the  category of RR.5 range categories (i.e. the forgetful functor) has a left adjoint.
       \item For every range category with partial sections there is a faithful range functor into the
             category of sets and partial functions. Proof. coproduct over all objects $a$ of Hom functor $(Hom(a,-)$.  
\end{itemize}

Update: 16 December 2025. I guess that there is a category of sticklebacks over a range category C and that this would be a range category. Sadly if it is a category (which I am not sure I have actually checked)
then it certainly isn't a range category. For $f$ a morphism 
$f: A \morph B$
the \catcw the stickle $B \xleftarrow{f} A$ (the partial section of $f$)
doesn't have a range stickeback. I had hoped to show that the stickle 
 $ B \xleftarrow{f} A \xrightarrow{f} B$ was the range but this is clearly nonsense (though I managed to believe it for a day or two).

 I guess that there might be enough structure so that \catcw is embedded in a restriction catgory in which all morphisms in the image have a range and have a partial section(
  the expectation of course is that the stickleback $B \xleftarrow{f} A$ 
 has the stickleback $A \xrightarrow{f} B$ as a section. That is surely the point of the stickleback). Since what I really interested in the is the composition of this functor with the Hom functor then this might be enough for structure for the construction I need. 

I expect that I can define
\begin{itemize}
    \item $\widehat{A \xrightarrow{f} B}=_def B \xrightarrow{\widehat{f}} B$
\end{itemize}

I need to show $ B \xleftarrow{f} A \xrightarrow{f} B=\xrightarrow{\widehat{f}} B$
ooops. very confused.

\subsection{Category of zigzags on a category \catcw}



%macros
\newcommand{\Ob}[2]{
\Rnode{#1#2}{#1_{#2}}
}
% b bare object no subsript
\newcommand{\bOb}[1]{
\Rnode{#1}{#1}
}
% p for predecessor
\newcommand{\Obp}[2]{
\Rnode{#1#2p}{#1}_{#2-1}
}

% s for successor
\newcommand{\Obs}[2]{
\Rnode{#1#2s}{#1_{#2+1}}
}

\newcommand{\Obpp}[2]{
\Rnode{#1#2pp}{#1_{#2-2}}
}

\newcommand{\Obss}[2]{
\Rnode{#1#2ss}{#1_{#2+2}}
}

%\zigzagZeroOne{x}{y}{f}[ff] 
% This is a zig zag zig zag. 
% zig zero is f0 \circ ff: y0 -> x0             
% zag zero is f'0: y0 -> x1
% zig one is  f1 : y1 -> x1 
% zig one is  f'1 : y1 -> x1
\NewDocumentCommand{\zigzagZeroOne}{m m m o}{
\begin{array} {c c c c c c c c}
 &\Ob{#2}{0}&&\Ob{#2}{1}          &\\[0.8cm]
\Ob{#1}{0}&&\Ob{#1}{1}&&\Ob{#1}{2} 
\end{array}
\begin{arrows}
\ncarr{#20}{#10} \blabel{#3_0 
\IfNoValueTF{#4}
    {}
    {\circ #4}
}[0.45][0.4]
\ncarr{#21}{#11} \blabel{#3_1}[0.45][0.4]
\ncarr{#20}{#11} \alabel{#3'_0}[0.45][0.4]
\ncarr{#21}{#12} \alabel{#3'_1}[0.45][0.4]
\end{arrows}
}

\NewDocumentCommand{\zigzagZeroOneShort}{m m m o}{
\begin{array} {c c c c c c c }
 &\Ob{#2}{0}&&\Ob{#2}{1}          \\[0.8cm]
\Ob{#1}{0}&&\Ob{#1}{1}&
\end{array}
\begin{arrows}
\ncarr{#20}{#10} \blabel{#3_0 
\IfNoValueTF{#4}
    {}
    {\circ #4}
}[0.45][0.4]
\ncarr{#21}{#11} \blabel{#3_1}[0.45][0.4]
\ncarr{#20}{#11} \alabel{#3'_0}[0.45][0.4]
%\ncarr{#21}{#12} \alabel{#3'_1}[0.45][0.4]
\end{arrows}
}

%\zigzagStart{x}{y}{f}[n]
% starts from n instead od zero 
\NewDocumentCommand{\zigzagStart}{m m m m}{
\begin{array} {c c c c c c c }
 &\Ob{#2}{0}&&\Ob{#2}{1}    \\[0.8cm]
\Ob{#1}{0}&&\Ob{#1}{1}& 
\end{array}
\begin{arrows}
\ncarr{#20}{#10} \blabel{#3_{#4} }[0.45][0.4]
\ncarr{#20}{#11} \alabel{#3'_{#4} }[0.45][0.4]
\ncarr{#21}{#11} \alabel{#3_{#4+1} }[0.3][0.4]
%\ncarr{#21}{#12} \alabel{#3'_{#4+1} }[0.45][0.4]
\end{arrows}
}



%\zigzagDotsThenFinal{x}{y}{f}{n}
% This is a zig
% fn  : yn -> xn
\NewDocumentCommand{\zigzagDotsThenFinal}{m m m m}{
\begin{array}{c c c}
\dots &&\Ob{#2}{#4} \\[0.8cm]
\dots &\Ob{#1}{#4}
\end{array}
\begin{arrows}
\ncarr{#2#4}{#1#4} \blabel{#3_{#4}}[0.45][0.4]
\end{arrows}    
}

%\zigzagDotsThenFinalFlex{x}{y}{f}{n}{m}
% This is zig
% fm : yn -> xn
\NewDocumentCommand{\zigzagDotsThenFinalFlex}{m m m m m}{
\begin{array}{c c c}
\dots &&\Ob{#2}{#4} \\[0.8cm]
\dots &\Ob{#1}{#4}
\end{array}
\begin{arrows}
\ncarr{#2#4}{#1#4} \blabel{#3_{#5}}[0.45][0.4]
\end{arrows}    
}



%\zigzag{x}{y}{f}[ff]{n}
% This is a zig zag zig zag... zig
% For params 1 to 4, see command \zigzagZeroOne
% For param 5 see command \zigzagDotsThenFinal
%\zigzag{x}{y}{f}{n}
\NewDocumentCommand{\zigzag}{m m m o m}{
\zigzagZeroOne{#1}{#2}{#3}[#4]
\zigzagDotsThenFinal{#1}{#2}{#3}{#5}
}

%\zigzagFlex{x}{y}{f}{n}{n+m}
\NewDocumentCommand{\zigzagFlex}{m m m m m}{
\zigzagStart{#1}{#2}{#3}{#4}
\zigzagDotsThenFinalFlex{#1}{#2}{#3}{#4}{#5}
}

A zigzag  is a pair of sequences
$f$, and $f'$ of morphisms of \catcw such that for some $n \ge $, for some objects $x_0,..x_n$ and $y_1,...y_n$ of \catcw we have
$$
\arraycolsep=7pt
\zigzag{x}{y}{f}{n}
$$
in \catcw. 

Within a zigzag of length $n$ we find a zig for each $i$, $0 \le i \le n-1$, like so
$$
\begin{array} {c c c}
&\Ob{y}{i}&\\[0.8cm]
\Ob{x}{i}&&\Obs{x}{i}
\end{array}
\begin{arrows}
\ncarr{yi}{xi}  \blabel{f_i}[0.45][0.4]
\ncarr {yi}{xis}  \alabel{f'_i}[0.45][0.4]
\end{arrows}
$$

We will say that this i'th zig is \textit{tight} iff
$\overline{f_i}=\overline{f'_i}$.

We also find a  zag \foreachi, like so
%\arreset}
$$
\setlength{\arrnodesepA}{3pt}
\begin{array} {c c c}
\Obp{y}{i}&&\Ob{y}{i} \\[0.8cm]
&\Ob{x}{i}&
\end{array}
\begin{arrows}
\ncarr{yip}{xi}  \blabel{f'_i}[0.45][0.4]
\ncarr {yi}{xi}  \alabel{f_i}[0.45][0.4]
\end{arrows}
$$

and we will say that the i'th zag is tight iff
$\widehat{f'_i}=\widehat{f_i}$.

A zigzag we will say is a \textit{stickleback} iff its every zig and its every zag are tight. 

A stickleback $f: A \morph B$ is a pair of sequences
$f$, and $f'$ of morphisms of \catcw such that for some $n \ge $, for some objects $x_0,..x_n$ and $y_1,...y_n$ of \catcw we have
$$
\arraycolsep=7pt
\zigzag{x}{y}{f}{n}
$$
in \catcw.


\newcommand{\zigzagfgcomposite}
{
\arraycolsep=7pt
\zigzagZeroOne{w}{x}{f}
\begin{array}{c}
\dots \\[0.8cm]
\dots
\end{array}
\begin{array}{c c}
\Ob{x}{n} \\[0.8cm]
& \Ob{w}{n}=
\end{array}
\begin{arrows}
\ncarr{xn}{wn} \blabel{f'_{n-1}}[0.2][0.4] %0.2 was 0.45
\end{arrows}
\kern-15pt
\zigzag{y}{z}{g}[f_n]{m}
}

Composition of zigzags is given by
$$
\arraycolsep=7pt
\left( \zigzag{w}{x}{f}{n}\right) \circ \left(\zigzag{y}{z}{g}{m}\right)
$$
=
$$
\zigzagfgcomposite
$$

providing there is no morphism $k: y_1 \morph y_0$ such that the triangle
$$
$$
commutes. If there is such a morphism then the composition is  
$$
\arraycolsep=7pt
\zigzagZeroOne{w}{x}{f}
\begin{array}{c}
\dots \\[0.8cm]
\dots
\end{array}
\begin{array}{c c}
\Ob{x}{n} \\[0.8cm]
& \Ob{w}{n}
\end{array}
\begin{arrows}
\ncarr{xn}{wn} \blabel{f'_{n-1}}[0.2][0.4]
\end{arrows}
\begin{array}{c c}
\Ob{z}{1}& \\[0.8cm]
& \Ob{y}{2}
\end{array}
\begin{arrows}
\ncarr{z1}{wn}\blabel{g_1 \circ k}[0.45][0.4]
\ncarr{z1}{y2}\alabel{g'_1}[0.45][0.4]
\end{arrows}
\zigzagDotsThenFinal{y}{z}{g}{m}
$$


EXCEPT that the abobe compsitions are not necessarily sticklebacks because
it will not ne4cessarily be the case that $\widehat{g_0)=\widehat{f'n}}$.

Therefore we have to do some modifications to both halves of the compostion.
Modifications to first (f,f') half will be along these lines:

$$
\arraycolsep=7pt
\begin{array}{c c c c c}
\Rnode{xnpp}{x_{n-2}} && \kern0.25cm\Rnode{xnp}{x_{n-1}} && \kern0.5cm\Ob{z}{0}\\[1cm]
  & \kern0.25cm\Rnode{wnp}{w_{n-1}}  && \kern0.5cm\Ob{w}{n}
\end{array}
\begin{arrows}
\ncarr{z0}{wn}\alabel{g_1 f_n}[0.25][0.4]
\ncarr{xnp}{wn}\alabel{f'_{n-1}.\reallywidehat{g_1 f_n}}[0.4][0.4]
\ncarr{xnp}{wnp}\alabel{f_n.\overline{f'_{n-1}.\reallywidehat{g_1 f_n}}}[0.5][0.4]
\ncarr{xnpp}{wnp}\blabel{f'_{n-2}.\reallywidehat{f_n.\overline{f'_{n-1}\reallywidehat{g_1 f_n}}}}[0.45][0.4]
\end{arrows}
$$

\textbf{TIGHTENING a loose stickleback.}

start with

$$
\arraycolsep=7pt
\begin{array}{cccccc}
 &\bOb{v}& &\bOb{x}& &\bOb{z} \\[0.8cm]
\bOb{u}& &\bOb{w}& &\bOb{y}&
\end{array}
\begin{arrows}
\ncarr{v}{u}\blabel{e}[0.25][0.4]
\ncarr{v}{w}\alabel{f}[0.25][0.4]
\ncarr{x}{w}\blabel{g}[0.25][0.4]
\ncarr{x}{y}\alabel{h}[0.25][0.4]
\ncarr{z}{y}\blabel{i}[0.25][0.4]
\end{arrows}
$$

This tightens to 

$$
\arraycolsep=7pt
\begin{array}{cccccc}
 &\bOb{v}& &\bOb{x}& &\bOb{z} \\[0.8cm]
\bOb{u}& &\bOb{w}& &\bOb{y}&
\end{array}
\begin{arrows}
\ncarr{v}{u}\blabel{r_e}[0.25][0.4]
\ncarr{v}{w}\alabel{r_f}[0.25][0.4]
\ncarr{x}{w}\blabel{r_g}[0.25][0.4]
\ncarr{x}{y}\alabel{r_h}[0.25][0.4]
\ncarr{z}{y}\blabel{r_i}[0.25][0.4]
\end{arrows}
$$


where
\newcommand{\fConstriction}
{\reallywidehat{\overline{h\circ\widehat{i}}\circ g}}
\newcommand{\eRestriction}
{\overline{f\circ\fConstriction}}
\newcommand{\rebar}{\overline{e} \circ \eRestriction}
\newcommand{\rf}{\overline{e} \circ f \circ \reallywidehat{\overline{h \circ \widehat{i}} \circ g} }
\newcommand{\rfhat}{\widehat{\overline{e} \circ f} \circ \fConstriction}
\newcommand{\hRestriction}
{\overline{g \circ \reallywidehat{\overline{e} \circ f}}}
\newcommand{\rgbar}{\hRestriction\circ\overline{h\circ\widehat{i}}}
\newcommand{\rhhat}{\widehat{i} \circ \reallywidehat{\hRestriction \circ h}}
\newcommand{\ri}
{i \circ \reallywidehat{\hRestriction\circ h}}
\newcommand{\hRestrictionSimplified}
{\overline{g \circ \widehat{f}}}
\begin{align*}
r_e&= \eRestriction \circ e  
& \overline{r_e} &= \overline{e} \circ \eRestriction 
&\widehat{r_e}&=\reallywidehat{\eRestriction \circ e}\\
r_f&=\rf 
& \overline{r_f} &= \rebar
&\widehat{r_f} &= \rfhat\\
r_g&=\overline{h \circ \widehat{i}} \circ g \circ \reallywidehat{\overline{e} \circ f}
& \overline{r_g} &= \rgbar
&\widehat{r_g} &= \rfhat   \\
r_h&=\hRestriction\circ h\circ\widehat{i}
&\overline{r_h}&=\rgbar
&\widehat{r_h}&=\rhhat\\
r_i&=\ri&\overline{r_i}&=\overline{\ri}
&\widehat{r_i}&=\rhhat
\end{align*}
Note that $\overline{r_e}, \overline{r_f}, \overline{r_g}$ and $\overline{r_h}$ have been variously simplified using R.2 and R.3 and that $\overline{r_i}$ does not simplify. Likewise $\widehat{r_f}, \widehat{r_g} , \widehat{r_h}$ and $\widehat{r_i}$ have been variously simplified using lemma \ref{fglemma}, (i) and (iii), and $\widehat{r_e}$ does not simplify.

\textbf{WHAT HAPPENS IF ONLY THE LAST LEG FAILS THE TIGHTNESS CONDITION} 
Suppose $\overline{e}=\overline{f}$, $\widehat{f}=\widehat{g}$, $\overline{g}=\overline{h}$. Then we get the some simplifications as follows.

Stage one $bar{e}=\overline{f}$: 
\begin{align*}
&&& \overline{e}=\overline{f} && \widehat{f} = \widehat{g}  && \overline{g} = \overline{h} \\
r_e&= \eRestriction \circ e  
&& 
&& \\
r_f&=\rf  
&&= f \circ \reallywidehat{\overline{h \circ \widehat{i}} \circ g} 
&& \\
r_g &=\overline{h \circ \widehat{i}} \circ g \circ \reallywidehat{\overline{e} \circ f}
&&= \overline{h \circ \widehat{i}} \circ g \circ \reallywidehat{f}
&&=  \overline{h \circ \widehat{i}} \circ g \\
r_h &=\hRestriction\circ h\circ\widehat{i}
&&= \hRestrictionSimplified\circ h\circ\widehat{i} 
&&= \overline{g} \circ h \circ \widehat{i}
&&= h \circ \widehat{i} \\
r_i &=\ri 
&&=i \circ \reallywidehat{\hRestrictionSimplified \circ h}
&&=i \circ \reallywidehat{\overline{g} \circ h}
&&= i \circ \widehat{h}
\end{align*}

\textbf{Rename}
Rename $e,f,g,h,i$ to be $f_0,f'_0,f_1,f'_1,f_2$.

Rename $r_e,r_f,r_g,r_h,r_i$ to be $t_0,t'_0,t_1,t'_1,t_2$.

Then  \textbf{what happens if only the last leg fails the tightness condition:}

\begin{alignat*}{2}
t_2 &=f_2 \circ \widehat{f'_1} \\
t'_1&=f'_1\circ\widehat{t_2} &&= f'_1 \circ \widehat{f_2}\\
t_1&= \overline{t'_1}\circ f_1&=\overline{f'_1 \circ \widehat{f_2}} \circ f_1\\
t'_0&=f'_0 \circ \widehat{t_1}=f'_0 \circ \reallywidehat{\overline{f'_1 \circ \widehat{f_2}} \circ f_1}\\
t_0&=\overline{t'_0}\circ f_0
\end{alignat*}

\textbf{Same but with just $f_0,f'_0$ and $f_1$}

\begin{alignat*}{2}
t_1&= f_1 \circ \widehat{f'_0}\\
t'_0&=f'_0 \circ \widehat{t_1} &&=f'_0 \circ \widehat{f_1}\\
t_0&=\overline{t'_0} \circ f_0 &&= \overline{f'_0 \circ \widehat{f_1}} \circ f_0 
\end{alignat*}

\textbf{Same but substitute $g_0 \circ f_1$ for $f_1$.}
\begin{alignat*}{2}
t_1&= g_0 \circ f_1 \circ \widehat{f'_0}  &&= g_0 \circ f_1\\
t'_0&=f'_0 \circ \widehat{t_1} &&=f'_0 \circ \widehat{g_0 \circ f_1}\\
t_0&=\overline{t'_0} \circ f_0 &&= \overline{f'_0 \circ \widehat{g_0 \circ f_1}} \circ f_0 
\end{alignat*}


\subsection{Comparison of Zigzags}
Say that zigzags are comparable if they are of the same length
and have identical object sequences.
If $F\tuple{f_0,f'_0,...f_{n-1},f'_{n-1},f_n}$ and 
$G\tuple{g_0,g'_0,...g_{n-1},g'_{n-1},g_n}$
 are comparable zigzags then define $F \leq G$
by $F \leq G$ iff for each $i$, $0 \leq i \leq n$
$f_i \leq g_i$ and for each $i$, $0 \leq i \leq n-1$ $f'_i \leq g'_i$.

\subsection{Tightening}


%zigzagTuple{f}{n}
\newcommand{\zigzagTuple}[2]
{
\tuple{#1_0,#1'_0,...#1_{#2-1},#1'_{#2-1},#1_{#2}}    
}

If $F=\zigzagTuple{f}{n}$ is a zigzag
then define the one-step tightening $t_F$ to be the comparable zigzag, 
$T_F=\zigzagTuple{t}{n}$
where
\begin{align*}
t_0  &= \overline{f'_0}\circ f_0 \\
t'_i &= \overline{f_i} \circ f'_i \circ \widehat{f_{i+1}} &&\mbox{for each $i$, $0 \leq i \leq n-1$}\\
t_i &= \overline{f'_i}\circ f_i \circ \widehat{f'_{i-1}} &&\mbox{for each $i$, $1 \leq i \leq n-1$}\\
t_n &= f_n \circ \widehat{f_{n-1}}
\end{align*}

\begin{observation}
If $F$ is a zigzag and $T_F$ is its one-step tightening
then $T_F \leq F$.
\end{observation}

Let $T^p_F$ be the result of applying the one-step tightening to $F$ and then applying the tightening to the result and so on $p$ times.
\begin{observation}
For any zigzag $F$, there is a number $p \geq 0$ such that
$T^p_F$ is tight and therefore $T^{p+1}_F=T^p_F$.
\end{observation}
We shall use the notation $T^*_F$ for this and say that it is the absolute tightening of $F$.

\begin{lemma}
\llabel{tighteningStepLemma}
If $F$ is a zigzag and and 
if $G$ is a zigzag that is a comparable  to $F$ and is tight then if $G \leq F$
then $G \leq T_F$. 
\end{lemma}
\begin{proof}
There are four cases to consider.
Holds in the first case as follows.
\begin{align*}
&g'_0 \leq f'_0 \\
\mbox{therefore }&\overline{g'_0} \leq \overline{f'_0} \\
\mbox{therefore }&\overline{g_0} \leq \overline{f'_0} &\mbox{because g tight, $\overline{g'_0} = \overline{g_0}$ }
\end{align*}
Since $g_0 \leq f_0$ and $\overline{g_0} \leq \overline{f'_0}$
then from lemma \ref{leqlemma} it follows that
$g_0 \leq \overline{f'_0}\circ f_0$, as required.
\end{proof}
\begin{corollary}
\llabel{absoluteTighteningCorollary}
If $F$ is a zigzag and $T^*_F$ is tha absolute tightening of $F$, 
if $G$ is a zigzag that is a comparable  to $F$ and is tight then if $G \leq F$
then $G \leq T^*_F$. 
\end{corollary}



\begin{observation}
\llabel{tailSpecialisationLemma}
\commentary{reword as any tightening????}
If $F_a=\tuple{f_0,f'_0,...f_{n-1},f'_{n-1},a}$
and $F_b=\tuple{f_0,f'_0,...f_{n-1},f'_{n-1},b}$
are zigzags that, as you can see, differ only in the final position and
if $\widehat{b} \leq \widehat{a}$
then 
\begin{enumerate}[(i)]
\item if $T_{F_a}=\zigzagTuple{t}{n}$
is the one-step tightening of $F_a$
and  $T_{F_b}=\zigzagTuple{s}{n}$
is the one-step tightening of $F_b$ then
for each $i$, $0 \leq i \leq n-1$, $s_i \leq t_i$ and $s'_i \leq t'_i$,
\item if $T^*_{F_a}=\zigzagTuple{t}{n}$
is the absolute tightening of $F_a$
and  $T^*_{F_b}=\zigzagTuple{s}{n}$
is the absolute tightening of $F_b$ then
for each $i$, $0 \leq i \leq n-1$, $s_i \leq t_i$ and $s'_i \leq t'_i$.
\end{enumerate}
\end{observation}

\begin{observation}
\llabel{tailLemma}
\commentary{reword as any tightening}
If $F_a=\tuple{f_0,f'_0,...f_{n-1},f'_{n-1},a}$
and $F_b=\tuple{f_0,f'_0,...f_{n-1},f'_{n-1},b \circ a}$
are zigzags that, as you can see, differ only in the final position 
then 
\begin{enumerate}[(a)]
\item
if $T_{F_a}=\zigzagTuple{t}{n}$
is the one-step tightening of $F_a$
and  $T_{F_b}=\zigzagTuple{s}{n}$
is the one-step tightening of $F_b$ then
\begin{enumerate}[(i)]
\item for each $i$, $0 \leq i \leq n-1$, 
$s_i \leq t_i$ and $s'_i \leq t'_i$,
\item $s_n = b \circ t_n$,
\end{enumerate}
\item
if $T^*_{F_a}=\zigzagTuple{t}{n}$
is the absolute tightening of $F_a$
and  $T^*_{F_b}=\zigzagTuple{s}{n}$
is the absolute tightening of $F_b$ then
\begin{enumerate}[(i)]
\item for each $i$, $0 \leq i \leq n-1$, 
$s_i \leq t_i$ and $s'_i \leq t'_i$,
\item $s_n = b \circ t_n$.
\end{enumerate}
\end{enumerate}
\end{observation}

\begin{observation}
\llabel{headLemma}
\commentary{reword as any tightening}
If $G_a=\tuple{a,f'_0,...f_{n-1},f'_{n-1},f_n}$
and $G_b=\tuple{a \circ b ,f'_0,...f_{n-1},f'_{n-1},f_n}$
are zigzags that, as you can see, differ only in the first position 
then 
\begin{enumerate}[(a)]
\item
if $T_{G_a}=\zigzagTuple{t}{n}$
is the one-step tightening of $G_a$
and  $T_{G_b}=\zigzagTuple{s}{n}$
is the one-step tightening of $G_b$ then
\begin{enumerate}[(i)]
\item $s_0 = t_n \circ b $,
\item for each $i$, $1 \leq i \leq n$, 
$s_i \leq t_i$,
\item for each $i$, $0 \leq i \leq n-1$, 
$s'_i \leq t'_i$,
\end{enumerate}
\item
if $T^*_{F_a}=\zigzagTuple{t}{n}$
is the absolute tightening of $F_a$
and  $T^*_{F_b}=\zigzagTuple{s}{n}$
is the absolute tightening of $F_b$ then
\begin{enumerate}[(i)]
\item $s_0 = t_n \circ b $,
\item for each $i$, $1 \leq i \leq n$, 
$s_i \leq t_i$,
\item for each $i$, $0 \leq i \leq n-1$, 
$s'_i \leq t'_i$.
\end{enumerate}
\end{enumerate}
\end{observation}



\begin{observation}
\llabel{biggeristighter}
If we have two zigzags $F$ and $G$ and one is an extension of the other
then the tightening of the longer one truncated to be comparable with the smaller is less than or equal the tightening of the smaller one.\commentary{Trivial but needs spelling out.}
\end{observation}


\begin{lemma}
\llabel{tighteningCommutesWithCompositionLemma}

If $F=\zigzagTuple{f}{n}$ is a zigzag shaped like this
$$
\arraycolsep=7pt
\zigzag{w}{x}{f}{n}
$$
and if $G=\zigzagTuple{g}{m}$ is a zigzag shaped like this
$$
\arraycolsep=7pt
\zigzag{y}{z}{g}{m}
$$

and if $w_n = y_0$ so that there is a composite zizzag which we will denote 
$F \circ G$ like so
$$
\arraycolsep=7pt
\zigzagfgcomposite
$$
then if 
\begin{itemize}
\item $T^*_F$ is the absolute tightening of $F$,
\item $T^*_G$ is the absolute tightening of $G$,
\item $T^*_{T^*_F \circ T^*_G}$ is the absolute tightening of $T^*_F \circ T^*_G$
\item $T^*_{F\circ G}$ 
        is the absolute tightening of $F \circ G$
\end{itemize}
then $T^*_{F\circ G}=T^*_{T^*_F \circ T^*_G}$
\end{lemma}

\newcommand{\tightenedComposite}[1]
{
\zigzagZeroOneShort{w}{x}{#1}
\begin{array}{c}
\dots \\[0.8cm]
\dots
\end{array}
\begin{array}{c c}
\Ob{x}{n} \\[0.8cm]
& \Ob{w}{n}=
\end{array}
\begin{arrows}
\ncarr{xn}{wn} \blabel{#1'_{n-1}}[0.2][0.4] %0.2 was 0.45
\end{arrows}
\kern-15pt
\arraycolsep=7pt
\zigzagFlex{y}{z}{#1}{n}{n+m}
}


\begin{proof}
Suppose 
\begin{itemize}
\item $T^*_F=\zigzagTuple{t}{n}$,
\item $T^*_G=\zigzagTuple{s}{m}$,
\item $T^*_{T^*_F \circ T^*_G}=\zigzagTuple{r}{n+m}$so that we have
$$
\arraycolsep=7pt
\tightenedComposite{r},
        $$
\item $T^*_{F\circ G}=\zigzagTuple{q}{n+m}$ 
so that we have
$$
\arraycolsep=7pt
\tightenedComposite{q}.
        $$
\end{itemize}
We will prove the result by showing 
(a) that $T^*_{T^*_F \circ T^*_G} \leq T^*_{F\circ G}$
and (b) that $T^*_{F\circ G} \leq T^*_{T^*_F \circ T^*_G}$.

To establish (a), since $T^*_{T^*_F \circ T^*_G}$ is tight,
it suffices to show that 
$T^*_{T^*_F \circ T^*_G} \leq F\circ G$. 
We know that
$$
T^*_{T^*_F \circ T^*_G}
\leq \tuple{t_0,t'_0,...t'_{n-1},s_0 \circ t_n,s'_0,...s_m}
$$
and so it suffices to show that 
$$
\tuple{t_0,t'_0,...t'_{n-1},s_0 \circ t_n,s'_0,...s_m}
\leq \tuple{f_0,f'_0,...f'_{n-1},g_0 \circ f_n,g'_0,...g_m}
$$
This follows because
$$\zigzagTuple{t}{n} \leq \zigzagTuple{f}{n}$$
as the left zigzag is defined to be a tightening of the right,
likewise we have
$$\zigzagTuple{s}{m} \leq \zigzagTuple{g}{m}$$
 and because
$s_0 \circ t_n \leq g_0 \circ f_n$ follows 
from $s_0 \leq g_0$ and $t_n \leq f_n$ by lemma \ref{leqlemma}.

To establish (b), because $T^*_{F \circ G}$ is tight it suffices to show that
$T^*_{F \circ G} \leq T^*_F \circ T^*_G$. In other words that
$$
\tuple{q_0,q'_0,...q'_{n-1},q_n,q'_n,...q_{n+m}}\leq \tuple{t_0,t'_0,...t'_{n-1},s_0 \circ t_n,s'_0,...s_m}
$$
We prove this piecemeal. 
For the initial segment as far as $q_{n-1}$ 
Because $\tuple{q_1,...q_{n+m}}$ is the tightening of $F \circ G$ it follows that
$$
\tuple{q_1,...q'_{n-1}} \leq \tuple{f_1,...f'_{n-1}} \leq \tuple{t_1,...t'_{n-1}}
$$
For the final segment after $q'_n$ we have
$$
\tuple{q'_n,q_{n+1},...q_{n+m}} \leq \tuple{g'_0,...g_{m}} \leq \tuple{s'_1,...s_m}
$$
That leaves us having to prove that $q_n \leq s_0 \circ t_0$.
Now denote by $F \circ g_0$ the zigzag that is
the initial segment of the zigzag $F \circ G$
that is $\tuple{f_0,...f'_{n-1},g_0 \circ f_n}$
and denote by $f_n \circ G$ the zigzag that is 
the final segment of $F \circ G$
that is $\tuple{g_0 \circ f_n,g'_0,...g_m}$
and let $T_{F \circ g_0}$ and $T_{f_n \circ G}$ be the absolute tightenings of these zigzags.
Because $\tuple{q_1,...q_{n+m}}$ is the tightening of $F \circ G$ it follows
using observation \lref{biggeristighter}  that both
\begin{equation}
\label{qTFg}
\tuple{q_1,...q'_{n-1},q_n} \leq T_{F \circ g_0}
\end{equation}
and
\begin{equation}
\label{qTfG}
\tuple{q_n, q'_n,...q_{n+m}} \leq T_{f_n \circ G}
\end{equation}
By lemma \lref{tailLemma} the final element of $T_{F \circ g_0}$ is $g_0 \circ t_n$.
Therefore from (\ref{qTFg}) we have in particular that
\begin{equation}
\label{qgtn}
q_n \leq g_0 \circ t_n.
\end{equation}
Likewise using lemma \lref{headLemma} we have that the initial element
of $T_{f_n \circ G}$ is $s_0 \circ f_n$ and therefore from 
(\ref{qTfG}) we have the particular case that
\begin{equation}
\label{qsfn}
q_n \leq s_0 \circ f_n.
\end{equation}
Finally we use lemma \lref{pointwiseleqlemma} to establish  from
(\ref{qgtn}) and (\ref{qsfn}) that
$q_n \leq s_0 \circ t_0$ and so complete the proof.
\end{proof}
\subsection{The category of tight zigzags}
If \catcw is a range category then we can define the category
$Z_C$ to be the category whose objects are the objects of \catcw
and such that $Hom_{Z_C}(a,b)$ is the set of tight zigzags of any length $n$
$$
\arraycolsep=7pt
\zigzag{x}{y}{f}{n}
$$
such that $x_0=a$ and $y_n=b$.

\newcommand{\conc}{::}

Composition in $Z_C$ is defined by composing the zigzags and then tightening.  Write this as
$$F \circ G =_{def} T(F :: G)$$
so that what previously we denote $T^*_F$ we now denote T(F).

Composition is associative since 
\begin{align*}
(F \circ G) \circ H 
                &= T(T(F \conc G) \conc H) \\
                &= T(T(F \conc G) \conc T(H))
                        &\mbox{since $H$ is tight,}\\
                &= T((F \conc G) \conc H)  
                        &\mbox{by lemma \ref{tighteningCommutesWithCompositionLemma}}\\
                &= T(F \conc (G \conc H))
                        &\mbox {since $\conc$ is associative} \\
                &= T(T(F) \conc T(G \conc H))       
                        &\mbox{by lemma \ref{tighteningCommutesWithCompositionLemma}}\\
                &= T(F \conc T(G \conc H))))
                        &\mbox{since $F$ is tight} \\
                &= F \circ (G \circ H)                     
\end{align*}

Identity morphisms in $Z_C$ consist of the identity morphisms of \catcw considered 
as zigzags on length 1.

\begin{lemma}
\llabel{leftLowLemma}
If $\tuple{f_0,f'_0,f_1}$ is a zigzag and if
$$\overline{f_0} \leq \overline{f'_0}$$
and
$$\widehat{f'_0} = \widehat{f_1}$$
then
$$T(\tuple{f_0,f'_0,f_1})=\tuple{f_0,
                                 \overline{f_0} \circ f'_0,
                                 f_1 \circ \widehat{\overline{f_0} \circ f'_0}
                                }$$
\end{lemma}
\begin{proof}
handwrittem sheet A
\end{proof}


\subsection{Can we prove that $Z_C$ is a restriction category?}


If $F=\zigzagTuple{f}{n}$ is a morphism in $Z_C$ then define $\overline{F}$ to be $\tuple{\widehat{f_0}}$ the  zigzag of length $1$ determined by the morphism $\widehat{f_0}$ of \catcw.

We need show

R.1 For $F:a \morph b$ in $Z_C$ $$\overline{F} \circ F =F$$.

R.2. If \FGsourcediag in $Z_C$ then
$$\overline{G} \circ \overline{F}=\overline{F} \circ \overline{G}.$$

R.3. If \FGsourcediag in $Z_C$ then
$$\overline{\overline{F} \circ G} = \overline{F} \circ \overline{G}$$.

R.4. If $\sequentialdiag{a}{b}{c}{F}{G}$ in $Z_C$ then
$$F \circ \overline{G} = \overline{F \circ G} \circ F$$.

R.1 follows because in \catcw, $f_0 \circ \widehat{f_0} = f_0$. 

R.2 follows because in \catcw $\widehat{f_0} \circ \widehat{g_0} = \widehat{g_0} \circ \widehat{f_0}$.

R.3 follows because
\commentary{work on this proof}
\begin{align*}
\overline{\overline{F} \circ G} 
                   &= \overline{T(\tuple{g_0 \circ \widehat{f_0},g'_0,...g_m})}\\
                   &= \overline{\tuple{g_0 \circ \widehat{f_0},s'_0,...s_m}}
                                             &&\mbox{\parbox{5cm}{for some $s'_0,...s_m$
                                                       by some new lemma about tighteniong when only head position loose,}}\\
                   &=\tuple{\widehat{g_0 \circ \widehat{f_0}}} 
                                            && \mbox{by definition}\\
                   &=\tuple{\widehat{g_0} \circ \widehat{f_0}}  
                                            && \mbox{by lemma \ref{fglemma} (iii)}\\
                   &=\overline{F} \circ \overline{G}      
\end{align*}



to prove R.4 we need first prove that

\begin{equation}
\label{restrictionlemmiiasR4Antecedent}
\overline{F \circ G}=\overline{F \circ \overline{G}}
\end{equation}


we can then proceed as follows.


\textbf{Proceed by induction  --- four ways to ??}



\textbf{Way two --- init(F) :: last(F)}

First consider that if $F$ is the zigzag
$$
\arraycolsep=7pt
\zigzag{x}{y}{f}{n}
$$
then if $n \geq 2$ then $F$ 
then it can be expressed as  the composition of zigzags
\begin{equation}
\label{FheadTail}
F=init(F)::last(F)
\end{equation}
where
\begin{align*}
init(F) &= \tuple{f_0,f'_0,...,f'_{n-2},f_{n-1}} \\
last(F) &= \tuple {\overline{f'_{n-1}},f'_{n-1},f_n}
\end{align*}

We will first prove that R.4 holds for $F$ of length $2$, the case of $n=2$,
and then prove R.4 holds for $F$ of length greater than $2$ by induction on $n$.

\textbf{Case $n=2$}

Suppose $that F$ is the zigzag
$$
\arraycolsep=7pt
\begin{array}{cccc}
 &\bOb{x}& &\bOb{z} \\[0.8cm]
\bOb{w}& &\bOb{y}&
\end{array}
\begin{arrows}
\ncarr{x}{w}\blabel{f_0}[0.25][0.4]
\ncarr{x}{y}\alabel{f'_0}[0.25][0.4]
\ncarr{z}{y}\blabel{f_1}[0.25][0.4]
\end{arrows}
$$
of length $2$.
We need show that

$$
F \circ \overline{G}  = \overline{F \circ G} \circ F 
$$


\begin{align*}
LHS &= \tuple{f_0,f'_0,f_1} \circ \overline{G} \\
    &= T(\tuple{f_0,f'_0,\reallywidehat{g_0} \circ f_1}) &&\mbox{using the definition of the $\bar{}$ operator for zigzags} \\
    &= \tuple{ \overline {f'_0  \circ \reallywidehat{g_0 \circ f_1}} \circ f_0, 
                 f'_0  \circ \reallywidehat{g_0 \circ f_1}, 
                 \reallywidehat{g_0} \circ f_1   
                }  && \mbox{by earlier that needs be lemmarised, and by RR.4 (twice)}
\end{align*}

\begin{align*}
RHS &=  \overline{F \circ G} \circ F \\
    &= \overline{F \circ \overline{G}} \circ F 
                  &&\mbox{ using (\ref{restrictionlemmiiasR4Antecedent}),}\\
    &= \overline{\tuple{ \overline {f'_0  \circ \reallywidehat{g_0 \circ f_1}} \circ f_0, 
                 f'_0  \circ \reallywidehat{g_0 \circ f_1}, 
                 \reallywidehat{g_0} \circ f_1   
                }} \circ F 
                  &&\mbox{using LHS as above,} \\
    &= \reallywidehat{\overline {f'_0  \circ \reallywidehat{g_0 \circ f_1}} \circ f_0} \circ F
                  && \mbox{ from definition of the $\bar{\ }$ operator,} \\
    &= T(\tuple{
            f_0 \circ\reallywidehat{\overline {f'_0  \circ \reallywidehat{g_0 \circ f_1}} \circ f_0},
            f'_0,
            f_1
        })         
                  && \mbox{from definition of $\circ$}\\
    &= \tuple{
            t_0,
            \overline{t_0} \circ f'_0,
            f_1 \circ \reallywidehat{\overline{t_0} \circ f'_0}
        } \mbox{ where } t_0 = f_0 \circ\reallywidehat{\overline {f'_0  \circ \reallywidehat{g_0 \circ f_1}} \circ f_0} 
    && \mbox{ by lemma \ref{leftLowLemma} leftLowLemma}\\
    &= &&\mbox{something that  hopefully matches rhs of LHS, above}   
\end{align*}

\textbf{case $n > 2$}
For $F$ of length greater than $2$ we prove by induction. The inductive hypothesis is
\begin{equation}
\label{R4InductiveHypothesis}
init(F) \circ \overline{G} = \overline{init(F) \circ G} \circ init(F)
\end{equation}
Note first that
\begin{equation}
\label{headTailAndG} 
init(F) \circ tail(F) \circ G= F \circ G
\end{equation} 
follows from the definitions and from lemma \ref{tighteningCommutesWithCompositionLemma}.

\begin{align*}
F \circ \overline{G} 
    &= (init(F) \conc last(F)) \circ \overline{G}
                            && \mbox{using (\ref{FheadTail}),}\\
    &= T( init(F) \conc last(F) \conc \overline{G}) 
                            && \mbox{from definition of $\circ$ and assicativity of $\conc$,}\\
    &= T( init(F) \conc T(last(F) \conc \overline{G}) )
                            && \mbox{by lemma \ref{tighteningCommutesWithCompositionLemma},}\\
    &= T( init(F) \conc (last(F) \circ \overline{G}) )
                            && \mbox{using definition of $\circ$,}\\
    &= T(init(F) \conc (\overline{last(F) \circ G} \circ last(F)) )
                            && \mbox{using $n=1$ case,} \\
    &= init(F) \circ \overline{last(F) \circ G} \circ last(F) 
                            && \mbox{using definition of $\circ$,} \\
    &= \overline{init(F) \circ last(F) \circ G} \circ init(F)  \circ last{F} 
                            && \mbox{using the inductive hypothesis (\ref{R4InductiveHypothesis}),} \\
    &= \overline{F \circ G} \circ F 
                                && \mbox{as required, by applying (\ref{headTailAndG}).}
\end{align*}

