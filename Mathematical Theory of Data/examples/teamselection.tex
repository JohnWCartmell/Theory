\commentary {An example of a model that does not have the fd factoring property.}
We imagine a situation in which a number of people are separated into teams by asking each person to select a person they wish to be teamed up with. Teams of various sizes are picked based on this information and coloured vests are worn by people to be indicative of the teams that they are in.
We choose to represent this team information by the schema shown in figure \ref{teamselectionexample}. 

\begin{figure} [h]
\begin{center}
\begin{tabular}{c c}
\begin{tabular}{c p{1.5cm} c}
   \Rnode{p}{p} & & \Rnode{v}{v}
\end{tabular}
\nccircle[nodesep=3pt]{<-}{p}{.4cm}
\blabel{S}
\ncarr[-40]{p}{v}
\alabel{c}[0.4]
\ncarr{p}{v} 
\alabel{pId}
\idcomp
& \footnotesize
\begin{tabular}{c p{1.5cm} p{4cm}}
KEY && \\
\hline
p & person & Identified by id attribute ($pId$). \\
s & selects & each person selects exactly one other person \\
c & colour & each person is given a coloured vest 
\end{tabular} 
\end{tabular}
\end{center}
\caption{Team Selection Example. The  vest colour  of a person is 
identical to the vest colour of their selected buddy which is to say that the path equivalence $S \circ c \simeq c$ holds. From this
we can show that this model exhibits a transitive functional dependency which does not factor through an intransitive dependency.
}
\label{teamselectionexample}
\end{figure}

That the  vest colour  of a person is 
identical to the vest colour of their selected buddy can be expressed by the path equivalence $S \circ c \simeq c$. 
\begin{categoricalaside}
Another way of expressing this 
path equivalence is by stating that in the category of paths through the schema  the diagram
$
\begin{array}{c p{0.75cm} c}
   \Rnode{p1}{p}  & &                  \\[0.5cm]
	                 & &    \Rnode{v}{v} \\[0.5cm]
   \Rnode{p2}{p}  & &
			
\end{array}
$
\ncarr{p1}{v}
\alabel{c}[0.4]
\ncarr{p2}{v}
\blabel{c}[0.4]
\ncarr{p1}{p2}
\blabel{S}[0.4]
commutes. 
\end{categoricalaside}

Now consider the functional dependency
\begin{equation*}
\sfd{S/pId}{c}
\end{equation*}
sourced at entity type $p$. It is transitive
because though we also have functional dependencies
\begin{equation*}
S/Pid \morph S 
\end{equation*}
and
\begin{equation*}
\sfd{S}{c}
\end{equation*}
The latter is transitive because we also have
\begin{equation*}
\sfd{S}{S/S}
\end{equation*}
and
\begin{equation*}
\sfd{S/S/S}{c} 
\end{equation*} 

If, as we do, we assume that selection is unconstrained then $S$ is not a mono-source in this model and there can be arbitrary long chains of selection.
In  all therefore there is an infinity of functional dependencies non of which are reversible

\begin{equation}
S/pId \morph S \morph S/S \morph S/S/S \morph S/S/S/S .. \morph c
\end{equation}
We can see that the model has a transitive functional dependency $S/pId \morph c$ which is between
attribute-like paths but which cannot be factored right-intransitively. The left hand side, $S/pId$, is not a mono-source\commentary{this is under review 29 May 2020}, therefore the model doesn't meet the conditions of lemma \ref{????} and therefore we cannot be sure that the relational design determined by the $\chi$ mapping will  be in 3NF.


In fact, in the relational design produced by the $\chi$ mapping the person entity type, abbreviated $p$ in the diagram, maps to the following relation:
\begin{equation}
\label{personrelation}
person(\underline{pId}, spId, c)
\end{equation}
The  attribute of this relation are related by the following  functional dependencies:
\begin{equation}
\sfd{pId}{spId}
\end{equation}
\begin{equation}
\label{colourfd}
\sfd{pId}{c}
\end{equation}
\begin{equation}
\sfd{spId}{c}
\end{equation}
and the following  inclusion dependency:
\begin{equation}
\label{spIdcolour1}
person[spId,c] \subseteq person[pId,c]
\end{equation}

The $person$ relation (\ref{personrelation}) is not in 3NF because the dependency (\ref{colourfd}) is transitive but its rhs, $c$, is not a key attribute wrt the relation \commentary{This uses Codd's way of describing 3NF not Zaniolo's.}. However this
relation (\ref{personrelation}) can be normalised into relations (\ref{person1relation}) and (\ref{person2relation}):
\begin{equation}
\label{person1relation}
selected(\underline{spId},  c)
\end{equation}
\begin{equation}
\label{person2relation}
person(\underline{pId}, spId)
\end{equation}
satisfying the inclusion dependencies
\begin{equation}
selected[spId] \subseteq person[pId]
\end{equation}
and
\begin{equation}
\label{spIdcolour}
selected[spId,c] \subseteq (selected \bowtie_{spId=pId} 
                                       (person \bowtie selected [pId,c]) )
																			[spId,c];
\end{equation}
The latter inclusion dependency is a database constraint that
is more difficult to police in an implementation
than the prior equivalent (\ref{spIdcolour1}) and
this gives one advantage to the unnormalised design as generated
directly from the entity model. 

A revised model which reflects the normalised relational design is this:
\begin{center}
\begin{tabular}{c p{1.5cm} c}
   \Rnode{sp}{sp} & &           \\[1.4cm]
   \Rnode{p}{p}   & & \Rnode{v}{v}
\end{tabular}
\ncarr[40]{p}{sp}
\alabel{S}
\ncarr{sp}{p}
\alabel{I}
\idcomp
\ncarr[20]{sp}{v}
\alabel{c}[0.4]
\ncarr{p}{v} 
\alabel{pId}
\idcomp
\end{center}

In the revised model we have
\begin{equation}
I/pId \morph I/S \morph I/S/S \morph I/S/S/S ... \morph c
\end{equation}
and $I/pId \morph c$ is a transitive fd between attribute-like paths which cannot
be factored right-intransitively. However  the left  hand side, $I/pId$, is a mono-source and
so the condition for the determined relational design to be in normal form is met.

But $I/S$ isn't a mono-source \commentary{Big shortcoming}
and $I/S/I/pId \morph c$ is an fd between  paths that cannot be right factored??? 
Of course $I/S/I/pId$ is not attribute like.

Maybe what I need is that every functional dependency is finitely represented.

What I have written in notebook regarding constrained version of this example is that
whenever $p \circ x \simeq x$ then $p$ factors through a mono-source i.e. is identical to or equivalent to 
$I \circ p'$ for some path $p'$ where $I$ is a mono source. This coming about remember because we are trying to prove lemma 
%freeofdesignredundancyimpliesfdlhsismonosource 
\lref{freeofdesignredundancyimpliesfdlhsismonosource}.

