
\subsection{Representation of Functional Dependencies}

\begin{lemma}
\llabel{functionaldependencyrepresentationlemma}
If $\catc$ is a locally finite range category and $\reqtc$ is a set of instances, if $\catc$ is 
\term{maximally constrained} to the requirement $\reqtc$ then
all functional dependencies $\fundep{H}{f}{g}$  with respect to $\reqtc$ are represented in $\catc$.
\end{lemma}
\begin{proof}

Suppose such a category  $\catc$  that  is 
\term{maximally constrained} to a requirement $\reqtc$ and suppose
$
\begin{array}{c p{0.5cm} c  }
             &&   \Rnode{b}{b} \\[0.01cm]
\Rnode{a}{a} &&                \\[0.01cm] 
             &&   \Rnode{c}{c}         
\end{array} 
$
\ncarr{a}{b}
\alabel{f}
\ncarr{a}{c}
\blabel{g}
in $\catc$ 
and that there is a functional dependency $\fundep{H}{f}{g}$ with respect to $\reqtc$.



From sketch $S$ of $C$ we can construct a sketch $S'$ by formally 
adding a morphism $\qq{h}: b \morph c$
and path equivalences 
\begin{equation}
\label{hquote}
f \circ \qq{h} = g,
\end{equation} 
\begin{equation}
\label{hquotebar}
\bar{\qq{h}}=\hat{f}
\end{equation} 
and 
\begin{equation}
\label{hquotehat}
\widehat{\qq{h}}=\hat{g}. 
\end{equation}

Let $\catcp$ be the range category generated by $S'$ and
let $I: C \morph C'$ be the inclusion (range) functor 
generated by the inclusion of $S$ in $S'$. 
\newt{Justify that $I$ is a range functor.}

Now we show that $I$ is consistent with $\reqtc$. 
We need to show that any $D \in \reqtc$
extends unqiuely to $D' :\catcp \morph \Fin$. Assume such a $D$. 
$D$  extends to $C'$ iff there is a  function that we can choose as the value of  for $D'(\qq{h})$  such that $D'(f) \circ D'(\qq{h}) = D'(g)$ i.e such that
$D(f) \circ D'(\qq{h}) = D(g)$ and $d(\qq{h})=\widehat{D(f)}$
and so we  extend $D$ to $D'$ 
 by defining $D'(\qq{h})=H_D$.
\begin{newtt}
$D'$ is a range functor because
\begin{align*}
\overline{D'(\qq{h})}&= \overline{H_D} && \mbox{by definition of $D'$,}  \\
                     &= \widehat{D(f)} && \mbox{by definition of functional dependency,} \\
                     &= D(\hat{f})     && \mbox{since $D$ preserves ranges,} \\
                     &= D'(\hat{f})     && \mbox{since $D'$ extends $D$,} \\
                     &= D'(\overline{\qq{h}}) && \mbox{by (\ref{hquotebar})}
\end{align*}
and 
\begin{align*}
\widehat{D'(\qq{h})}&= \widehat{H_D}       && \mbox{by definition of $D'$,}  \\
                    &= \widehat{D(g)}      && \mbox{by lemma \ref{fdrangesublemma},}   \\
                    &= D(\hat{g})          && \mbox{since $D$ preserves ranges,}   \\
                    &= D'(\hat{g})         && \mbox{since $D'$ extends $D$, } \\
                    &=D'(\widehat{\qq{h}}) && \mbox{by (\ref{hquotehat}).}
\end{align*}
\end{newtt}
This extension to $D'$ is unique because from the definition of functional dependency
$H_D$ is the unique function 
that satisfies $D(f) \circ H_D = D(g)$ and $\overline{H_D}=\widehat{D(f)}$.

\begin{newtt}
In the remainder of this proof 
we define a functor $G: \catc \morph \Fin$ such that
$G(a)$ has a pair of distinct elements, call them $left$ and $right$, say,  that are mapped by $G(f)$ to identical elements
of $G(b)$, i.e. such that $G(f)(left)= G(f)(right)$.  
We  argue that because of  maximal constrainedness that $G$ can be extended to a functor 
$G' : \catcp \morph \Fin$. 
Because $f \circ \qq{h} = g$ in \catcpw we can argue that $G'(g)$,
and thus $G(g)$,
maps $left$ and $right$ to identical elements of $G(c)$ 
i.e. is such that $G(g)(left)= G(g)(right)$. 
This  is then enough 
to ensure that there exists a morphism $h:b \morph c$ in \catc
such that $f \circ g = h$
 with the required properties to represent the functionality dependency $H$.
\end{newtt}

\begin{newt}
From the range category \catcw we need  construct a range category $\catc_s$ in which all morphisms are split and a range functor $E: \catcw \morph \catc_s$ which is faithful.   
This construction will, hopefully, be defined elsewhere.
\end{newt}

Define the functor $F: \catcp \morph \FinPar$ be the
composition of the range functor $E$ with the 
coproduct $Hom_{\catc_s}(a,-) + Hom_{\catc_s}(a,-)$
in the functor category $Fin^{\catc}$ and label the injections $L$ and $R$, respectively,
so that for each object $x$ of $\catc$ the diagram
\begin{center}
$
\begin{array}{c p{0.5cm} c p{0.5cm} c  }
\Rnode{h1}{Hom_{\catc}(a,x)}  &&\Rnode{Fx}{F(x)}  &&   \Rnode{h2}{Hom_{\catc}(a,x)}       
\end{array} 
$
\ncarr{h1}{Fx}
\alabel{L_x}
\ncarr{h2}{Fx}
\blabel{R_x}
\end{center}
is a coproduct in $\Fin$. $F$ is a functor such that $F(a)$ has two elements
$L(id_a)$ and $R(id_a)$ and is initial among such functors.

Now for each object $x$ of $\catc$, we define an equivalence relation $\sim_x$ on $F(x)$ by defining,
for $k_1,k_2:a \morph x$ in $\catc$,
\begin{align*}
L_x(k_1) \sim_x R_x(k_2) & \mbox{ iff there exists $k:b \morph x$ in $\catc$ such that $k_1 = f \circ k = k_2$,}\\
L_x(k_1) \sim_x L_x(k_2) & \mbox{ iff $k_1 = k_2$,} \\
R_x(k_1) \sim_x R_x(k_2) & \mbox{ iff $k_1 = k_2$.} \\
\end{align*}
\begin{newtt}
It is easy to see that $\sim_x$  is both symmetric and transitive. \\
\end{newtt}
Now \\
\newt{ showing that it respects composition (conguence?)}
If $j: x_1 \morph x_2$ in $\catc$ and if $y_1,y_2 \in F(x_1)$ such that $y_1 \sim_{x_1} y_2$
then it follows easily by cases and from the definition of $\sim$ that $F(j)(y_1) \sim_{x_2} F(j)(y_2)$.
Therefore we can define a functor 
 $G: \catc \morph \Fin$  so that for any object $x$ of $\catc$
the set $G(x)$ is the quotient $F(x)/{\sim_x}$ and such that 
if $j: x_1 \morph x_2$ in $\catc$ and if $y \in F(x_1)$ then $G(j)([y])=[F(j)(y)]$.

\begin{newtt}
We do need show that $G$, as the quotient of a range functor, is a range functor. I expect this is the case because range functor is algebraically defined.
\end{newtt}

With $G$ so defined then if $k: a \morph x_1$ and $j:x_1 \morph x_2$ in $\catc$
then  $G(j)([L_{x_1}(k)])=[L_{x_2}(k \circ j)]$ and $G(j)([R_{x_1}(k)])=[R_{x_2}(k \circ j)]$. 

Now that we have described the functors  $G: \catc \morph \Fin$ and $I:\catc \morph \catcp$ that is consistent with $\reqtc$
we can use the fact that $\catc$ is maximally constrained to tell us that $G$ extends to a functor 
$G' : \catcp \morph \Fin$. Since $f \circ \qq{h} = g$ in $\catcp$ then we have
 $G'(f) \circ G'(\qq{h}) = G'(g): G(a) \morph G(c)$ in $\Fin$.
Now we have
\begin{align*}
[L_c(g)]&= G(g)([L_a(id_a)]) ,             & & 
                              \mbox{since $G(g)([L_a(id_a)]) = [L_a(Hom(a,g)(id_a))$}] \\
        &= G'(g)([L_a(id_a)])              & & \mbox{since $G'$ extends $G$,}          \\
        &= G'(\qq{h}) (G'(f)([L_a(id_a)])) & & 
                              \mbox{since $G'(f) \circ G'(\qq{h}) = G'(g)$}  \\
        &= G'(\qq{h}) (G(f)([L_a(id_a)])) & & \mbox{since $G'$ extends $G$,}          \\ 
	&= G'(\qq{h}) ([L_b(f)])       & & 
                              \mbox{since $G(f)([L_a(id_a)]) = [L_a(Hom(a,f)(id_a))$}] \\
\end{align*}

By symmetry wee also have
$$[R_c(g)] = G'(\qq{h}) ([R_b(f)])  $$
and therefore can conclude that
$$[L_c(g)] = [R_c(g)]$$

and thus that
$$ L_c(g) \sim_c R_c(g)$$

It follows from the definition of $\sim_c$ that there exists $k:b \morph c$ in 
$\catc$ such that $f \circ k = g$.  \newt{Do we need show uniqueness of such $k$.}  
\newt{Don't  we need show that $D(k) = H_D$. If so do we need show equational completeness before this lemma. WHICH WE CANNOT PROVE.}
\newt{I think we'll need show that $\overline{D(k)} = \widehat{D(f)}$. For this we might need change defn. of $\sim$.}
We have shown as required that the function dependency
$\fundep{H}{f}{g}$ is represented in $\catc$.

\end{proof}


