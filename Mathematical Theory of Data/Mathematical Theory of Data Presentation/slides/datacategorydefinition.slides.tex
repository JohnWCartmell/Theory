
\begin{frame}{Definition -- \datacat}

I assume a fixed set $V$ of universals and define data specifications and instances relative to $V$. 
\medskip
I shall use the shorthand \textit{\datacat} to mean a triple $\tuple{\catc,M,v}$ where 
\begin{itemize}
\item \catcw is a \rangeplus category with specified finite restriction products,
\item $M$ is a set of designated monomorphisms of \catcw closed under composition
and such that each $m \in M$   has a partial inverse $m^{-1}$,
\item a distinguished object $v$, such that every morphism $f: v \morph x$ in \catcw 
factors through $m^{-1}$, for some monomorphism $m$.
\end{itemize}
\end{frame}

\begin{frame}{Data Specifications}
In this presentation, by \textit{data specification} I shall mean a sketch for a \datacat. \\
\medskip
Note that in a data specification the designated object $v$ will have no outgoing edges. \\
\medskip
If $S$ is a sketch for \datacatw denote by $T(S)$ the \datacatw generated from $S$. \\
\medskip
\begin{itemize}
\item Define an instance $F$ of a data specification $S$ to be a 
range functor $F: T(S) \morph \Par$ 
that preserves the specified finite products
and maps the object $v$ to the set $V$.
\end{itemize} 
\medskip
Such an $F$ will preserve designated monomorphisms and their inverses.
\end{frame}

\input{../slides/Shlaer&Lang/relationalDataSlide}  % this slide defines inclusion dependencies
\input{../slides/Shlaer&Lang/relationalDataSpecificationSketchSlide}

\begin{frame}{Relational Data Specifications}
Famously, the relational model of data does not support structural containment. Therefore
for a physical model to be relational it must not have any edges between non-v-nodes.
\medskip
\begin{definition}
A data specification is \textit{relational} iff
\begin{itemize}
	\item the only edges have domain a non-v-node and codomain v,
\item every non-v-node is the domain of at least one v-valued mono-source
i.e. for every non-v-node $a$, for some $n \geq 1$, there exists a source
\begin{displaymath}
\parallelsource{a}{v}{m}{n}
\end{displaymath}
which is designated as a mono-source i.e. for which $\tuple{m_1,...m_n}$ is a designated monomorphism.
\end{itemize}
\end{definition}
\end{frame}

\begin{frame}{Transform a Relational Data Specification to a Logical Data Specification}
\begin{lemma}
For any classic relational data specification 
there is an equivalent data specification
(i.e. one with the same theory category) which is logical.
\end{lemma}

\begin{proof}
In outline: We construct a series of equivalent models by eliminating each 
inclusion dependency in turn. When all eliminated the resulting model is the required logical model. Eliminate the inclusion dependency 
$a[f_1,...f_n] \subseteq b[m_1,...m_n]$
as follows:
\begin{itemize}
\item remove the inclusion dependency,
\item replace by an edge $f: a \morph b$, 
\item remove those $f_i$ that are edges and 
rewrite any occurrence of such $f_i$ in the remaining inclusion dependencies by $f \circ  m_i$, 
\item for those $f_i$ that are not edges add a path equivalence (i.e. a commuting diagram)
$f \circ m_i = f_i$.
\end{itemize}
\end{proof}
An example follows.
\end{frame}

\input{../slides/Shlaer&Lang/relational2logicalSketchTransformationSlide}

\input{../slides/Shlaer&Lang/logicalDataSpecificationSketchSlide}


\newcommand{\transone}{\parbox{2cm}{\textit{Chen's \\transform \\(automated)}}}
\newcommand{\transtwo}{\parbox{2cm}{\textit{normalise \\ a la Codd \\(manual)}}}
\begin{frame}{Best Practice -- Structured Systemns Analysis and Design}

\begin{center}
\begin{tabular}{ p{1.25cm} p{2cm} p{1.25cm} p{2cm}  p{1.25cm}}
\parbox{3cm}{logical \\ data \\ specification}&  $\xRightarrow{\transone}$ & \parbox{3cm}{relational \\ data \\specification} & $ \xRightarrow{\transtwo} $ & \parbox{3.5cm}{relational \\data \\specification}
\end{tabular}
\end{center}
\end{frame}

\begin{frame}{ Chen's First Cut Transformation 1976}
\begin{construction}
From a logical data specification construct a relational data specification.
\end{construction}
\textbf{Chen's 1976 Method}
Replace $f:a \morph b$ in the sketch by edges $\fn$
where $\wanton{m}$ is a v-valued mono-source with domain $a$ 
and inclusion dependency 
$$a[f_1,...f_n] \subseteq b[m_1,...m_n].$$

\textbf{Problem with this method}
\begin{itemize}
	\item Doesn't take account of commutative diagrams,
	\item therefore resulting relational specification
	\begin{itemize}
		\item doesn't have equivalent theory category,
		\item often is not be in normal form.  
	\end{itemize}
	\item This weakness has huge implications for how data specifications are written and maintained.
\end{itemize}
\textbf{Mission}
\begin{itemize}
	\item Theoretically justify an improved algorithm, i.e. one that takes account of commutative diagrams, change how data specifications are managed and databases are programmed.
\end{itemize}
\end{frame}

\newcommand{\newtrans}{\parbox{2cm}{\textit{diagram \\ aware \\ transformation \\ (automated)}}}
\begin{frame}{Revised Best Practice -- Abstract to Logical Level}

\begin{center}
\begin{tabular}{ p{1.25cm} p{2cm} p{1.25cm}}
\parbox{3cm}{logical \\ data \\ specification}&  $\xRightarrow{\newtrans}$ & \parbox{3cm}{relational \\ data \\specification}
\end{tabular}
\end{center}
\textbf{Impact}
\begin{itemize}
	\item No manual normalisation process.
	\item No source code required to describe the physical level.
\end{itemize}
\end{frame}


\input{../slides/Shlaer&Lang/nestedRelationalDataSlide}
\input{../slides/Shlaer&Lang/hierarchicalDataSpecificationSketchSlide}

\begin{frame}{Physical Data Specification}
\begin{definition}
A data specification is \textit{physical} iff
\begin{itemize}
\item every non-v-node is the codomain of at most one edge
\end{itemize}
\end{definition}
In a physical data specification every node and every edge has physical significance
in the database or message structure.
\begin{itemize}
\item Nodes other than v in a physical data specification represent types of entity (ER-speak) 
or record, or represent tables (relational) or structs (IDL).  
\item Edges between non-v-nodes represent those relationships in the data that are physically represented  by \textit{structural containment}.
\item Remaining edges (i.e. those having domain a  non-v-node and codomain v) represent
attributes (ER) or columns of tables (relational) or scalar fields within structs (IDL).  
\end{itemize}
\end{frame}

\input{../slides/Shlaer&Lang/contextualSketchSlide}

\begin{frame}{Example -- LCMSMS Data}
\scalebox{0.2}{
\input{\erpictureFolder/chromatogramanalysisrecord}
}
\pause
\vspace{-5cm}
\begin{block}{}
This diagram has representations of
\begin{itemize}
  \item 33 structural relationships i.e. implemented by structural containment, 
  \item 26 reference relationships i.e. implemented by foreign key,
  \item 16 non-trivial commutative diagrams,
  \item 6 pullback diagrams.
\end{itemize}
Generated into code in XML, ECMA Javascript, Python.
\end{block}
\end{frame}


