
\comingnext{General definitions}

\begin{frame}{Data Specification and Instance}
A \textit{data specification} is a sketch $S$ for some kind of structured category \catc.
i.e. it is a directed graph plus some path equivalences (diagrams in other words) plus 
some additional structure.  \\
\medskip
An \textit{instance} of a data specification is a mapping $D$ from the directed graph
to the category of sets and functions which preserves structure so as
to induce a structure preserving functor $D: \catc \morph \Fin$.
\end{frame}

\begin{frame}{The Requirement}
A \textit{requirement} for a data specification $S$ 
is a set of instances of the sketch $S$ or, equivalently, is a set $R_C$ of functors where for each
$D \in R_C$, $D: \catc \morph \Fin$, where \catcw is the category generated by the sketch $S$.
\end{frame}

\begin{frame}{Goodness Criteria for a Data Specification}
\IfSforCwithRCwordsvariant 
\begin{itemize}
\item 
\textbf {Goodness Criteria of Type 1 :} No redundancy. The sketch $S$ ought to be a minimum sketch for structured category \catcw i.e. there should be no subsketch of $S$ which generates  \catc.
\item
\textbf {Goodness Criteria of Type 2:} \catcw ought to be \textit{maximally constrained} to $\reqtc$.
\end{itemize}
\end{frame}

\begin{frame}{Rationale for Type 1 Criteria}
Must follow the type 1 criteria 
\begin{itemize}
\item to ensure there is no redundancy in the  data that is stored and/or communicated,
\item avoid unnecessary data constraints (such as those that impose uniqueness or referential integrity).
\end{itemize} 
\medskip
One thing to have a system that is out of step with the real world quite another to have a system 
in a state that doesn't correspond to any possible  real world state.
\end{frame}

\begin{frame}{Rationale for Type 2 Criteria}
Try all we can to avoid the possibility of a system state 
that doesn't correspond to any real world state.
\begin{itemize}
\item Good data modelling is good theorising and good theorising is having the tightest theory that fits the facts.
\item Software Engineering: 
\begin{itemize}
\item Document the requirement.
\item Validate data against the requirement. 
\item Restrict degrees of freedom in the data representation.
\item Use declarative style if possible.
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Key definition: \catcw \textit{maximally constrained} to $\reqtc$}
\begin{itemize}


\item  question -- is there a $\catcp$ that extends \catcw and that will do a better job. 

\item Is there a $\catcp$ and an $I: \catc \morph \catcp$  such that 
all instances in the requirement $\reqtc$ uniquely factor though $I$
$$
\begin{array} {c p{2cm} c}
\Rnode{Cp}{C'} && \\ [0.25cm]
             && \Rnode{finset}{\Fin} \\ [0.15cm]
\Rnode{C}{C}  
\end{array}
\begin{arrows}
\ncarr {C}{finset}
\alabel{D}
\ncarr{C}{Cp}
\alabel{I}
\ncarr{Cp}{finset}
\alabel{D'} 
\end{arrows}
$$
\pause  and at least one other instance $F$ of \catcw does not factor through $I$.
\ncarr[-20]{C}{finset}
\blabel{F} 
\end{itemize}
\pause If there is no such $I: \catc \morph \catcp$ then we shall say that 
\catcw is \term{maximally constrained} with respect to $\reqtc$.\\
\medskip
 ...meaning  that structured category \catcw  is the tightest possible fit to facts i.e. to the requirement $R_{\catc}$.
\end{frame}

\begin{frame}{Representational Completeness}
Alternative way of approaching tightest fit:
\begin{itemize}
\item That which is in the data and can be represented in the theory should be represented in the theory.
\item To make precise we can give definitions
 of \textit{representational completeness} wrt $\reqtc$ 
\begin{center}
\begin{tabular}{>{\bfseries}l l} 
2A. & equationally complete   \\
2B. & functionally complete   \\
2C. & referentially complete  \\
2D. & mono complete           \\
2E. & epi complete            \\
2F. & product complete        \\
\end{tabular}
\end{center}
\pause \item In these defintions that \catcw is $x$ complete wrt $\reqtc$ will mean exactly that the set of instances $\reqtc$ are jointly reflective of $x$.
\end{itemize}
\end{frame}

\begin{frame}{Next steps}
For each of
\begin{itemize}
\item categories,
\item categories with designated monomorphisms and epimorphisms,
\item categories with designated monomorphisms and epimorphisms and with finite products
\end{itemize}
\medskip
I am going to
\begin{itemize}
\item define appropriate notions of representational completeness,
\item explore the relationship between representational completeness and maximal constrainedness.
\end{itemize}
{\large Before which -- BCNF that which I want to get to as a consequence of notions of tightest fit.}
\end{frame}


\begin{frame}{BCNF in the abstract (based on Zaniolo 1982 Definition 2)}
If $S$ is a sketch for a category $C$ with designated mono-sources  and finite products
and $S$ is considered as a data specification with requirement $\reqtc$, then it ought to be the case
that if 
\scalebox{0.9}{\multisourcenplusonediagram{n}{a}{b}{x}{c}{y}}
are edges of $S$
and if \msfd{x_1,...x_n}{y}  is a non-trivial functional dependency  between these edges
then \onslide<1>{...}
\onslide<2>{\scalebox{0.8}{\multisourcediagram{n}{a}{b}{x}} is a designated mono-source.}
\end{frame}

\comingnext{Sketches of Categories as Data Specifications}

\begin{frame}{Sketches of Categories as Data Specifications}
By a \term{sketch for a category} we mean a pair $\tuple{G,PE}$ where 
$G$ is a directed graph and $PE$ is a set of path equivalences. \\
\medskip
We interpret  the type 1 goodness criteria that the sketch be minimal as meaning 
\begin{itemize}
\item \goodnessoneA. \\
\medskip
\item \goodnessoneB.
\end{itemize}
\end{frame}

\begin{frame}{Equational Completeness and Goodness Criteria 2A}
\pause \begin{definition}
If $\catc$ is a  category and $\reqtc$ is a set of instances,
 then say that  $\catc$ is \term{equationally complete} with respect 
to the requirement $\reqtc$ iff all path equivalences with respect to $R_C$ are represented in \catcw 
i.e. iff for all diagrams \fgparalleldiagram in $\catc$,  
if in all instances $D \in \reqtc$, $D(f)=D(g)$,  then $f=g$.
\end{definition}
\medskip
\pause In other words:
the set of functors $\reqtc$ is jointly faithful. \\
\medskip
\pause \goodnesscriteria{2A} \IfSforCwithRCwords then \catcw ought to be equationally complete
with respect to $R_C$.
\end{frame}

\begin{frame}{Equational completeness cont. }
Does equational completeness follow from maximal constrainedness?
It does if we assume local finiteness of \catc:
\begin{lemma}[Path Equivalence Representation Lemma]
If $\catc$ is a locally finite category and $\reqtc$ is a set of instances, if $\catc$ 
 is
\textit{maximally constrained} to the requirement $\reqtc$ then it is equationally
complete with respect to $\reqtc$.
\end{lemma}
\begin{proof}
Suppose \fgparalleldiagram  in $\catc$ and that in all instances $D \in \reqtc$, $D(f)=D(g)$. 
Define $\catcp$ to be \catc plus $f=g$. Consider the Hom functor $Hom_{\catc}(a,\_)$. 
This is an instance of $\catc$ which therefore extends to an instance $H$ of $\catcp$.  Then
$Hom_{\catc}(a,f)=H(I(f))=H(I(g))=Hom(a,g)$ and applying to $id_a$ we have that $f=g$.
\end{proof}
\end{frame}

\begin{frame}{Does Criteria 2A follow from Criteria 2 -- Not always}
Suppose \catcw is the category generated by the sketch with directed graph
\input{../content/frompreparationpaper/completenesscounterexample}
subject to the identities
\begin{equation}
\label{fhidentity}
f \circ h = id_a,
\end{equation}
\begin{equation}
\label{ghidentity}
g \circ h = id_a,
\end{equation}
\begin{equation}
\label{rhhpidentity}
r \circ h \circ h' = id_b.
\end{equation}
We can show that for any functor $D:\catc \morph Fin$, $D(f)=D(g)$. 

If $R_C$ is the set of all functors from \catcw into $\Fin$ then with respect to $\reqtc$, Criteria 2 holds but Criteria 2A does not.
\end{frame}

\begin{frame}{Functional Dependencies}
To describe Goodness Criteria 2B I first need to
\begin{itemize}
\item Define what we mean by \term{functional dependency}
-- abstracted and simplified from definition given by Codd 1971.
\item Define what we mean by a functional dependency being \term{represented}
-- inspired by language I found in Zaniolo 1982.
\item State as the criteria that all functional dependencies ought to be represented -- which I think is in
the spirit of Zaniolo's paper. 
\end{itemize}
\end{frame}

\begin{frame}{Definition of Functional Dependency}
\begin{definition}
If \scalebox{0.9}{\fgsourcediagram} in a category \catcw  and if $\reqtc$ is a set of instances of \catcw
then we say that there is a  \term{functional dependency} of $g$ on $f$ with respect to $\reqtc$ iff
for every $D \in \reqtc$, $D(g)$ factors uniquely through $D(f)$. \\
\pause \medskip
i.e.  in every $D$, $D(f)$ is surjective and there is a family of  functions $H_D:D(b) \morph D(c))_{D \in \reqtc}$
such that in each instance $D \in \reqtc$,
\scalebox{0.9}{\fghfactordiagram{\roomup{0.4cm}\roomdown{0.3cm}D(a)}{D(b)}{D(c)}{D(f)}{D(g)}{H_D}} commutes.
\end{definition}

\pause If $H$ is such a functional dependency then we say that $\fundep{H}{f}{g}$ in $\catc$ with respect to $\reqtc$.
\end{frame}

\begin{frame}{Notation Alert}
The notation 
$$
f \morph g
$$
for functional dependency is adapted from relational database theory. 

\begin{itemize}
\item This is not to imply a morphism or 2-cell or anDefinition of y such thing.
\end{itemize}
\end{frame}

\begin{frame}{Definition of Representation of Functional Dependency}
If $\catc$ is a category and $\reqtc$ is a set of instances, 
if \fgsourcediagram in $\catc$ 
and if there is a functional dependency $\fundep{H}{f}{g}$ then say that 
this functional dependency  is \term{represented} in $\catc$ 
iff there exists a morphism $h:b \morph c$ in $\catc$ such that for each instance $D \in \reqtc$, $D(h)=H_D$. \\
\medskip
\pause If \catcw is a requirement and $\reqtc$ a set of instances then \catcw is said to be 
\textit{functionally complete} with respect to $\reqtc$ iff every functional dependency
present in $\reqtc$ is represented in \catc.\\
\medskip
\pause \goodnesscriteria{2B}\IfSforCwithRCwords then \catcw ought to be functionally complete with respect to $\reqtc$.
\end{frame}

\begin{frame}{Representation Lemma for Functional Dependencies}
I can prove this only in the case that \catcw is locally finite.

\begin{lemma}
If $\catc$ is a locally finite category and $\reqtc$ is a set of instances, if $\catc$ is 
\textit{maximally constrained} to the requirement $\reqtc$ then 
\catcw is functionally complete with respect to $\reqtc$.
\end{lemma}
\begin{proof}
Suppose$\fundep{H}{f}{g}$  is a functional dependency with respect to $\reqtc$.
Hence in all instances $D \in \reqtc$, $D(f)$ is surjective.

Extend \catcw to $\catcp$ by formally adding a morphism $\qq{h}$ such that $f \circ \qq{h}=g$. Extend each $D$ to a $D'$ by defining $D(h)=H_D$. 
Because $D(f)$ is surjective $D'$ is unique. 
Define a functor from \catcw to $\Fin$ as  a certain quotient of the coproduct of functor $Hom_{\catc}(a,-)$ with itself. 
Extend to $\catcp$ and demonstrate that there exists $k:b \morph c$ in \catcw such that $f \circ k=g$. 
which shows that $\fundep{H}{f}{g}$ is represented in $\catc$.
\end{proof}
\end{frame}

\begin{frame}{Proof 1.}
We have \fgsourcediagram in \catc.\\
\medskip
Define functor $F: \catc \morph \Fin$ be the coproduct $Hom_{\catc}(a,-) + Hom_{\catc}(a,-)$.
Label the injections $L$ and $R$, respectively so that
for each object $x$ of $\catc$ the diagram
\begin{center}
$
\begin{array}{c p{0.5cm} c p{0.5cm} c  }
\Rnode{h1}{Hom_{\catc}(a,x)}  &&\Rnode{Fx}{F(x)}  &&   \Rnode{h2}{Hom_{\catc}(a,x)}       
\end{array} 
$
\ncarr{h1}{Fx}
\alabel{L_x}
\ncarr{h2}{Fx}
\blabel{R_x}
\end{center}
is a coproduct in $\Fin$.
\medskip
Define $G: \catc \morph \Fin$ as quotient $F/\sim$ where
\begin{align*}
L_x(k_1) \sim_x R_x(k_2) & \mbox{ iff there exists $k:b \morph x$ in $\catc$ such that $k_1 = f \circ k = k_2$,}\\
L_x(k_1) \sim_x L_x(k_2) & \mbox{ iff $k_1 = k_2$,} \\
R_x(k_1) \sim_x R_x(k_2) & \mbox{ iff $k_1 = k_2$.} \\
\end{align*} 
\end{frame}

\begin{frame}{Proof 2.}
We have \simpleunaryfdrepresentationdiagram{a}{b}{c}{f}{g}{\qq{h}}  in \catcp.\\
\medskip
Extend $G$ to $G':\catcp \morph \Fin.$ \\

\medskip
\begin{align*}
&\mbox{Now} & [L_b(f)]                         &= [R_b(f)]                 \\
&\mbox{i.e.}& G'(f)([L_a(id_a)])              &= G'(f)([R_a(id_a)])       \\
&\therefore & G'(\qq{h}) (G'(f)([L_a(id_a)])) &= G'(\qq{h}) (G'(f)([R_a(id_a)])) \\
&\therefore & G'(g)([L_a(id_a)])              &= G'(g)([R_a(id_a)]) & &    \\
&\therefore & [L_c(g)]                        &= [R_c(g)] 
\end{align*}
Therefore there exists $k:b \morph c$ in 
$\catc$ such that $f \circ k = g$ and we have shown as required that the function dependency
$\fundep{H}{f}{g}$ is represented in $\catc$.
\end{frame}

\newcommand{\incdsetup}{$
\begin{array}{c p{0.5cm} c p{0.5cm} c}
             &&\Rnode{bi}{b_i} &&              \\[0.5cm]
\Rnode{a}{a} &&                && \Rnode{c}{c}
\end{array}
\begin{arrows}
\ncarr{a}{bi}\alabel{f_i}
\ncarr{c}{bi}\blabel{q_i}
\end{arrows}
$}

\newcommand{\incdresolution}{$
\begin{array}{c p{0.5cm} c p{0.5cm} c}
             &&\Rnode{bi}{D(b_i)} &&              \\[0.5cm]
\Rnode{a}{D(a)} &&                && \Rnode{c}{D(c)}
\end{array}
\begin{arrows}
\ncarr{a}{bi}\alabel{D(f_i)}
\ncarr{c}{bi}\blabel{D(q_i)}
\ncarr{a}{c}\blabel{J_D}
\end{arrows}
$}

\begin{frame}{Inclusion Dependencies}
In a relational database there is an \textit{inclusion dependency} denoted
$$a[f_1,...f_n] \subseteq c[q_1,..q_n]$$ 
iff
\begin{itemize}
\item $a$ and $c$ are tables
\item $f_1,...f_n$ are columns of table $a$
\item $q_1,...q_n$ are columns of table $c$
\item in all instances of the database
       $\{\tuple{r.f_1,...r.f_n} | r \in \mbox{ rows of } a\} \subseteq \{\tuple{s.q_1,...s.q_n} | s \in \mbox{ rows of } c\}$.
\end{itemize}
\end{frame}

\begin{frame}{Referential Inclusion Dependencies -- Foreign Keys}
$$a[f_1,...f_n] \subseteq c[q_1,..q_n]$$ 
This inclusion dependency is said to be referential iff to each row $r$ of table $a$ there is a unique row $s$ of table $b$
such that for each $i$, $s.q_i=r.f_i$.
\pause
\begin{itemize}
    \item Then $\tuple{f_1,...f_n}$ is said to be a foreign key referencing the key $\tuple{q_1,...q_n}$.
    \item The constraint is called a foreign key constraint or a referential integrity constraint.
    \item It is the way relationships in data are implemented in relational databases.
    \item Programmers use these to navigate the data.
\end{itemize}
\end{frame}


\begin{frame}{Definition of Inclusion Dependencies}
If $\catc$ is a category and $\reqtc$ is a set of instances 
and if
\incdsetup
in $\catc$, for $i$, $1 \leq i \leq n$, then an \term{inclusion dependency} $J$, written $a[f_1,...f_n] \overset{J}{\subseteq} c[q_1,..q_n]$, is a family of functions $J_D)_{D \in \reqtc}$
such that each instance $D \in \reqtc$, $J_D$ is a function 
 such that
 \incdresolution commutes, for $i$, $1 \leq i \leq n$. \\

\medskip
\begin{itemize}
\item If each $J_D$ is the unique such function then the inclusion dependency is said to be referential. 
\end{itemize}
\end{frame}

\begin{frame}{Definition of Referentially Complete}
\begin{definition}
If $\catc$ is a category and $\reqtc$ is a set of instances and if
\fnsourceqnsource
in $\catc$ and if $a[f_1,...f_n] \overset{J}{\subseteq} c[q_1,..q_n]$ is a referential inclusion dependency
with respect  to $\reqtc$ then say that the inclusion dependency $J$ is \term{represented} in $\catc$
iff there exists a morphism $j:a \morph c$ in $\catc$ such that in each instance $D \in \reqtc$, $D(j) = J_D$. 
\end{definition}
If \catcw is a category and $\reqtc$ a set of instances then 
\catcw is \term{referentially complete} with respect to $\reqtc$ 
iff all referential inclusion dependencies present in $\reqtc$ are represented in \catc.
\end{frame}

\begin{frame}{Goodness Criteria 2C}
\goodnesscriteria{2C} \IfSforCwithRCwords 
then \catcw ought to be referentially complete with respect to $\reqtc$.
\end{frame}

\begin{frame}{Representation Lemma for Referential Inclusion Dependencies}
If \catcw is a locally finite category and $\reqtc$ is a set of instances, if \catcw is 
\textit{maximally constrained} to the requirement $\reqtc$ then
every referential inclusion dependency with respect to $\reqtc$ is represented in $\catc$.
\end{frame}

\begin{frame}{Proof}
Suppose $a[f_1,...f_n] \overset{J}{\subseteq} c[q_1,..q_n]$ is a referential inclusion dependency
where for each $i$, $1 \leq i \leq n$,
\scalebox{0.9}{\incdsetup} in \catc.

Extend category \catcw to a category \catcpw such that in \catcpw there is
a morphism $\qq{r}: a \morph c$ such that for each $i$, $1 \leq i \leq n$, 
$\qq{r} \circ q_i = f_i$.
Every $D \in \reqtc$ extends uniquely to functor $D: \catcp \morph \Fin$. Therefore, since \catcw is maximally constrained then every functor $F: \catc \morph \Fin$ can be extended to $F':\catcp \morph \Fin$. \\
\pause Let $H: \catcp \morph \Fin$ be the extension of the hom functor $Hom(a,-): \catc \morph \Fin$ to 
\catcp. \\
\pause For each $i$, we have $H(\qq{r}) \circ H(q_i) = H(f_i)$, \\
\pause \hspace {3cm} i.e. $H(\qq{r}) \circ Hom(a,q_i) = Hom(a,f_i)$. \\
\pause Therefore in particular $H(\qq{r})(id_a) \circ q_i =  f_i$. \\
\pause Hence $H(\qq{r})(id_a):a \morph c$ in \catcw represents the inclusion dependency $J$.
\end{frame}

\begin{frame}{Three Goodness Criteria}{for Categories as Data Specifications}
Definition of Goodness Criteria 2A, 2B and 2C:
\begin{itemize}
\item If \catcw is a category and $\reqtc$ is a set of instances of \catcw then
\medskip
\begin{tabular}{>{\bfseries}l l} 
2A: & \catcw ought to be equationally complete wrt $\reqtc$  \\
2B: & \catcw ought to be  functionally complete wrt $\reqtc$  \\
2C: & \catcw ought to be referentially complete wrt $\reqtc$ \\
\end{tabular}
\pause \item We have shown that if \catcw is locally finite and meets Criteria 2 that it is maximally constrained then it also meets Criteria 2A, 2B and 2C.

\pause \item We will move on to consider categories with designated monomorphisms and epimorphisms
\item First though we will describe a possible improvement to this situation described above.
\end{itemize}
\end{frame}

