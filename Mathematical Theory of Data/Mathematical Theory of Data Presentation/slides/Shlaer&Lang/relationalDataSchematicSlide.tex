
\newcommand{\studentDepartmentAttribute}[1]             {\onslide<1-5>{#1}}
\newcommand{\popupInitialInclusionDependencies}[1]       {\only<1-4>{#1}}
\newcommand{\studentDepartmentAttributeStrikeout}[1]    {\onslide<5>{#1}}
\newcommand{\popupMarkedUpInitialInclusionDependencies}[1] {\only<5>{#1}}
\newcommand{\popupAbstractionOfd}[1]                    {\only   <2-5>{#1}} %was 6
\newcommand{\popupAbstractionOfdDetail}[1]              {\onslide<3-5>{#1}} %was 6
\newcommand{\studentDepartmentRelationship}[1]          {\onslide<4->{#1}}
\newcommand{\popupFirstRewrittenInclusionDependencies}   {\only   <6-9>}

\newcommand{\professorDepartmentAttribute}[1]           {\onslide<1-10>{#1}}
\newcommand{\professorDepartmentAttributeStrikeout}[1]  {\onslide<10>{#1}}
\newcommand{\popupMarkedUpFirstRewrittenInclusionDependencies}[1]
                                                        {\only   <10>{#1}}
\newcommand{\popupAbstractionOfdPrime}[1]               {\only   <7-10>{#1}}
\newcommand{\popupAbstractionOfdPrimeDetail}[1]         {\onslide<8-11>{#1}}
\newcommand{\professorDepartmentRelationship}[1]        {\onslide<9->{#1}}
\newcommand{\professorDepartmentRelationshipBar}[1]     {\onslide<11->{#1}}

\newcommand{\popupSecondRewrittenInclusionDependencies} {\only  <11-16>}
\newcommand{\studentProfessorAttribute}[1]              {\onslide<1-15>{#1}}
\newcommand{\studentProfessorAttributeStrikeout}[1]     {\onslide<15>{#1}}
\newcommand{\popupAbstractionOfs}[1]                    {\only   <12-16>{#1}}
\newcommand{\popupAbstractionOfsDetail}[1]              {\onslide<13-16>{#1}}
\newcommand{\studentProfessorRelationship}[1]           {\onslide<14->{#1}}

\newcommand{\popupThirdRewrittenInclusionDependencies}  {\only  <17-20>}
\newcommand{\departmentProfessorAttribute}[1]           {\onslide<1-20>{#1}}
\newcommand{\departmentProfessorAttributeStrikeout}[1]  {\onslide<20>{#1}}
\newcommand{\popupAbstractionOfhd}[1]                   {\only   <18-20>{#1}}
\newcommand{\popupAbstractionOfhdDetail}[1]             {\onslide<19-20>{#1}}
\newcommand{\departmentProfessorRelationship}[1]        {\onslide<19-20>{#1}}


\newcommand{\professorStudentDepartmentRelationalSchematic}
{
\begin{tabular}{c p{0.25cm} c p{0.5cm} c}
$\begin{array}{c p{0.01cm} c p{0.2cm} c}
\multicolumn{5}{c}{\Rnode{student}{student}} \\[-0.3cm]
\multicolumn{5}{c}{\Rnode{sB1}{}\hspace{0.4cm}\Rnode{sB2}{}\hspace{0.5cm}\Rnode{sB3}{}} \\[1.0cm]
\Rnode{sv1}{v} && \studentDepartmentAttribute{\Rnode{sv2}{v}} && \studentProfessorAttribute{\Rnode{sv3}{v}}
\end{array}
\begin{arrows}
\ncarr{sB1}{sv1}
\blabel{sName}[0.55][0.1]
\addedgebar
\studentDepartmentAttribute{
  \ncarr{sB2}{sv2}
  \alabel{sDept}[0.57][0.1]
  \studentDepartmentAttributeStrikeout{\ncstrikeout{sB2}{sv2}}
}
\studentProfessorAttribute{
  \ncarr{sB3}{sv3}
  \alabel{sSv}[0.55][0.1]
  \studentProfessorAttributeStrikeout{\ncstrikeout{sB3}{sv3}}
}
\end{arrows}$
&&
$\begin{array}{c p{0.1cm} c p{0.01cm} c}
\multicolumn{5}{c}{\Rnode{professor}{professor}} \\[-0.3cm]
\multicolumn{5}{c}{\Rnode{pB1}{}\hspace{0.5cm}\Rnode{pB2}{}\hspace{0.5cm}\Rnode{pB3}{}} \\[1.0cm]
\professorDepartmentAttribute{\Rnode{pv1}{v}} && \Rnode{pv2}{v} && \Rnode{pv3}{v} 
\end{array}
\begin{arrows}
\professorDepartmentAttribute{
  \ncarr{pB1}{pv1}
  \blabel{pDept}[0.5][0.1]
  \addedgebar
  \professorDepartmentAttributeStrikeout{\ncstrikeout{pB1}{pv1}}
}
\ncarr{pB2}{pv2}
\blabel{pNo}[0.55][0.1]
\addedgebar
\ncarr{pB3}{pv3}
\alabel{pName}[0.5][0.1]
\end{arrows}$
&&
$\begin{array}{c  c }
\multicolumn{2}{c}{\Rnode{department}{department}} \\[-0.3cm]
\multicolumn{2}{c}{\Rnode{dB1}{}\hspace{0.5cm}\Rnode{dB2}{}} \\[1.0cm]
\hspace{0.2cm}\Rnode{dv1}{v} & \departmentProfessorAttribute{\Rnode{dv2}{v}} 
\end{array}
\begin{arrows}
\ncarr{dB1}{dv1}
\blabel{dName}[0.5][0.1]
\addedgebar
\departmentProfessorAttribute{
  \ncarr{dB2}{dv2}
  \alabel{dHd}[0.5][0.1]
  \departmentProfessorAttributeStrikeout{\ncstrikeout{dB2}{dv2}}
}
\end{arrows}$
\end{tabular}
}

\newcommand{\abstractionOfd}
{
Remove $sDept$ and replace by an edge $d: student \morph department$.
Rewrite appearances of $sDept$ in the sketch by $d \circ dName$.
}

\newcommand{\abstractionOfdPrime}
{
Remove $pDept$ and replace ny an edge $d': professor \morph department$.
%$\composeSevenShaped[0.85cm]{professor}{department}{v}{d'}{name}{dept}$ commutes. 
Rewrite appearances of $pDept$ in the sketch by $d' \comp dName$.
}

\newcommand{\abstractionOfs}
{
Remove $sSv$ and replace by an edge  $s: student \morph professor$.
Rewrite appearances of $sSv$ in the sketch by $s \comp pNo$.
Add commutative diagram
$\composeSevenShaped[0.85cm]{student}{professor}{v} {s}{d' \circ dName}{d \circ dName}$ 
 simplify to
$\composeSevenShaped[0.85cm]{student}{professor}{department}{s}{d'}{d }$
Keep $\composeSevenShaped[0.85cm]{student}{professor}{v}{s}{no}{svr}$ commute
pending rethink.
}

\newcommand{\abstractionOfhd}
{
Replace $dHd$ by an edge  $hd: department \morph professor$,
add commutivity of
$\composeSevenShaped[0.85cm]{department}{professor}{v}{hd}{d' \circ dName}{dName}$
 simplfy to
$\composeSevenShaped[0.85cm]{department}{professor}{department}{hd}{d'}{id}$
.
Keep $\composeSevenShaped[0.85cm]{department}{professor}{v}{h}{no}{hd}$.
}

\newcommand{\circledStudentSupervisorInclusionDependency}
{
{student[\psovalbox[linecolor=red, boxsep=false]{sDept},sSv] \subseteq professor[pDept,pNo]}
}

\newcommand{\rewrittenStudentSupervisorInclusionDependency}
{
{student[d \circ dName,sSv] \subseteq professor[pDept,pNo]}
}

\newcommand{\circledRewrittenStudentSupervisorInclusionDependency}
{
{student[d \circ dName,sSv] 
   \subseteq professor[\psovalbox[linecolor=red, boxsep=false]{pDept},pNo]}
}
\newcommand{\circledHeadOfDeptIncD}
{department[dName,dHd]  
   \subseteq professor[\psovalbox[linecolor=red, boxsep=false]{pDept},pNo]}

\newcommand{\secondRewrittenStudentSupervisorInclusionDependency}
{
{student[d \circ dName,sSv] 
   \subseteq professor[d \circ dName,pNo]}
}
\newcommand{\secondRewrittenHeadOfDeptIncD}
{department[dName,dHd]  
   \subseteq professor[d' \circ dName,pNo]}


\newcommand{\initialInclusionDependencies}
{
$\studentDeptInclusionDependency$
$\professorDeptInclusionDependency$
$\studentSupervisorInclusionDependency$
$\headOfDeptInclusionDependency$
}

\newcommand{\strikeout}[1]{\colorbox{red}{\sout{#1}}}
\newcommand{\initialMarkedUpInclusionDependencies}
{
\st{$\studentDeptInclusionDependency$}
$\professorDeptInclusionDependency$
$\circledStudentSupervisorInclusionDependency$
$\headOfDeptInclusionDependency$
}
             
\newcommand{\firstRewrittenInclusionDependencies}
{
firstReWritten
$\professorDeptInclusionDependency$
$\rewrittenStudentSupervisorInclusionDependency$
$\headOfDeptInclusionDependency$
}

\newcommand{\markedUpFirstRewrittenInclusionDependencies}
{markedUpFirstRewritten\\
\st{$\professorDeptInclusionDependency$}
$\circledRewrittenStudentSupervisorInclusionDependency$
$\circledHeadOfDeptIncD$
}
\newcommand{\secondRewrittenInclusionDependencies}
{
SecondRewritten\\
$\secondRewrittenStudentSupervisorInclusionDependency$
$\secondRewrittenHeadOfDeptIncD$
}

\newcommand{\thirdRewrittenInclusionDependencies}
{
thirdReWritten\\
$\secondRewrittenHeadOfDeptIncD$ % sic
}


\newcommand{\abstractionToSketch}
{
\popupInitialInclusionDependencies{\initialInclusionDependencies}
\popupMarkedUpInitialInclusionDependencies{\initialMarkedUpInclusionDependencies}
\popupFirstRewrittenInclusionDependencies{\firstRewrittenInclusionDependencies}
\popupMarkedUpFirstRewrittenInclusionDependencies
                                    {\markedUpFirstRewrittenInclusionDependencies}
\popupSecondRewrittenInclusionDependencies{\secondRewrittenInclusionDependencies}
\popupThirdRewrittenInclusionDependencies{\thirdRewrittenInclusionDependencies}

\popupAbstractionOfd{                    
\begin{block}{Step 1. Eliminate $\studentDeptInclusionDependency$}
\popupAbstractionOfdDetail{\abstractionOfd}
\end{block}
}

\popupAbstractionOfdPrime{
\begin{block}{Step 2. Eliminate $\professorDeptInclusionDependency$}
\popupAbstractionOfdPrimeDetail{\abstractionOfdPrime}
\end{block}
}
\popupAbstractionOfs{
\begin{block}{Step 3. Eliminate $\secondRewrittenStudentSupervisorInclusionDependency$}
\popupAbstractionOfsDetail{\abstractionOfs}
\end{block}
}
\popupAbstractionOfhd{
\begin{block}{Step 4. Eliminate this final inclusion dependency.}
\popupAbstractionOfhdDetail{\abstractionOfhd}
\end{block}
}
}


\begin{frame}{Relational Data Schematic}
\vspace{0.9cm}
\professorStudentDepartmentRelationalSchematic
$\begin{arrows}
\studentDepartmentRelationship{
  \ncarr[20]{student}{department}
  \alabel{d}[0.4]
}
\studentProfessorRelationship{
  \ncarr[5]{student}{professor}
  \alabel{s}[0.4]
}
\professorDepartmentRelationship{
  \ncarr[5]{professor}{department}
  \alabel{d'}[0.4]
  \professorDepartmentRelationshipBar{\addedgebar}
}
\departmentProfessorRelationship{
  \ncarr[5]{department}{professor}
  \alabel{hd}[0.4]
}\end{arrows}
$

\begin{overlayarea}{11cm}{7cm}

\abstractionToSketch
\onslide<20>{END}%need to force slide 20 to appear without hd attribute ??
\end{overlayarea}

\end{frame}

