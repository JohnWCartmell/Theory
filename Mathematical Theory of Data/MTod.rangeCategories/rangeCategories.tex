

\section{Introduction}

\begin{newtt}
Data specifications describe how particulars in some context or discursive domain
are to be represented in data. 
The \textit{mathematical theory of data} is a putative meta-theory 
intended to support technology-independent reasoning about such data specifications, whatever form they may take. 
Its scope spans the relational theory of data that originated in 1970, including the five or so definitions of normal form,
and the later retargeting of these normal forms to hierarchical representations 
of data as found in message structures generally and as typified in the use of XML.
\end{newtt}

The putative theory is abstract in so much as it remains neutral about the choice of universals such as \textit{integer}, \textit{float} and \textit{string} and the binary encodings of these universals. 
It explains the viability and the interchangeability of hierarchical and relational forms of a data specification.  

It formulates both fundamental principles and individual criteria for goodness of data specifications and aims to establish these by demonstarting a chain of mathematically provable logical implications
\[
\textit{Fundamental Principles}
\;\Longrightarrow\;
\textit{Individual Goodness Criteria}
\;\Longrightarrow\;
\textit{Classic 1970s Normal Forms}.
\]
 
In this way, the fundamental principles provide both an explanation for the classic normal forms—forms which, to my mind at least, retain an air of mystery—and also a means of generalising them beyond the relational sphere in which they were first formulated.

A prior analysis (notes currently on GitHub) suggests that our everyday descriptions of particular things in common language are shaped by significant occurrences of equivalent paths among the network of functional relationships present in any subject domain. 

To achieve good data specifications for a subject domain, the effects of these equivalent paths must be taken into account. 
Since the logic of equivalent paths is the starting point for category theory, we are led to the conclusion that 
category theory should play a role in the mathematical theory of data. Indeed, the contention is that
a data specification must be a sketch of some sort of categorical structure, 
and that it is the use of the language of category theory that enables us to articulate precise 
principles and criteria of goodness.

In this note we examine how Cockett et al.'s notion of a \emph{range category} plays out as a candidate structure for what we want to achieve in a \textit{mathematical theory of data}. In a presentation at the Topos Institute 
we presented data specifications as range categories with a distinguished object $v$ representing the type of all universals. Here we simplify the discussion by omitting the type of universal, 
as this allows us to simplify the mathematics of the goodness criteria.
What we present is therefore a mathematically expedient stepping stone toward a viable mathematical theory of data.

\section{Restriction Categories (\cite{COCKETT2002})}

\cite{COCKETT2002}
From Cockett \& Lack, a restriction category is a category \catcw with an additiona operator (the restriction operator) such that
if $f: a \morph b$ in \catcw then
$$\bar{f}: a \morph a$$ 
and satisfying

R.1 For $f:a \morph b$ in \catcw $$\bar{f} \circ f =f$$.

R.2. If \fgsourcediag in \catcw then
$$\bar{g} \circ \bar{f}=\bar{f} \circ \bar{g}.$$

R.3. If \fgsourcediag in \catcw then
$$\overline{\bar{f} \circ g} = \bar{f} \circ \bar{g}$$.

R.4. If $\sequentialdiag{a}{b}{c}{f}{g}$ in \catcw then
$$f \circ \bar{g} = \overline{f \circ g} \circ f$$.

\begin{lemma}
\label{restrictioncatlemma}
In any restriction category \catc
\begin{enumerate} [(i)]
\item For $f:a \morph b$ in \catcw,
$$\bar{\bar{f}}=\bar{f}$$
\item If $\sequentialdiag{a}{b}{c}{k}{j}$ in \catcw 
and $k$ is total i.e. $\bar{k}=id_a$
and if $k \circ \bar{j}$ is total i.e. $\overline{k \circ \bar{j}}=id_a$
then
$$k \circ \bar{j} = k.$$
\item If $\sequentialdiag{a}{b}{c}{k}{j}$ in \catcw 
and $k$ is total i.e. $\bar{k}=id_a$ then
$$\overline{k \circ j} = \overline{k \circ \bar{j}}.$$
\end{enumerate}
\end{lemma}
\begin{proof}
\begin{enumerate} [(i)]
\item Use R3 with $g$ being $id_b$.
\item 
\begin{align*}
k \circ \bar{j} &= k \circ \bar{\bar{j}}              && \mbox{from (i),}\\
                &= \overline{k \circ \bar{j}} \circ k && \mbox{by R.4,}   \\
                &= k                                  && \mbox{from assumption $k \circ \bar{j}$ is total.}
\end{align*}
\item 
\begin{align*}
\overline{k \circ j} &= \overline{k \circ j} \circ \bar{k}    && \mbox{from assumption that $k$ total,}\\
                     &= \overline{\overline{k \circ j} \circ k} && \mbox{by R.3,} \\
                     &= \overline{k \circ \bar{j}}              && \mbox{by R.4.}
\end{align*}
\end{enumerate}
\end{proof}

\section{Range Categories \cite{COCKETT2012}}

A \term{range category} is a retriction category with an additional operator as follows
if $f: a \morph b$ in  \catcw then
$$\hat{f}: b \morph b$$
satisfying

RR.1 For $f:a \morph b$ in \catcw $$\bar{\hat{f}} = \hat{f}.$$

RR.2 For $f:a \morph b$ in \catcw $$f \circ \hat{f} = f.$$

RR.3. If $\sequentialdiag{a}{b}{c}{f}{g}$ in \catcw then
$$\widehat{f \circ \bar{g}} = \hat{f} \circ \bar{g}.$$

RR.4. If $\sequentialdiag{a}{b}{c}{f}{g}$ in \catcw then
$$\widehat{(hat({f}) \circ g)} = \widehat{f \circ g}.$$

A range category may additionally satisfy

RR.5 if $\equaliser{a}{f}{\paralleldiag{b}{c}{g}{h}}$ then
 $$f \circ g = f \circ h \Rightarrow  \hat{f} \circ g = \hat{f} \circ h.$$


In this note we explore range categories that satisfy this additional RR.5 condition as data specifications.




Let the category \FinPar be the range catgory of finite sets and partial functions.

\begin{lemma}
If $f:a \morph a$ in a range category \catcw then for any morphism 
$f: a \morph b$
\begin{enumerate}[(i)] 
\item $\hat{\hat{f}}=\hat{f}$,
\item $\hat{f} \comp \hat{f} = \hat{f}$,
\item $\hat{\bar{f}}=\bar{f}$,
\item $\bar{\hat{f}}=\hat{f}$.
\end{enumerate}
\end{lemma}
\begin{proof}
Straightforward.
\end{proof}

\section{Construction of Restriction Functors}

\subsection{$HomP$ is a Restriction Functor}
If \catcw is a restriction functor then
let $HomP_\catc(a,-): \catc \morph \SetP$ be the  functor
defined as follows. $HomP(a,x)=Hom(a,x)$.
If $j: x \morph y$ then partial function $HomP(a,j): HomP(a,x) \morph HomP(a,y)$
is defined as follows:
\begin{align*}
HomP(a,j)(k) = k \circ j &\mbox{ if $k \circ \bar{j} = k$} \\
                         & \mbox{ is undefined otherwise}
\end{align*}
\begin{lemma}
If \catcw is a restriction catgory and $a$ is an object of \catcw 
then the functor $HomP_\catc(a,-)$ preserves the restriction operator i.e.
for all $j:x \morph y$ in \catc
$$HomP_\catc(a,\bar{j})=\overline{HomP_\catc(a,j)}$$
\end{lemma}
\begin{proof}
Both $HomP_\catc(a,\bar{j})$ and $\overline{HomP_\catc(a,j)}$ are less than id function on the set $Hom(a,x)$. 
The former because by definition of $HomP$ 
if $HomP_\catc(a,\bar{j})(k)$ is defined then $HomP_\catc(a,\bar{j})(k)=k$.
The latter by definition of $\bar{f}$, for any function $f$.

It suffices to show that $HomP_\catc(a,\bar{j})$ is defined iff and only if
$HomP_\catc(a,j)$ is defined which we can do as follows.
 Let $k \in Hom(a,x)$. $HomP_\catc(a,\bar{j})(k)$
is defined iff $k \circ \bar{\bar{j}}$ i.e. $k \circ \bar{j}$ is defined
iff $HomP_\catc(a,j)(k)$ is defined. 
\end{proof}


\subsection{Coproducts of Set valued Range Functors}
\subsection{Quotients of Set valued Restriction Functors}

\newcommand{\Fquotient}{F/\sim}
Suppose \catcw is a restriction category and that $F: \catc \morph \SetP$ is a restriction functor into the restriction category of sets and partial functions. Suppose that for every object $x$ of \catcw there is an equivalence relationship $\sim_x$ defined on the set $F(x)$. Suppose that this equivalence relationship has the following property(s):
For every morphism $j:x \morph y$ in \catcw, for all elements $k1,k2 \in F(x)$,
\begin{enumerate}
\item $F(j)(k_1)$ is defined iff $F(j)(k_2)$ is defined, 
\item $k_1 \sim_x k_2 \mbox{ and } F(j)(k_1) \mbox{ is defined } \implies F(j)(k_1) \sim_y F(j)(k_2).$
\end{enumerate}
Define functor $\Fquotient: \catcw \morph \SetP$ by defining
\begin{align*}
&x             &&\mapsto F(x)/\sim_x 
                & \mbox{i.e. the set of equivalence classes of $F(x)$ wrt equivalence relation $\sim$}\\
&j: x \morph y &&\mapsto F(j)/\sim
\end{align*} 
where $F(j)/\sim$ is defined by
\begin{align*}
[k] \mapsto [F(j)(k)] && \mbox{provided $F(j)(k)$ is defined, is undefined otherwise.}
\end{align*}
which is well-defined because of the assumption made above.

It is easy to see that $\Fquotient$ is a functor (i.e. respects composition $\circ$ and identity morphisms.)

\begin{lemma}
The functor $\Fquotient$ is a restriction functor.
\end{lemma}
\begin{proof}
We need to show that  $\Fquotient$ respects the restriction operator
i.e. we need to show that for any morphism $j:x \morph y$ in \catcw, $\Fquotient(\bar{j})= \overline{\Fquotient(j)}$.

The LHS, $\Fquotient(\bar{j})$, is defined to  be the partial function
$$ [k] \mapsto [F(\bar{j})(k)] \mbox{ providing $F(\bar{j})(k)$ is defined, is undefind otherwise,}$$
in otherwords, since  $F$ assumed to be a restriction functor it can be defined as mapping
$$ [k] \mapsto [\overline{F(j)}(k)] \mbox{providing $\overline{F(j)}(k)$ is defined, is undefind otherwise,}$$
and this in turn, because of the definition of restriction in \SetP, means that it maps
$$ [k] \mapsto [k] \mbox{providing $F(j)(k)$ is defined, is undefined otherwise.}$$

Meanwhile the RHS, $\overline{\Fquotient(j)}$  is defined as the partial function that 
maps $[k]$  to $[k]$  provided  $\Fquotient(j)(k)$ is defined, and to be undefined otherwise.

Because,
from the definition of $\Fquotient$, $\Fquotient(j)([k])$ is defined iff $F(j)(k)$ is defined then
we have shown that LHS and RHS are identical functions, as required.
\end{proof}

\section{RR.5 Range Categories}

\section{Range Categories with Partial Sections}
\begin{itemize}
       \item a range catagory with partial sections is ...
       \item every RR.5 range category can be faithfully mapped into a range category with partial sections
       \item the inclusion of the category of range categories with partial sections  
              into the  category of RR.5 range categories has a left adjoint
       \item the unit of the adjunction faithfully 
               embeds an RR.5 category in a freely generated range category with sections.
\end{itemize}

\section{Conjecture}
I was trying to understand relationship between 
\begin{itemize}
\item the theory of range categories with partial sections is a conservative extension of the theory of RR.5 range categories.
\item the forgetful functor from (category of) range categories with partial sections to (category of) range categories has a left adjoint
\item the unit of the adjunction embeds a range category $C$ in a range category with partial sections $C_s$, if $C$ is an RR.5 range category then the unit is faithful
\end{itemize}
\section{Construction of Range Functors}

\subsection{$HomP$ as a Range Functor}

\begin{lemma}
If \catcw is a range category in which every morphism has a partial section then
for every object $a$ of \catcw the functor $HomP_\catcw(a,-): \catcw \morph \SetP$ preserves the range operator. 
\end{lemma}
\begin{proof}
If $j: x \morph y$ in \catcw then we are required to prove that
$$\widehat{HomP_\catcw(a,j)}=HomP_\catcw(a,\hat{j})$$
and for this it suffices to show that the range of $HomP_\catcw(a,j)$ 
i.e. this set
$$\setsuchthat{ k \circ j}{k: a \morph x \mbox{ and } k \circ \bar{j} = k }$$ 
is identical to the range of $HomP_\catcw(a,\hat{j})$ 
i.e. this set
$$\setsuchthat{k' \circ \hat{j}}{k':a \morph y \mbox{ and } k' \circ \bar{\hat{j}} = k' }.$$   
i.e. this set
$$\setsuchthat{k' \circ \hat{j}}{k':a \morph y \mbox{ and } k' \circ \hat{j} = k' }.$$

The first set is included in the second because for any morphism of the form $k \circ j$, 
where $k \circ \bar{j}=k$, 
is of the form $k' \circ \hat{j}$, for $k' \circ \hat{j} = k'$, 
because we can take $k'$ to be $k \circ j$ 
because then 
$k' \circ \hat{j} = (k \circ j) \circ \hat{j}= k \circ(j \circ \hat{j})= k \circ j = k'$,
as required. 

Let $j_s : y \morph x$ be the splitting of $j$ i.e. be such that $j_s \circ j = \hat{j}$.

The second set is included in the first because if a morphism is of the form $k' \circ \hat{j}$, where $k' \circ \hat{j} = k'$, then it of the form $k \circ j$, where $k \circ \bar{j}=k$, because $k$ can be taken to be $k' \circ j_s$ for then we have 
$k' \circ \hat{j} = k' \circ j_s \circ j = k \circ j$
and we have $k \circ \bar{j}= k' \circ j_s \circ \bar{j} =  k' \circ j_s = k$ using lemma
\ref{jsbarj}, as required. 
 \end{proof}

\begin{corollary}
If \catcw is a range category in which every morphism has a partial section then
for every object $a$ of \catcw the functor $HomT_\catcw(a,-): \catcw \morph \SetP$ is a range functor.
\end{corollary}

\subsection{About HomP}
\begin{lemma}
\label{HomOfEffbargbar}
\fgsourcediag
\begin{align*}
[L_c(f)] &= [L_a(Hom(a,f)(\bar{f}\circ\bar{g}))] \\
[L_c(g)] &= [L_a(Hom(a,g)(\bar{f}\circ\bar{g}))]
\end{align*} \commentary{\highlight{what} the heck?}
\end{lemma}
\begin{proof}
\end{proof}
\subsection{Coproducts of Set valued Range Functors}
TBD
\subsection{Quotients of Set valued Range Functors}
\begin{lemma}
\label{rangefunctorquotient}
The functor $\Fquotient$ is a range functor.
\end{lemma}
\begin{proof} \commentary{Proof reviewed on 12 Dec 2023.}
We need to show that  $\Fquotient$ respects the range operator
i.e. we need to show that for any morphism $j:x \morph y$ in \catcw, 
 $\Fquotient(\hat{j})= \widehat{\Fquotient(j)}$.

The LHS, $\Fquotient(\hat{j})$, is defined to  be 
the partial function which maps $[k']$, where $k' \in F(y)$, as follows
$$ [k'] \mapsto [F(\hat{j})(k')] \mbox{ providing $F(\hat{j})(k')$ is defined, and is undefined otherwise.}$$
In otherwords, since  $F$ assumed to be a range functor it can be defined as mapping
$$ [k'] \mapsto [\widehat{F(j)}(k')] \mbox{ providing $\widehat{F(j)}(k')$ is defined and being undefined otherwise,}$$
and this in turn, because of the definition of ranges in \SetP, means that it maps
$$ [k'] \mapsto [k'] \mbox{providing there exists $k \in F(x)$ such that $k'=F(j)(k)$ and being undefined otherwise.}$$

Meanwhile the RHS, $\widehat{\Fquotient(j)}$  is defined as the partial function that 
maps $[k']$  to $[k']$  provided  there exists $k \in F(x)$ such that
$\Fquotient(j)([k])=[k']$ to be undefined otherwise.

Because,
from the definition of $\Fquotient$ we have that $\Fquotient(j)([k])= [F(j)(k)]$   
we have  that LHS and RHS are identical functions, as required.
\end{proof}
